# External Pentesting Network

## Discovering hosts from the outside

This is going to be a **brief section** about how to find **IPs responding** from the **Internet**.

In this situation you have some **scope of IPs** (maybe even several **ranges**) and you just to find **which IPs are responding**.


### Discovery All Hosts Alive (ICMP)

This is the **easiest** and **fastest** way to discover if a host is up or not. You could try to send some **ICMP** packets and **expect responses**.

The easiest way is just sending an **echo request** and expect from the response. You can do that using a simple `ping` or using `fping` for **ranges**.

You could also use **nmap** to send other types of ICMP packets (this will avoid filters to common ICMP echo request-response).

```
ping -c 3 192.168.1.137    # 3 echo request to a host
```
```
fping -c 3 -g 192.168.1.0/24  # Send 3 echo requests to ranges
```
```
nmap -PEPM -sP -n 192.168.1.0/24 # Send echo, timestamp requests and subnet mask requests
```
```
nmap -Pn -sn 192.168.1.0/24 # Send Ping Scan, disable port scan
```

### Discovery All Hosts Alive (TCP)

It's very common to find that all kind of ICMP packets are being filtered. 

Then, all you can do to check if a host is up is **try to find open ports**. Each host has **65535 ports**, so, if you have a "big" scope you **cannot** test if **each port** of each host is open or not, that will take too much time.

Then, what you need is a **fast port scanner** and a list of the **ports more used:**
```
masscan -p21,22,53,80,443,445 192.168.1.0/24 > hostsAlives.txt
```
```
nmap -sS -p21,22,80,443,445 -n 192.168.1.0/24 > hostsAlives.txt # Fast simple scan TCP SYN
```

### Ports More Used
```
masscan -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,7001,7002,8000-8100,8443 192.168.1.0/24 > hostsPortsMoreUsed.txt
```
```
nmap -p20,21-23,25,53,80,110,111,135,139,143,443,445,993,995,1723,3306,3389,5900,7001,7002,8000-8100,8443 192.168.1.0/24 > hostsPortsMoreUsed.txt
```

### All Ports From Servers

If you have a small scope you can test for all ports of each host:
```
nmap -Pn -sS --open -p1-65535 192.168.1.0/24 # Fast simple scan TCP SYN
```
```
masscan -e tun0 --open -p1-65535 --max-rate 1000 <IP>
```

### Full Complete Slow Scan With Output
```
nmap -v -sT -A -T4 -p- -Pn --script vuln -oA full 10.11.1.111
```
```
masscan -p1-65535,U:1-65535 10.10.10.x --rate=1000 -e tun0
```

### Scan Ipv6
```
nmap -6 -sC -sV -T4 -p- <ip_victim>
```
```
nmap -6 -sC -sV -T4 -p- dead:beef::250:56ff:feb9:f653
```

### UDP Port Discovery

You could also try to check for some **UDP port open** to decide if you should **pay more attention** to a host.

As UDP services usually **don't respond** with **any data** to a regular empty UDP probe packet it is difficult to say if a port is being filtered or open. The easiest way to decide this is to send a packet related to the running service, and as you don't know which service is running, you should try the most probable based on the port number:
```
nmap -sU -sV --version-intensity 0 -F -n 199.66.11.53/24 # The -sV will make nmap test each possible known UDP service packet # The "--version-intensity 0" will make nmap only test the most probable
```
```
nmap 10.11.1.111 -sU
```
```
unicornscan -mU -v -I 10.11.1.111
```
```
masscan -pU:1-65535 10.10.10.x --rate=1000 -e tun0
```

#### Connect to UDP if One is Open
```
nc -u 10.11.1.111 48772
```

### SCTP Port Discovery

Stream Control Transmission Protocol (SCTP) is a transport-layer protocol that ensures reliable, in-sequence transport of data.
```
#
nmap -T4 -sY -n --open -Pn <IP/range>
```

## Vulnerabilities and Versions

Perform all steps (whole recon + all attacks)
```
./reconftw.sh -d target.com -a
```



### BruteSpray

Also, It could be worth it to mention that you can also prepare some **default username** and **passwords lists** and try to **bruteforce services with [https://github.com/x90skysn3k/brutespray](https://github.com/x90skysn3k/brutespray)** 

### Automatic Tools

There are several tools out there that will perform part of the proposed actions against a given scope.

[**https://github.com/yogeshojha/rengine**](https://github.com/yogeshojha/rengine)
[**https://github.com/j3ssie/Osmedeus**](https://github.com/j3ssie/Osmedeus)
[**https://github.com/six2dez/reconftw**](https://github.com/six2dez/reconftw)
[**https://github.com/hackerspider1/EchoPwn**](https://github.com/hackerspider1/EchoPwn) (A little old and not updated)
