# External Enumeration Methodology

Find all the possible assets of your target.

# Summary

* [Assets Discoveries](#assets-discoveries)
  * [Acquisitions](#acquisitions)
  * [ASNs](#asns)
  * [Scan for Vulnerabilities](#scan-for-vulnerabilities)
* [Domains](#domains)
* [Subdomains](#subdomains)
  * [Why so many tools and techniques?](#why-so-many-tools-and-techniques)
  * [Methods](#methods)
  * [Techniques](#techniques)
  * [Online Tools](#online-tools)
    * [Subdomain Online](#subdomain-online)
    * [Search Engines](#search-engines)
    * [Specialized Search Engines](#specialized-search-engines)
    * [Certificate Transparency](#certificate-transparency)
* [Emails](#emails)
  * [Search Domain Emails](#search-domain-emails)

 
# Assets discoveries

> You were said that everything belonging to some company is inside the scope, and you want to figure out what this company actually owns.

The goal of this phase is to obtain all the **companies owned by the main company** and then all the **assets** of these companies. To do so, we are going to:

1. Find the acquisitions of the main company, this will give us the companies inside the scope.
2. Find the ASN (if any) of each company, this will give us the IP ranges owned by each company
3. Use reverse whois lookups to search for other entries (organisation names, domains...) related to the first one (this can be done recursively)
4. Use other techniques like shodan `org`and `ssl`filters to search for other assets (the `ssl` trick can be done recursively).

## Acquisitions

First of all, we need to know which **other companies are owned by the main company**.

One option is to visit [https://www.crunchbase.com/](https://www.crunchbase.com), **search** for the **main company**, and **click** on "**acquisitions**". There you will see other companies acquired by the main one.

Other option is to visit the **Wikipedia** page of the main company and search for **acquisitions**.

> Ok, at this point you should know all the companies inside the scope. Lets figure out how to find their assets.

## ASNs

> An autonomous system number (**ASN**) is a **unique number** assigned to an **autonomous system** (AS) by the **Internet Assigned Numbers Authority (IANA)**.

> An **AS** consists of **blocks** of **IP addresses** which have a distinctly defined policy for accessing external networks and are administered by a single organisation but may be made up of several operators.

It's interesting to find if the **company have assigned any ASN** to find its **IP ranges.** 

It will be interested to perform a **vulnerability test** against all the **hosts** inside the **scope** and **look for domains** inside these IPs.

You can search by **company name**, by **IP** or by **domain** in **[**https://bgp.he.net/**](https://bgp.he.net)**.

Depending on the region of the company this links could be useful to **gather more data:**

- [**AFRINIC**](https://www.afrinic.net) (Africa)
- [**Arin**](https://www.arin.net/about/welcome/region/) (North America)
- [**APNIC**](https://www.apnic.net) (Asia)
- [**LACNIC**](https://www.lacnic.net) (Latin America),
- [**RIPE NCC**](https://www.ripe.net) (Europe). 

You can find the IP ranges of an organisation also using [http://asnlookup.com/](http://asnlookup.com) (it has free API).

You can find the IP and ASN of a domain using [http://ipv4info.com/](http://ipv4info.com).

## Scan for Vulnerabilities

At this point we known **all the assets inside the scope**, so if you are allowed you could launch some **vulnerability scanner** (Nessus, OpenVAS) over all the hosts.

Also, you could launch some port scans, go to [**Network Scan Section**](https://github.com/0xCGonzalo/Golden-Guide-for-Pentesting/tree/master/Pentesting/External/Network%20Scan) **and use services like** shodan **to find** open ports.

# Domains

> You now know all the companies and assets within your target scope, it's time to find the domains within scope.

## Reverse DNS

> A reverse DNS lookup is a DNS query for the domain name associated with a given IP address. This accomplishes the opposite of the more commonly used forward DNS lookup, in which the DNS system is queried to return an IP address.
Standards from the Internet Engineering Task Force (IETF) suggest that every domain should be capable of reverse DNS lookup, but as reverse lookups are not critical to the normal function of the Internet, they are not a hard requirement. As such, reverse DNS lookups are not universally adopted.

As you have found all the IP ranges of the domains you could try to perform **reverse dns lookups** on those **IPs to find more domains inside the scope**. 

Try to use some dns server of the victim or some well-known dns server (1.1.1.1, 8.8.8.8)

```bash
dnsrecon -r <DNS Range> -n <IP_DNS>   # DNS reverse of all of the addresses
dnsrecon -d facebook.com -r 157.240.221.35/24 # Using facebooks dns
dnsrecon -r 157.240.221.35/24 -n 1.1.1.1 # Using cloudflares dns
dnsrecon -r 157.240.221.35/24 -n 8.8.8.8 # Using google dns
```

For this to work, the administrator has to enable manually the PTR (pointer). You can also use a online tool for this info: [http://ptrarchive.com/](http://ptrarchive.com)

## All Domain in Host

When a user uses DNS Round Robin, they should feel this:
```
nslookup target.com
[RESULTS]
nslookup target.com
[RESULTS]
```
If both answers are different, this setting has probably been applied.

> A shared web hosting service is a web hosting service in which many websites reside on a web server connected to the Internet. The website will share a physical server with one or more websites.

If this situation occurs, you can try to find domains that share the same IP address or subnet using **Reverse IP Lookup**:

- [HackerTarget](https://hackertarget.com/reverse-ip-lookup/)
- [DNS Lytics](https://dnslytics.com/reverse-ip)
- [You Get Signal](https://www.yougetsignal.com/tools/web-sites-on-web-server/)

## Reverse Whois (loop)

Inside a **whois** you can find a lot of interesting **information** like **organisation name**, **address**, **emails**, phone numbers, and **more assets related to the company** if you perform **reverse whois lookups by any of those fields** (for example, other whois records where the same email appears that seems interesting).

You can use online tools like:

* [https://viewdns.info/reversewhois/](https://viewdns.info/reversewhois/) - **Free**
* [https://domaineye.com/reverse-whois](https://domaineye.com/reverse-whois)  - **Free**
* [https://www.reversewhois.io/](https://www.reversewhois.io)  - **Free**
* [https://www.whoxy.com/](https://www.whoxy.com) - **Free** web, not free API.
* [http://reversewhois.domaintools.com/](http://reversewhois.domaintools.com) - Not free
* [https://drs.whoisxmlapi.com/reverse-whois-search](https://drs.whoisxmlapi.com/reverse-whois-search) - Not Free (only **100 free** searches)
* [https://www.domainiq.com/](https://www.domainiq.com) - Not Free

You must have a paid subscription to use whois freely, otherwise the message "REDACTED FOR PRIVACY" will be displayed on some data.

Also, you can automate this task using [**DomLink** ](https://github.com/vysecurity/DomLink)(requires a whoxy API key):
```
python3 domLink.py -D target.com -o output.txt
```
**Note that you can use this technique to discover more domain names every time you find a new domain.**

## Other ways

#### Assetfinder

[**Assetfinder** ](https://github.com/tomnomnom/assetfinder)is a tool that look for **domains related** with a main domain and **subdomains** of them, pretty amazing.

### Looking for vulnerabilities

Check for some [domain takeover](../pentesting-web/domain-subdomain-takeover.md#domain-takeover). Maybe some company is **using some a domain** but they **lost the ownership**. Just register it (if cheap enough) and let know the company.

If you find any **domain with an IP different** from the ones you already found in the assets discovery, you should perform a **basic vulnerability scan** (using Nessus or OpenVAS) and some [**port scan**](../pentesting/pentesting-network/#discovering-hosts-from-the-outside) with **nmap/masscan/shodan**. Depending on which services are running you can find in **this book some tricks to "attack" them**.\
_Note that sometimes the domain is hosted inside an IP that is not controlled by the client, so it's not in the scope, be careful._




# Subdomains

## Why so many tools and techniques?
The more techniques used, the more chances to find interesting subdomains that others might have missed.

Some bug hunters recommend using only a handful of tools (like Amass, Massdns, Subfinder & Gobuster). But people who have a bad Internet connection & no VPS won’t be able to use these highly effective & fast tools. So choose whatever works for you!

## Methods

- Scraping
- Brute-force
- Alterations & permutations of already known subdomains
- Online DNS tools
- SSL certificates
- Certificate Transparency
- Search engines
- Public datasets
- DNS aggregators
- Git repositories
- Text parsing (HTML, JavaScript, documents…)
- VHost discovery
- ASN discovery
- Reverse DNS
- Zone transfer (AXFR)
- DNSSEC zone walking
- DNS cache snooping
- Content-Security-Policy HTTP headers
- Sender Policy Framework (SPF) records
- Subject Alternate Name (SAN)

## Techniques

### DNS Recon
```
dnsrecon -a -d target.com
dnsrecon -d target.com
```

### Dorks
Google, Bing
```
site:target.com -www
site:target.com -site:www.target.com
site:*.target.com -site:www.target.com -site:help.target.com
```

### Sublist3r
```
sublist3r -d target.com
```

### Knockpy
```
python3 knockpy.py target.com
```

### Altdns
You need a previously wordlist of subdomains for take 

Generate a list of altered subdomains:
```
./altdns.py -i known-subdomains.txt -o new_subdomains.txt
```
Generate a list of altered subdomains & resolve them:
```
./altdns.py -i known-subdomains.txt -o new_subdomains.txt -w words.txt -r -s results_output.txt
```

Other options
- -w wordlist.txt: Use custom wordlist (default altdns/words.txt)
- -t 10: Number of threads
- -d $IP: Use custom resolver

### Amass
```
amass enum -d target.com
amass enum -d target.com -r 8.8.8.8
```

### Censys
```
python censys_subdomain_finder.py target.com
```

### Subfinder
```
subfinder -d target.com
```

### The Harvester
You must configure all the API KEYS before running it for best performance.
```
theHarvester -d target.com -b all
```

## Online Tools

### Subdomain Online

- [NMMapper](https://www.nmmapper.com/sys/tools/subdomainfinder/)
- [DNS Dumpster](https://dnsdumpster.com/)
- [Spyse](https://spyse.com/tools/subdomain-finder)
- [Netcraft](https://searchdns.netcraft.com/)
- [VirusTotal](https://www.virustotal.com/gui/home/search)
- [ViewDNS](https://viewdns.info/)
- 

### Search Engines

- [Baidu](https://www.baidu.com/)
- [Yahoo](https://espanol.yahoo.com/?p=us&guccounter=1)
- [Google](https://www.google.com/)
- [Bing](https://www.bing.com/)
- [Yandex](https://www.yandex.ru/)
- [Exalead](https://www.exalead.com/search)
- [Dogpile](http://www.dogpile.com/)
- [Duckduckgo](https://duckduckgo.com/)
- [Riddler](https://riddler.io/)

### Specialized Search Engines

- [ZoomEye](https://www.zoomeye.org/)
- [FOFA](https://fofa.so/)
- [Shodan](https://www.shodan.io/)
- [ThreatCrowd](https://www.threatcrowd.org/)

### Certificate Transparency

- [Crt.sh](https://crt.sh/?q=%25target.com)
- [Certspotter.com](https://certspotter.com/api/v0/certs?domain=target.com)
- [Google Transaprency report](https://transparencyreport.google.com/https/certificates)
- [Facebook CT Monitoring](https://developers.facebook.com/tools/ct)
- [Certstream](https://certstream.calidog.io/)
- [CertDB](https://certdb.com/)
- [Censys.io](https://censys.io/)

# Emails

## Search Domain Emails

- [Hunter](https://hunter.io/)
- [TheHarvester](https://github.com/laramies/theHarvester)
  This local tool can help you find all emails for a domain.
  



